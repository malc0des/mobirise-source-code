var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(e){var a=0;return function(){return a<e.length?{done:!1,value:e[a++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.makeIterator=function(e){var a="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return a?a.call(e):$jscomp.arrayIterator(e)};
$jscomp.findInternal=function(e,a,c){e instanceof String&&(e=String(e));for(var n=e.length,q=0;q<n;q++){var z=e[q];if(a.call(c,z,q,e))return{i:q,v:z}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,c){e!=Array.prototype&&e!=Object.prototype&&(e[a]=c.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,a,c,n){if(a){c=$jscomp.global;e=e.split(".");for(n=0;n<e.length-1;n++){var q=e[n];q in c||(c[q]={});c=c[q]}e=e[e.length-1];n=c[e];a=a(n);a!=n&&null!=a&&$jscomp.defineProperty(c,e,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
defineM("code-editor",function(e,a,c){function n(){if(!a.$body.find("#theme-settings .edit-in-code-editor-btn").length){var b='<button type="button" class="btn btn-primary edit-in-code-editor-btn">'+c("Edit in Code Editor")+"</button>";a.$body.find("#theme-settings .app-layer-cont").append(b);a.$body.find("#theme-settings .edit-in-code-editor-btn").on("click",function(){a.showSiteCodeEditor()})}}function q(){var b=a.getPlugin("Theme"),d;if(b)for(var c in b.files){var f=b.files[c];"string"===typeof f&&
(f={src:f});if(/.css$/g.test(f.src))return a.Core.$document.find('head [rel="stylesheet"]').each(function(a,b){if(0<b.sheet.href.indexOf(f.src))return d=b.sheet,!1}),d}else console.warn("Theme CSS styles not found!")}function z(b){var d=e.Deferred();if(!0===b||void 0===a.projectSettings.theme.staticStyles)if(J)d.resolve(J);else if(b=a.getPlugin("Theme"))for(var c in b.files){var f=b.files[c];"string"===typeof f&&(f={src:f});if(/.css$/g.test(f.src)){Bridge.loadLocalFile(a.theme.pathExport+"/plugins/"+
f.src,function(a){J=a;d.resolve(a)});break}}else console.warn("Theme CSS styles not found!"),d.resolve();else d.resolve(a.projectSettings.theme.staticStyles);return d}function A(){clearTimeout(L);L=setTimeout(function(){a:{var b=a.$codeEditor.find("#block-anchor");var d=b.val();if(""===d||0<=d.indexOf(" "))b.addClass("error-input"),b=!0;else{for(var h=a.Core.resultJSON[a.Core.currentPage].components,f=a.$codeEditorCSS.currentComponentID,e=0;e<h.length;e++)if(h[e]._id!=f&&d===h[e]._anchor){b.addClass("error-input");
b=!0;break a}b.removeClass("error-input");b=!1}}d=a.$codeEditor.find(".code-editor-save");h=a.$codeEditor.find(".code-editor-save-wrapper");b||0<a.$codeEditor.find(".cm-error").length?(d.removeClass("btn-primary").addClass("btn-material-red").attr("disabled","").find(".mbr-icon-check").removeClass("mbr-icon-check").addClass("mbr-icon-frowning-face"),b?h.tooltipster("content",c("Fix block anchor")):h.tooltipster("content",c("Fix invalid code (marked in red)")),h.tooltipster("enable"),d.tooltipster("disable")):
(d.removeClass("btn-material-red").addClass("btn-primary").removeAttr("disabled").find(".mbr-icon-frowning-face").removeClass("mbr-icon-frowning-face").addClass("mbr-icon-check"),h.tooltipster("disable"),d.tooltipster("enable"))},501)}function B(){clearTimeout(M);M=setTimeout(function(){var b=a.$siteCodeEditor.find(".code-editor-save"),d=a.$siteCodeEditor.find(".code-editor-save-wrapper");0<a.$siteCodeEditor.find(".cm-error").length?(b.removeClass("btn-primary").addClass("btn-material-red").attr("disabled",
"").find(".mbr-icon-check").removeClass("mbr-icon-check").addClass("mbr-icon-frowning-face"),d.tooltipster("enable"),b.tooltipster("disable")):(b.removeClass("btn-material-red").addClass("btn-primary").removeAttr("disabled").find(".mbr-icon-frowning-face").removeClass("mbr-icon-frowning-face").addClass("mbr-icon-check"),d.tooltipster("disable"),b.tooltipster("enable"))},501)}var m,N=!1,O=!1,C=0,t=!1,v=!1,w=!1,J="",D="",F,G,H=a.isSecondaryComponent||function(){return!1},L=null,M=null;e(['<section id="component-code-editor" class="app-layer no-select">\n<div class="app-layer-cont cont-table">\n<div class="table-row table-row-bg">',
'<h4 class="app-layer-title">'+c("HTML Editor")+"</h4>",'<input id="block-anchor" type="text" class="form-control" data-tooltipster="bottom" title="'+c("Edit Block Anchor")+'">','</div>\n<div class="table-row table-row-editor">\n<div class="html-editor table-cell"></div>\n</div>\n<div class="table-row table-row-resizer">\n<div class="table-cell"></div>\n</div>\n<div class="vertical-divider hidden"></div>','<div class="table-row table-row-bg"><h4 class="app-layer-title">'+c("CSS Editor")+"</h4></div>",
'<div class="table-row table-row-editor">\n<div class="css-editor table-cell"></div>\n</div>\n<div class="code-editor-top-buttons">','<a class="code-editor-help" data-tooltipster="bottom" title="'+c("Help")+'"><i class="mbr-icon-question"></i></a>','<a class="code-editor-settings" data-tooltipster="bottom" title="'+c("Settings")+'"><i class="mbr-icon-cog"></i></a>','</div>\n<div class="code-editor-buttons">','<button class="code-editor-cancel btn btn-fab btn-raised btn-material-red" data-tooltipster="top" title="'+
c("Cancel and Close")+'"><i class="mbr-icon-times"></i></button>','<button class="code-editor-undo btn btn-fab btn-raised btn-primary" data-tooltipster="top" title="'+c("Undo")+'"><i class="mbr-icon-undo"></i></button>','<button class="code-editor-redo btn btn-fab btn-raised btn-primary" data-tooltipster="top" title="'+c("Redo")+'"><i class="mbr-icon-redo"></i></button>','<div class="code-editor-save-wrapper" data-tooltipster="top">','<button class="code-editor-save btn btn-fab btn-raised btn-primary" data-tooltipster="top" title="'+
c("Save and Close")+'"><i class="mbr-icon-check"></i></button>',"</div>",'<button class="code-editor-preview btn btn-fab btn-raised btn-info" data-tooltipster="top" title="'+c("Preview")+'"><i class="mbr-icon-eye"></i></button>','</div>\n</div>\n<div class="editor-resizer"></div>\n</section>\n<section id="site-code-editor" class="app-layer no-select">\n<div class="app-layer-cont cont-table">','<div class="table-row table-row-bg"><h4 class="app-layer-title">'+c("Static Styles")+"</h4></div>",'<div class="table-row table-row-editor">\n<div class="css-static-editor table-cell"></div>\n</div>\n<div class="table-row table-row-resizer resizer-1">\n<div class="table-cell"></div>\n</div>\n<div class="vertical-divider vd-1 hidden"></div>',
'<div class="table-row table-row-bg"><h4 class="app-layer-title">'+c("Dynamic Styles")+"</h4></div>",'<div class="table-row table-row-editor">\n<div class="css-dynamic-editor table-cell"></div>\n</div>\n<div class="table-row table-row-resizer resizer-2">\n<div class="table-cell"></div>\n</div>\n<div class="vertical-divider vd-2 hidden"></div>','<div class="table-row table-row-bg"><h4 class="app-layer-title">'+c("Site Parameters")+"</h4></div>",'<div class="table-row table-row-editor">\n<div class="json-params-editor table-cell"></div>\n</div>\n<div class="code-editor-top-buttons">',
'<a class="code-editor-restore" data-tooltipster="bottom" title="'+c("Restore Defaults")+'"><i class="mbr-icon-alternate-redo"></i></a>','<a class="code-editor-help" data-tooltipster="bottom" title="'+c("Help")+'"><i class="mbr-icon-question"></i></a>','<a class="code-editor-settings" data-tooltipster="bottom" title="'+c("Settings")+'"><i class="mbr-icon-cog"></i></a>','</div>\n<div class="code-editor-buttons">','<button class="code-editor-cancel btn btn-fab btn-raised btn-material-red" data-tooltipster="top" title="'+
c("Cancel and Close")+'"><i class="mbr-icon-times"></i></button>','<button class="code-editor-undo btn btn-fab btn-raised btn-primary" data-tooltipster="top" title="'+c("Undo")+'"><i class="mbr-icon-undo"></i></button>','<button class="code-editor-redo btn btn-fab btn-raised btn-primary" data-tooltipster="top" title="'+c("Redo")+'"><i class="mbr-icon-redo"></i></button>','<div class="code-editor-save-wrapper" data-tooltipster="top" title="'+c("Fix invalid code (marked in red)")+'">','<button class="code-editor-save btn btn-fab btn-raised btn-primary" data-tooltipster="top" title="'+
c("Save and Close")+'"><i class="mbr-icon-check"></i></button>',"</div>\n</div>\n</div>\n</section>"].join("\n")).appendTo("body");var E={lineNumbers:!0,lineWrapping:!0,foldGutter:!0,autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,tabSize:4,indentUnit:4,mode:"application/x-httpd-php",theme:"mobirise",keyMap:"mbrSublime",gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],placeholder:c("Type a valid HTML code here"),matchTags:{bothTags:!0}},P=function(){var b,d=[];a.on("addonLoadFinish",
function(a,b){"code-editor"==a.name&&(d=b.dynamicDependencies||[])});return function(){if(b)return b.promise();b=e.Deferred();var c=[],f=a.getAddonDir("code-editor"),g=function(){var d=c.shift();d?a.addAppScript(d).then(g):b.resolve()};d.forEach(function(b){var d=f+"/"+("object"==typeof b?b.src:b);b="object"==typeof b&&b.type?b.type:d.split(".").pop();"js"==b?c.push(d):"css"==b&&a.addAppStyle(d)});g();return b.promise()}}(),I=function(){function b(){return!!e(".component-code-editor-preloader").length}
var d=e(a.preloaderHTML).hide()[0].outerHTML;return{show:function(){b()||(e("body").prepend(e('<section class="component-code-editor-preloader"><div class="component-code-editor-preloader-sidebar">'+d+"</div></section>")),setTimeout(function(){e("body").addClass("component-code-editor-preloader-open");e(".component-code-editor-preloader").find(".preloader").show()},250))},hide:function(){b()&&setTimeout(function(){e(".component-code-editor-preloader").remove();e("body").removeClass("component-code-editor-preloader-open")},
400)},isShown:b}}();a.regExtension({name:"code-editor",global:{$codeEditor:e("#component-code-editor"),$siteCodeEditor:e("#site-code-editor"),$codeEditorHTML:e("#component-code-editor .html-editor"),$codeEditorCSS:e("#component-code-editor .css-editor"),$codeEditorStaticCSS:e("#site-code-editor .css-static-editor"),$codeEditorDynamicCSS:e("#site-code-editor .css-dynamic-editor"),$codeEditorParamsJSON:e("#site-code-editor .json-params-editor"),initCodeEditor:function(){var b=this,d=CodeMirror(b.$codeEditorHTML[0],
E);emmetCodeMirror(d);b.$codeEditorHTML.codemirror=d;var h=CodeMirror(b.$codeEditorCSS[0],e.extend({},E,{mode:"css",placeholder:c("Type a valid CSS code here")}));emmetCodeMirror(h);b.$codeEditorCSS.codemirror=h;d.on("change",function(){C++});h.on("change",function(){C++});d.on("focus",function(){m=a.$codeEditorHTML});h.on("focus",function(){m=a.$codeEditorCSS});(function(){var a=b.$codeEditorCSS.parent(),c,e=!0,k=0,r=0;b.$codeEditor.find(".table-row-resizer").on("mousedown",function(d){c=!0;k=d.pageY;
r=a.height();b.$iframeOverlay.show()});b.$codeEditor.on("mousemove",function(d){c&&(d.preventDefault(),a.height(Math.max(100,r+k-d.pageY)),e&&(b.$codeEditorHTML.parent().css("height","100%"),e=!1))});b.$window.on("mouseup",function(){c&&(b.$iframeOverlay.hide(),d.refresh(),h.refresh());c=!1})})();(function(){var a,c,e,k=b.$codeEditorCSS.parent(),r=k.prev();b.$codeEditor.find(".vertical-divider").on("mousedown",function(d){a=!0;c=d.pageX;e=k.width();b.$iframeOverlay.show()});b.$window.on("mousemove",
function(d){a&&(d.preventDefault(),d=Math.max(300,Math.min(b.$window.width()-300,e+c-d.pageX)),k.css("flex-basis",d+"px"),r.css("width",d+"px"))});b.$window.on("mouseup",function(){a&&(a=!1,b.$iframeOverlay.hide(),d.refresh(),h.refresh())});b.$window.on("resize",function(a){r.css("width","");k.css("flex-basis","")})})();(function(){var a=b.$codeEditor,c,l=0,k=0;b.$codeEditor.find(".editor-resizer").on("mousedown",function(d){e("body").is(".fullwidth-code-editor")||(c=!0,l=d.pageX,k=a.width(),b.$iframeOverlay.show())});
b.$window.on("mousemove",function(b){c&&(b.preventDefault(),a.css({width:Math.max(300,Math.min(1E3,k+l-b.pageX)),"max-width":"100%"}))});b.$window.on("mouseup",function(){c&&(b.$iframeOverlay.hide(),d.refresh(),h.refresh());c=!1})})();a.$codeEditor.find("#block-anchor").on("input",function(){A()});N=!0},initSiteCodeEditor:function(){var b=CodeMirror(this.$codeEditorStaticCSS[0],e.extend({},E,{mode:"css",placeholder:c("Type a valid CSS code here")}));emmetCodeMirror(b);this.$codeEditorStaticCSS.codemirror=
b;var d=CodeMirror(this.$codeEditorDynamicCSS[0],e.extend({},E,{mode:"css",placeholder:c("Type a valid CSS code here")}));emmetCodeMirror(d);this.$codeEditorDynamicCSS.codemirror=d;var h=CodeMirror(this.$codeEditorParamsJSON[0],e.extend({},E,{mode:"javascript",json:!0,placeholder:c("Type a valid JSON code here")}));emmetCodeMirror(h);this.$codeEditorParamsJSON.codemirror=h;b.on("change",function(){t=!0});d.on("change",function(){v=!0});h.on("change",function(){w=!0});b.on("focus",function(){m=a.$codeEditorStaticCSS});
d.on("focus",function(){m=a.$codeEditorDynamicCSS});h.on("focus",function(){m=a.$codeEditorParamsJSON});(function(){var c,g=0,l,k,r=a.$codeEditorStaticCSS.parent(),x=a.$codeEditorDynamicCSS.parent(),p=a.$codeEditorParamsJSON.parent(),Q=r.prev(),u,m,y,K;a.$siteCodeEditor.find(".table-row-resizer").on("mousedown",function(b){u=r.height();m=p.height();y=Q.height();var d=e(b.target).hasClass("table-row-resizer")?e(b.target):e(b.target).closest(".table-row-resizer");K=d.height();d.hasClass("resizer-1")?
(l=!0,p.css("height",m)):k=!0;c=!0;g=b.pageY;a.$iframeOverlay.show()});a.$siteCodeEditor.on("mousemove",function(b){c&&(b.preventDefault(),l?(b=Math.max(0,Math.min(a.$window.height()-m-3*y-2*K,b.pageY-65)),r.height(b)):k&&(b=Math.max(0,Math.min(a.$window.height()-u-3*y-2*K,m+g-b.pageY)),p.height(b)),x.css("height","100%"))});a.$window.on("mouseup",function(){c&&(a.$iframeOverlay.hide(),b.refresh(),d.refresh(),h.refresh());c=l=k=!1});a.$window.on("resize",function(){r.css("height","");x.css("height",
"");p.css("height","")})})();(function(){var c,g,l,k,r,x,p=a.$codeEditorStaticCSS.parent(),m=a.$codeEditorDynamicCSS.parent(),u=a.$codeEditorParamsJSON.parent(),n=m.prev(),y=u.prev();a.$siteCodeEditor.find(".vertical-divider").on("mousedown",function(b){e(b.target).hasClass("vd-1")?r=!0:x=!0;l=p.width();k=u.width();c=!0;g=b.pageX;a.$iframeOverlay.show()});a.$window.on("mousemove",function(b){c&&(b.preventDefault(),r?(b=Math.max(150,Math.min(a.$window.width()-k-150,b.pageX)),p.css("flex-basis",b+"px"),
n.css("width",a.$window.width()-b+"px")):x&&(b=Math.max(150,Math.min(a.$window.width()-l-150,k+g-b.pageX)),u.css("flex-basis",b+"px"),y.css("width",b+"px")))});a.$window.on("mouseup",function(){c&&(c=r=x=!1,a.$iframeOverlay.hide(),b.refresh(),d.refresh(),h.refresh())});a.$window.on("resize",function(){n.css("width","");y.css("width","");p.css("flex-basis","");u.css("flex-basis","")})})();O=!0},showCodeEditor:function(b){if(!this.$body.hasClass("app-component-code-editor-open")){var d=this,e=b.attr("data-app-component-id"),
f=d.Core.getComponent(e);d.fire("beforeShowCodeEditor",e);var g=P();if("pending"!==g.state()&&N){if(f){d.fire("showCodeEditor",e);d.Core.focusComponentBlock(e);a.$codeEditor.find("#block-anchor").val(f._anchor);var l="";this.Core.getComponentHTMLforEditor(e,f).then(function(a){"undefined"===typeof f._customHTML?(l=a||"",d.$codeEditorHTML.children(".html-editor-locked").length||d.$codeEditorHTML.prepend('<div class="html-editor-locked"><span><i class="icon-lock"></i>'+c("Click to Unlock HTML Editor")+
"</span></div>"),d.$codeEditorHTML.parent().addClass("small")):(l=f._customHTML||"",H(f)||(l=d.Core.cleanHTMLplease(l)),d.$codeEditorHTML.children(".html-editor-locked").remove(),d.$codeEditorHTML.parent().removeClass("small"));d.$codeEditorHTML.defaultValue=l;d.$codeEditorCSS.defaultValue=f._customCSS;l=this.Core.decodeCodeEditorJS(l,f);l=this.Core.decodeCodeEditorPHP(l,f);d.$codeEditorHTML.codemirror.setValue(l);d.$codeEditorHTML.codemirror.clearHistory();d.$codeEditorHTML.currentComponentID=e;
d.$codeEditorCSS.codemirror.setValue(f._customCSS||"");d.$codeEditorCSS.codemirror.clearHistory();d.$codeEditorCSS.currentComponentID=e;d.$body.removeClass("app-sidebar-open app-page-settings-open app-add-component-open app-component-params-open");d.fire("hideComponents");d.$body.addClass("app-component-code-editor-open");d.fire("showedCodeEditor",e);C=0}.bind(this))}else C=0;A()}else I.show(),g.then(function(){d.initCodeEditor();d.showCodeEditor(b);I.hide()})}},showSiteCodeEditor:function(){if(!this.$body.hasClass("app-site-code-editor-open")){a.$body.addClass("fullwidth-code-editor");
var b=P();"pending"!==b.state()&&O?(a.fire("showSiteCodeEditor"),z().then(function(b){a.$codeEditorStaticCSS.codemirror.setValue(b);a.$codeEditorStaticCSS.codemirror.clearHistory();D||a.Core.renderComponentsStyles();a.$codeEditorDynamicCSS.codemirror.setValue(void 0===a.projectSettings.theme.dynamicStyles?D:a.projectSettings.theme.dynamicStyles);a.$codeEditorDynamicCSS.codemirror.clearHistory();a.$codeEditorParamsJSON.codemirror.setValue(JSON.stringify(a.theme.params.theme.settings,null,"\t"));a.$codeEditorParamsJSON.codemirror.clearHistory();
a.$body.removeClass("app-sidebar-open app-page-settings-open app-add-component-open app-component-params-open");a.$body.addClass("app-site-code-editor-open");t=v=w=!1;B();a.fire("showedSiteCodeEditor")})):(I.show(),b.then(function(){a.initSiteCodeEditor();a.showSiteCodeEditor();I.hide()}))}},unlockHTMLEditor:function(){var b=this.$codeEditorHTML.currentComponentID;this.fire("unlockHTMLEditor",b);a.Core.convertComponentToCustomHTML(b).then(function(){var c=a.Core.getComponent(b);a.$codeEditorHTML.defaultValue=
c._customHTML||"";var e=a.Core.decodeCodeEditorJS(c._customHTML,c);(e=a.Core.decodeCodeEditorPHP(e,c))||(e=a.Core.decodeCodeEditorPHP(e,c));a.$codeEditorHTML.codemirror.setValue(e||"");a.$codeEditorHTML.codemirror.clearHistory();a.$codeEditorHTML.children(".html-editor-locked").remove();a.$codeEditorHTML.parent().removeClass("small");a.$codeEditorCSS.defaultValue=c._customCSS;a.$codeEditorCSS.codemirror.setValue(c._customCSS||"");a.$codeEditorCSS.codemirror.clearHistory();a.fire("unlockedHTMLEditor",
b)})},previewCodeEditor:function(){var a=this.$codeEditorHTML.currentComponentID,c=this.Core.getComponent(a);c&&(this.$codeEditorHTML.children(".html-editor-locked").length||(c._customHTML=this.$codeEditorHTML.codemirror.getValue(),c._customHTML=this.Core.encodeCodeEditorPHP(c._customHTML,c),c._customHTML=this.Core.encodeCodeEditorJS(c._customHTML,c)),c._customCSS=this.$codeEditorCSS.codemirror.getValue(),this.Core.renderCodeEditorChanges(a),this.fire("previewCodeEditor",a))},closeCodeEditor:function(){var a=
this,c=a.$codeEditorCSS.currentComponentID;a.fire("closeCodeEditor",c);a.$codeEditorHTML.defaultValue=a.$codeEditorHTML.currentComponentID=a.$codeEditorCSS.defaultValue=a.$codeEditorCSS.currentComponentID=void 0;a.$body.removeClass("app-component-code-editor-open");setTimeout(function(){a.fire("closedCodeEditor",c)},200)},closeSiteCodeEditor:function(){a.fire("closeSiteCodeEditor");t=v=w=!1;a.$body.removeClass("app-site-code-editor-open");setTimeout(function(){a.fire("closedSiteCodeEditor")},200)},
saveCodeEditor:function(){var b=this.$codeEditorCSS.currentComponentID,d=this.Core.getComponent(b);this.fire("saveCodeEditor");for(var e=a.Core.resultJSON[a.Core.currentPage].components,f=a.$codeEditor.find("#block-anchor").val(),g=0;g<e.length;g++)if(e[g]._id!=b&&f===e[g]._anchor){a.alertDlg(c("This anchor is already used in another block."));return}d._anchor=a.$codeEditor.find("#block-anchor").val();if(H(d)){var l=this.$codeEditorCSS.codemirror.getValue(),k=this.$codeEditorHTML.codemirror.getValue();
k=this.Core.encodeCodeEditorPHP(k,d);k=this.Core.encodeCodeEditorJS(k,d);this.objectifyCSS(l).then(function(b){return a.SecondaryComponent.validate(k).then(function(){return b},function(b){a.$codeEditorHTML.codemirror.resetErrorHighlight();b.line&&a.$codeEditorHTML.codemirror.highlightErrorLine(b.line-1);a.showError("<strong>"+c("HTML Editor.")+"</strong> "+b.message);throw k;})},function(b){a.$codeEditorCSS.codemirror.resetErrorHighlight();b.line&&a.$codeEditorCSS.codemirror.highlightErrorLine(b.line-
1);a.showError("<strong>"+c("CSS Editor.")+"</strong> Parse error: "+b.message);throw l;}).then(function(e){var h=d._customHTML,f=d._styles;d._customHTML=k;d._customCSS=l;d._styles=e;a.Core.renderCodeEditorChanges(b).then(function(){a.closeCodeEditor();a.fire("savedCodeEditor",b);a.Core.fire("savedCodeEditor",b)},function(b){d._customHTML=h;d._styles=f;a.$codeEditorCSS.codemirror.resetErrorHighlight();if(b.extract[1]){var e=1,g=l.indexOf(b.extract[1]);l.split("\n").map(function(a){return a.length}).reduce(function(a,
b){a<g&&e++;return a+b+1});a.$codeEditorCSS.codemirror.highlightErrorLine(e-1)}a.showError("<strong>"+c("CSS Editor.")+"</strong> Parse error: "+b.message)})})}else this.previewCodeEditor(),this.closeCodeEditor(),this.Core.renderCodeEditorChanges(b),d._customHTML&&(e=this.Core.$template.find("[data-app-component-id="+b+"]"),this.Core.initSummernote(e)),this.fire("savedCodeEditor")},saveSiteCodeEditor:function(){a.fire("saveSiteCodeEditor");var b=a.$codeEditorStaticCSS.codemirror.getValue(),d=a.$codeEditorDynamicCSS.codemirror.getValue(),
h=a.$codeEditorParamsJSON.codemirror.getValue();e.when(function(b,d){var h=e.Deferred();"restored"===b?(delete a.projectSettings.theme.staticStyles,h.resolve()):b?a.objectifyCSS(d).then(function(b){a.projectSettings.theme.staticStyles=d;h.resolve()},function(b){a.$codeEditorStaticCSS.codemirror.resetErrorHighlight();b.line&&a.$codeEditorStaticCSS.codemirror.highlightErrorLine(b.line-1);a.showError("<strong>"+c("Static Styles.")+"</strong> Parse error: "+b.message);h.reject()}):h.resolve();return h.promise()}(t,
b),function(b,d){var h=e.Deferred();if("restored"===b)delete a.projectSettings.theme.dynamicStyles,h.resolve();else if(b){var f=a.Core.applyFilter("beforeRenderStylesForComponent",d);a.iwindow.less.render(f,function(b,e){b?(a.$codeEditorDynamicCSS.codemirror.resetErrorHighlight(),b.line&&a.$codeEditorDynamicCSS.codemirror.highlightErrorLine(b.line-(f.split("\n").length-d.split("\n").length+1)),a.showError("<strong>"+c("Dynamic Styles.")+"</strong> Parse error: "+b.message),h.reject()):(a.projectSettings.theme.dynamicStyles=
d,h.resolve())})}else h.resolve();return h.promise()}(v,d),function(b,d){var h=e.Deferred();if("restored"===b)delete a.projectSettings.theme.settings;else if(b){""===d&&(d="[]");try{var f=e.parseJSON(d)}catch(p){console.error("Error parse settings:",p);b=$jscomp.makeIterator(p.message.split("at position"));f=b.next().value;var g=b.next().value;a.$codeEditorParamsJSON.codemirror.resetErrorHighlight();if(g){if(1!==g&&g!==d.length-1){var m=1;d.split("\n").map(function(a){return a.length}).reduce(function(a,
b){a<g&&m++;return a+b+1});g=m}else g!==d.length-1&&(g=d.split("\n").length);a.$codeEditorParamsJSON.codemirror.highlightErrorLine(g-1)}a.showError("<strong>"+c("Site Parameters.")+"</strong> Parse error: "+(f?f:p));h.reject();return h.promise()}a.projectSettings.theme.settings=a.theme.params.theme.settings=f}h.resolve();return h.promise()}(w,h)).done(function(b,c,d){a.redrawStyleChanger();a.Core.renderComponentsStyles();a.closeSiteCodeEditor();a.fire("savedSiteCodeEditor")})},cancelCodeEditor:function(){var a=
this.$codeEditorHTML.currentComponentID,c=this.Core.getComponent(a);this.fire("cancelCodeEditor",a);"undefined"!==typeof c._customHTML&&(c._customHTML=this.$codeEditorHTML.defaultValue);c._customCSS=this.$codeEditorCSS.defaultValue;this.Core.renderCodeEditorChanges(a);this.closeCodeEditor();this.fire("canceledCodeEditor",a)}},events:{beforeAppLoad:function(){a.Core.addFilter("prepareComponent",function(a,d){var b=e("<div>").html(a);a='<span class="mbr-btn component-code mbr-icon-code" data-tooltipster="bottom" title="'+
c("Edit Code")+'"></span>';b.find(".component-code-fake").length&&b.find(".component-code-fake").remove();b.find(".component-params").length?(b.find(".component-params").before(a),!H(d)&&d._customHTML&&b.find(".component-params").remove()):b.find(".component-remove").length&&b.find(".component-remove").before(a);a=b.html();b.remove();return a});a.addFilter("getPluginResource",function(b,c,e){void 0!==a.projectSettings.theme.staticStyles&&0===c.indexOf("Theme")&&"css"===e&&a.appSettings.removeMobiriseReferences&&
(b.css="");return b});a.addFilter("insertThemeStyleAmp",function(b){void 0!==a.projectSettings.theme.staticStyles&&(b=!1);return b});a.addFilter("publishFiles",function(b){if(void 0!==a.projectSettings.theme.staticStyles){var c=a.getPlugin("Theme");if(c)for(var e in c.files){var f=c.files[e];"string"===typeof f&&(f={src:f});if(/.css$/g.test(f.src))for(var g=0;g<b.length;g++)if(0<=b[g].dest.indexOf(f.src)){for(var l=b[g].srcList,k=0;k<l.length;k++)if(0<=l[k].src.indexOf(f.src)){l.splice(k,1);break}l.length||
b.splice(g,1);break}}}return b});a.Core.addFilter("afterRenderStyles",function(b,c,e){G||(G=q());if(void 0===a.projectSettings.theme.staticStyles)return G.disabled=!1,b;G.disabled=!0;return b});a.addFilter("getCustomLessText",function(a){D||(D=a);return a})},load:function(){var b=this;b.addFilter("preventParamsShow",function(a,c){return!a&&(c=b.Core.getComponent(c))&&c._customTemplate?!0:a});b.addFilter("pageNameFullEdit",function(){return!0});b.addFilter("showAllBlockButtons",function(){return"true"});
a.addFilter("addAppSettingsItem",function(b){return[b,'<label class="col-md-3">'+c("Code Editor")+"</label>",'<div class="col-md-9 app-code-editor-settings">\n<br>\n<div class="setting">\n<div class="row">',"<label>"+c("Select Color Scheme")+"</label>",'<div class="input-group">\n<select class="form-control" name="theme">\n<option value="mobirise">default</option>\n<option value="default">light</option>\n<option value="monokai">contrast</option>\n</select>\n</div>\n</div>\n</div>\n<div class="setting">\n<div class="row">\n<div class="togglebutton">\n<label data-tooltipster="right" data-tooltip-class="setting-image" data-tooltip-src="app/builder/images/app_settings/show-code-editor-undo.jpg">',
'<input name="show-code-editor-undo" type="checkbox"'+(a.appSettings.showCodeEditorUndo?'checked="checked"':"")+'><span style="margin-top:-3px;" class="toggle"></span>'+c("Show Undo/Redo"),'</label>\n</div>\n</div>\n</div>\n<div class="setting">\n<div class="row">\n<div class="togglebutton">\n<label>','<input name="remove-mobirise-references" type="checkbox"'+(a.appSettings.removeMobiriseReferences?'checked="checked"':"")+'><span style="margin-top:-3px;" class="toggle"></span>'+c('Remove "Mobirise" from HTML'),
"</label>\n</div>\n</div>\n</div>\n</div>"].join("\n")});a.addFilter("sidebarProjectSettings",function(a){var b={title:c("Global HTML Insert"),name:"global-HTML",html:'<div class="form-group row col-md-12"><label for="site_lang" class="col-xs-4 control-label">'+c("HTML lang=")+'</label><div class="col-xs-3"><input id="site_lang" class="form-control" type="text" placeholder="en" value=""></div></div><div class="form-group col-md-12"><label for="global_header_custom" class="control-label">'+c("Before $/head$ code:").replace("$/head$",
"&lt;/head&gt;")+'</label><textarea id="global_header_custom" class="form-control" rows="5" placeholder="'+c("Paste the HTML code you want to have on every page, right before $/head$ tag").replace("$/head$","&lt;/head&gt;")+'"></textarea></div><div class="form-group col-md-12"><label for="global_after_body" class="control-label">'+c("After $body$ code:").replace("$body$","&lt;body&gt;")+'</label><textarea id="global_after_body" class="form-control" rows="5" placeholder="'+c("Paste the HTML code you want to have on every page, right after $body$ tag").replace("$body$",
"&lt;body&gt;")+'"></textarea></div><div class="form-group col-md-12"><label for="global_footer_custom" class="control-label">'+c("Before $/body$ code:").replace("$/body$","&lt;/body&gt;")+'</label><textarea id="global_footer_custom" class="form-control" rows="5" placeholder="'+c("Paste the HTML code you want to have on every page, right before $/body$ tag").replace("$/body$","&lt;/body&gt;")+'"></textarea></div><div class="form-group col-md-12"><label for="global_before_html" class="control-label">'+
c("Before $!DOCTYPE$, $html$ and $head$ tags:").replace("$!DOCTYPE$","&lt;!DOCTYPE&gt;").replace("$html$","&lt;html&gt;").replace("$head$","&lt;head&gt;")+'</label><textarea id="global_before_html" class="form-control" rows="5" placeholder="'+c("Paste the code you want to have in the VERY FIRST LINE of your page, before $!DOCTYPE$, $html$ and $head$ tags. Use for server side scripts (PHP, ASP, etc)").replace("$!DOCTYPE$","&lt;!DOCTYPE&gt;").replace("$html$","&lt;html&gt;").replace("$head$","&lt;head&gt;")+
'"></textarea></div>'};a.push(b);return a});b.$body.find("#app-page-settings .app-layer-cont").append('<div class="form-group"><label for="page_header_custom">'+c("Inside $head$ code:").replace("$head$","&lt;head&gt;")+'</label><textarea id="page_header_custom" class="form-control" data-page-settings="header_custom" rows="5" placeholder="'+c("Paste any valid HTML code here. The code will be inserted to the end of $head$ section, right before $/head$").replace("$head$","&lt;head&gt;").replace("$/head$",
"&lt;/head&gt;")+'"></textarea></div><div class="form-group"><label for="page_footer_custom">'+c("End of $body$ code:").replace("$body$","&lt;body&gt;")+'</label><textarea id="page_footer_custom" class="form-control" data-page-settings="footer_custom" rows="5" placeholder="'+c("Paste any valid HTML code here. The code will be inserted to the end of $body$ section, right before $/body$ tag").replace("$body$","&lt;body&gt;").replace("$/body$","&lt;/body&gt;")+'"></textarea></div><div class="form-group"><label for="page_before_html">'+
c("Before $!DOCTYPE$, $html$ and $head$ tags:").replace("$!DOCTYPE$","&lt;!DOCTYPE&gt;").replace("$html$","&lt;html&gt;").replace("$head$","&lt;head&gt;")+'</label><textarea id="page_before_html" class="form-control" data-page-settings="html_before" rows="5" placeholder="'+c("Paste the code you want to have in the VERY FIRST LINE of your page, before $!DOCTYPE$, $html$ and $head$ tags. Use for server side scripts (PHP, ASP, etc)").replace("$!DOCTYPE$","&lt;!DOCTYPE&gt;").replace("$html$","&lt;html&gt;").replace("$head$",
"&lt;head&gt;")+'"></textarea></div>');b.$template.on("click",".component-code",function(){b.showCodeEditor(e(this).parents("[data-app-component-id]:eq(0)"))});b.on("componentClicked",function(a,c){var d=b.Core.getComponent(a);e(c.target).is(".mbr-editable-image")||H(d)||d._customHTML&&(e(c.target).is("[code-editable-id]:not(img)")?this.Core.initSummernote(e(c.target)):b.showCodeEditor(b.$template.find("[data-app-component-id="+a+"]")))});b.$codeEditor.on("click",".html-editor-locked",function(){b.confirmDlg({message:"<p>"+
c("Do you want to unlock the HTML editor?")+"</p>"+c("If you unlock the HTML editor, you will not be able to work with %Block Parameters% anymore. It doesn't affect to other blocks.").replace(/%(.+)%/,'<br><span class="btn btn-component-params mbr-icon-cog"></span> <strong>$1</strong>'),callback:function(a){a&&b.unlockHTMLEditor()},buttons:{cancel:{label:c("No")},confirm:{label:c("Yes")}}})});b.$codeEditor.on("click",".code-editor-preview",function(){b.$codeEditor.toggleClass("code-editor-hide");
b.$codeEditor.hasClass("code-editor-hide")?(b.previewCodeEditor(),e(this).children("i").attr("class","mbr-icon-code")):e(this).children("i").attr("class","mbr-icon-eye")});b.$codeEditor.on("mouseleave",".code-editor-preview",function(){b.$codeEditor.removeClass("code-editor-hide");e(this).children("i").attr("class","mbr-icon-eye")});a.$codeEditor.on("keyup paste cut",function(){A()});a.$siteCodeEditor.on("keyup paste cut",function(){B()});a.$codeEditor.on("click",".code-editor-save",function(){a.saveCodeEditor()});
a.$siteCodeEditor.on("click",".code-editor-save",function(){a.saveSiteCodeEditor()});a.$codeEditor.on("mousedown",".code-editor-undo",function(a){m&&m.codemirror.undo();A()});a.$codeEditor.on("click",".code-editor-redo",function(a){m&&m.codemirror.redo();A()});a.$siteCodeEditor.on("mousedown",".code-editor-undo",function(b){"restored"===t&&"restored"===v&&"restored"===w?(a.$codeEditorStaticCSS.codemirror.undo(),a.$codeEditorDynamicCSS.codemirror.undo(),a.$codeEditorParamsJSON.codemirror.undo(),t=
v=w=!0):m&&m.codemirror.undo();B()});a.$siteCodeEditor.on("click",".code-editor-redo",function(a){m&&(m.codemirror.redo(),B())});b.$codeEditor.on("click",".code-editor-cancel",function(){C?b.confirmDlg({message:c("Do you want to close the code editor? Changes will not be saved."),callback:function(a){a&&b.cancelCodeEditor()},buttons:{cancel:{label:c("No")},confirm:{label:c("Yes")}}}):b.cancelCodeEditor()});a.$siteCodeEditor.on("click",".code-editor-cancel",function(){t||v||w?a.confirmDlg({message:c("Do you want to close the code editor? Changes will not be saved."),
callback:function(b){b&&a.closeSiteCodeEditor()},buttons:{cancel:{label:c("No")},confirm:{label:c("Yes")}}}):a.closeSiteCodeEditor()});var d="";a.$body.on("click",".code-editor-top-buttons .code-editor-help",function(){if(!d){var b=[{shortcut:"Ctrl+X",description:c("Cut line")},{shortcut:"Ctrl+Enter",description:c("Insert line after")},{shortcut:"Ctrl+Shift+Enter",description:c("Insert line before")},{shortcut:"Ctrl+Shift+Up",description:c("Move line/selection up")},{shortcut:"Ctrl+Shift+Down",description:c("Move line/selection down")},
{shortcut:"Ctrl+L",description:c("Select line")},{shortcut:"Ctrl+D",description:c("Select word - repeat select others occurrences")},{shortcut:"Ctrl+M",description:c("Jump to matching brackets")},{shortcut:"Ctrl+Shift+M",description:c("Select between brackets")},{shortcut:"Ctrl+Shift+K",description:c("Delete line")},{shortcut:"Ctrl+Shift+L",description:c("Split selection by line")},{shortcut:"Ctrl + ]",description:c("Indent current line(s)")},{shortcut:"Ctrl + [",description:c("Un-indent current line(s)")},
{shortcut:"Ctrl+Shift+D",description:c("Duplicate line(s)")},{shortcut:"Ctrl+J",description:c("Join line below to the end of the current line")},{shortcut:"Ctrl+/",description:c("Comment/un-comment current line")},{shortcut:"Ctrl+F2",description:c("Toggle bookmark")},{shortcut:"F2",description:c("Next bookmark")},{shortcut:"Shift+F2",description:c("Previous bookmark")},{shortcut:"Ctrl+Shift+F2",description:c("Clear bookmarks")},{shortcut:"Ctrl+K,U",description:c("Transform to uppercase")},{shortcut:"Ctrl+K ,L",
description:c("Transform to lowercase")},{shortcut:"Alt+Shift+Up",description:c("Add cursor to previous line")},{shortcut:"Alt+Shift+Down",description:c("Add cursor to next line")},{shortcut:"Ctrl+F",description:c("Find")},{shortcut:"Ctrl+H",description:c("Replace")},{shortcut:"F3",description:c("Find next occurrence of searched word")},{shortcut:"Ctrl+F3",description:c("Find previous occurrence of searched word")},{shortcut:"Alt+F3",description:c("Select all occurrences of current word")},{shortcut:"Ctrl+Shift+[",
description:c("Fold")},{shortcut:"Ctrl+Shift+]",description:c("Unfold")},{shortcut:"Ctrl+K,0",description:c("Unfold all")},{shortcut:"F9",description:c("Sort lines")},{shortcut:"Ctrl+F9",description:c("Sort lines insensitive")}],f=e('<div class="kb-row"><div class="kb-column kb-shortcut"></div><div class="kb-column kb-description"></div></div>'),g=f.clone();g.addClass("kb-header");g.find(".kb-shortcut").html("Shortcut");g.find(".kb-description").html("Description");d+=g[0].outerHTML;for(g=0;g<b.length;g++){for(var l=
f.clone(),k=b[g].shortcut.split("+"),m="",n=0;n<k.length;n++){var p="";if(0<k[n].indexOf(",")){for(var q=k[n].split(","),u="",t=0;t<q.length;t++)p="<kbd>"+q[t]+"</kbd>",u+=p;m+=u}else p="<kbd>"+k[n]+"</kbd>",m+=p;n!==k.length-1&&(m+="+")}l.find(".kb-shortcut").html(m);l.find(".kb-description").html(b[g].description);d+=l[0].outerHTML}}a.showDialog({title:c("Code Editor Quick Help"),className:"code-editor-help-dialog",body:'<div class="row form-group"><div class="col-md-12"><div class="help-links"><a class="link-ce-tutorial" href="https://mobirise.com/extensions/code-editor.html"><i class="mbr-icon-youtube"></i>'+
c("View video tutorial")+'</a><a class="link-ce-help" href="https://mobirise.com/help/code-editor-474.html"><i class="mbr-icon-question-circle"></i>'+c("Visit help page")+'</a></div><p><b>Keyboard shortcuts:</b></p><div class="kb-shortcuts">'+d+"</div></div></div>",show:function(b){b.find(".link-ce-tutorial").click(function(){a.openUrl("https://mobirise.com/extensions/code-editor.html")});b.find(".link-ce-help").click(function(){a.openUrl("https://mobirise.com/help/code-editor-474.html")})}})});a.$body.on("click",
".code-editor-top-buttons .code-editor-settings",function(){a.showAppSettings();a.$body.find(".app-settings-dialog .app-code-editor-settings").addClass("selected")});a.$siteCodeEditor.on("click",".code-editor-top-buttons .code-editor-restore",function(){a.confirmDlg(c("Restore all settings to default values?"),function(b){b&&z(!0).then(function(b){a.$codeEditorStaticCSS.codemirror.setValue(b);a.$codeEditorDynamicCSS.codemirror.setValue(D);a.$codeEditorParamsJSON.codemirror.setValue(JSON.stringify(F,
null,"\t"));t=v=w="restored";B()})})});b.$template.on("click","[code-editable-id].mbr-editable-image",function(a){a.preventDefault();var c=this;Bridge.runFileDialog("Select Image","","Images (*.jpg *.jpeg *.png *.gif *.bmp *.tiff)",function(a){a&&Bridge.moveFileClean(a,b.projectPath?b.projectPath+"/assets/images":"",function(a){e(c).attr("src",a);b.Core.changeEditableElement(c)})})})},unlockHTMLEditor:function(b){b=a.Core.$template.find("[data-app-component-id="+b+"]");a.Core.destroySummernote(b)},
initThemeSettings:function(){F||(F=a.theme.params.theme.settings);void 0===a.projectSettings.theme.settings&&(a.theme.params.theme.settings=F)},initSettingsSidebar:function(){n()},redrawStyleChanger:function(){n()},shownSidebarProjectSettings:function(b,c){b=a.projectSettings.site_lang||"";c=a.projectSettings.global_header_custom||"";var d=a.projectSettings.global_after_body||"",f=a.projectSettings.global_footer_custom||"",g=a.projectSettings.global_before_html||"";e("#site_lang").val(b);e("#global_header_custom").val(c);
e("#global_after_body").val(d);e("#global_footer_custom").val(f);e("#global_before_html").val(g);e("#site_lang").change(function(b){a.projectSettings.site_lang=b.target.value});e("#global_header_custom").change(function(b){a.projectSettings.global_header_custom=b.target.value});e("#global_after_body").change(function(b){a.projectSettings.global_after_body=b.target.value});e("#global_footer_custom").change(function(b){a.projectSettings.global_footer_custom=b.target.value});e("#global_before_html").change(function(b){a.projectSettings.global_before_html=
b.target.value})}}})},["jQuery","mbrApp","TR()"]);
