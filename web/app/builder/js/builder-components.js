var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,e,g){c instanceof String&&(c=String(c));for(var m=c.length,a=0;a<m;a++){var b=c[a];if(e.call(g,b,a,c))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,g){c!=Array.prototype&&c!=Object.prototype&&(c[e]=g.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,e,g,m){if(e){g=$jscomp.global;c=c.split(".");for(m=0;m<c.length-1;m++){var a=c[m];a in g||(g[a]={});g=g[a]}c=c[c.length-1];m=g[c];e=e(m);e!=m&&null!=e&&$jscomp.defineProperty(g,c,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,g){return $jscomp.findInternal(this,c,g).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(c){var e=0;return function(){return e<c.length?{done:!1,value:c[e++]}:{done:!0}}};
$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(c,e){this.$jscomp$symbol$id_=c;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function c(g){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(g||"")+"_"+e++,g)}var e=0;return c}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.asyncIterator;c||(c=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};
$jscomp.iteratorFromArray=function(c,e){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var g=0,m={next:function(){if(g<c.length){var a=g++;return{value:e(a,c[a]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
(function(c,e){function g(a){var b=e.getComponent(a);if(b._global&&1<Object.keys(this.resultJSON).length){var d=this.resultJSON,c=this.currentPage,l=[];if(b._once){var f={},h;for(h in d)f.$jscomp$loop$prop$page$4=h,d.hasOwnProperty(f.$jscomp$loop$prop$page$4)&&f.$jscomp$loop$prop$page$4!==c&&d[f.$jscomp$loop$prop$page$4].components.some(function(a){return function(d,c,f){if(d._once===b._once)return l.push(a.$jscomp$loop$prop$page$4),!0}}(f)),f={$jscomp$loop$prop$page$4:f.$jscomp$loop$prop$page$4}}e.APP.confirmDlg(e.APP.TR("This block is global. Do you want to add it to all pages?"),
function(f){if(f)if(l.length)f=e.APP.TR("Please remove $component$ on all pages").replace("$component$",b._once||b._name.replace(/[0-9]/g,""))+":<br/><br/>- "+l.join("<br/>- "),e.APP.alertDlg(f),e.removeComponent(a);else for(var p in d)d.hasOwnProperty(p)&&p!==c&&d[p].components.push(b)})}}var m=c('<style name="theme-styles">').appendTo("body");e.regExtension({name:"components",global:{replaceSystemVariables:function(a,b){if("string"===typeof a){if(/@USER_EMAIL@/g.test(a)){var d=(d=this.APP.getUserInfo())&&
d.email?d.email:"";a=a.replace(/@USER_EMAIL@/g,d)}/@ADDON_DIR@/g.test(a)&&(a=a.replace(/@ADDON_DIR@/g,this.APP.path2core(this.APP.getAddonDir(b.alias||this.APP.theme.name))+(b.alias?"/":"/components/")));a=this.applyFilter("replaceSystemVariables",a,b)}else if("object"===typeof a)for(d in a)a[d]=this.replaceSystemVariables(a[d],b);return a},addComponent:function(a,b,d){function p(){var a=e.resultJSON[e.currentPage].components[q],d=e.prepareComponent(a);!b||a._alwaysBottom||a._alwaysTop?a._alwaysTop?
(e.$template.prepend(d),d=0):(a=e.$template.find("[data-app-always-bottom]:eq(0)"),a.length?a.before(d):e.$template.append(d),d=e.$template.height()):(a=e.$template.find("[data-app-component-id="+b.item+"]"),"before"==b.where||a.attr("data-app-always-bottom")?(a.before(d),d=a.offset().top):(a.after(d),d=a.offset().top+a.height()));c("html").stop().animate({scrollTop:d},1E3);e.render(u);e.fire("addedComponent",u);l.resolve()}var l=c.Deferred(),f=c.extend(!0,{},this.components[a]);b&&b.item&&b.where||
(b=!1);var h=0,k;for(k in this.APP.components)if(k===a){h=1;break}if(h||"secondary"!=!e.APP.theme.type){f=this.replaceSystemVariables(f,f);if(f._once)for(k in this.resultJSON[this.currentPage].components)if(this.resultJSON[this.currentPage].components[k]._name==a)return;this.fire("addComponent",a);if(f._global)for(k in this.resultJSON)for(var t in this.resultJSON[k].components)if(this.resultJSON[k].components[t]._global&&this.resultJSON[k].components[t]._name==a){for(var g in this.resultJSON[k].components[t])f[g]=
this.resultJSON[k].components[t][g];var n=!0}if(!n&&f._params)for(k in f._params)f._params[k]=f._params[k].default;var q=this.resultJSON[this.currentPage].components.length;if(b)for(k in this.resultJSON[this.currentPage].components)this.resultJSON[this.currentPage].components[k]._id==b.item&&(q="before"==b.where?k:parseFloat(k)+1);var u=this.uniqNum();(a=e.applyFilter("addComponent",c.extend(!0,f,{_name:a,_id:u}),n,d))&&"function"===typeof a.then?a.then(function(a){e.resultJSON[e.currentPage].components.splice(q,
0,a);p()},function(a){e.render(void 0);l.reject()}):(e.resultJSON[e.currentPage].components.splice(q,0,a),p());return l.promise()}},getComponent:function(a,b,d){b=b||this.currentPage;for(var p in this.resultJSON[b].components)if(this.resultJSON[b].components[p]._id==a)return d?(p=c.extend(!0,{},this.resultJSON[b].components[p]),delete p._id,delete p._group):p=this.resultJSON[b].components[p],this.applyFilter("getComponent",p,a,b,d);return this.applyFilter("getComponent",!1,a,b,d)},getNextComponent:function(a,
b){b=b||this.currentPage;var d,c;for(c in this.resultJSON[b].components){if(d)return this.applyFilter("getNextComponent",this.resultJSON[b].components[c],a,b);this.resultJSON[b].components[c]._id==a&&(d=!0)}return this.applyFilter("getNextComponent",!1,a,b)},getPrevComponent:function(a,b){b=b||this.currentPage;var d=!1,c;for(c in this.resultJSON[b].components){if(this.resultJSON[b].components[c]._id==a)return this.applyFilter("getPrevComponent",d,a,b);d=this.resultJSON[b].components[c]}return this.applyFilter("getPrevComponent",
!1,a,b)},removeComponent:function(a,b,d){b=b||this.currentPage;for(var c in this.resultJSON[b].components)if(this.resultJSON[b].components[c]._id==a){var e=this.getPrevComponent(a,b),f=this.getNextComponent(a,b),h=this.resultJSON[b].components[c]._name,k=this.$template.find("[data-app-component-id="+a+"]");this.fire("removeComponent",a,k,b);this.resultJSON[b].components.splice(c,1);b===this.currentPage&&(k.remove(),this.renderComponentsStyles());this.fire("removedComponent",a,e,f,b);if(d)for(var g in this.resultJSON)this.resultJSON[g].components.forEach(function(a,
b,d){a._name===h&&d.splice(b,1)});return!0}return!1},changeComponentPosition:function(a,b,d){var c=this.resultJSON[this.currentPage].components,e;for(e in c)if(c[e]._id==a){var f=c[e];c.splice(parseInt(e),1);break}if(void 0===b)c.splice(0,0,f);else for(e in c)if(c[e]._id==b){c.splice(parseInt(e)+1,0,f);break}this.fire("changedComponentPosition",a,d)},addComponentStyles:function(a,b,d,e){var l={},f=a.parents("[data-app-component-id]:eq(0)").attr("data-app-component-id"),h=this.getComponent(f);l[b]=
d;if(h&&!this.applyFilter("preventComponentStylesSave",!1,h,a,b,d,e)){var k=a.attr("data-app-selector")||(a.hasClass("btn")?".btn":"")||a.prop("tagName");if("function"!==typeof h._onStylesChange||h._onStylesChange(a,b,d,k))a.parents("[data-app-selector]").each(function(){k=c(this).attr("data-app-selector")+" "+k}),"undefined"===typeof h._styles&&(h._styles={}),"undefined"===typeof h._styles[k]&&(h._styles[k]={}),c.extend(h._styles[k],l),e&&(h._styles[k].googleLink=e),h._styles=this.applyFilter("addComponentStyles",
h._styles,h,a,b,d,e),this.updateGlobalComponents(f,function(a,b){b._styles=a._styles}),this.renderComponentsStyles()}},getComponentStyles:function(){var a=function(){function a(a){this._googleLinks=this._rules="";a&&this._compile(a,0)}a.prototype._compile=function(a,b){for(var c="",d=0;d<b;d++)c+="  ";for(var e in a)d=a[e],"object"==typeof d?(this._rules+=c+e+" {\n",this._compile(d,b+1),this._rules+=c+"}\n"):"googleLink"===e?this._googleLinks+="@import url("+d+");\n":this._rules+=c+e+": "+d+";\n"};
a.prototype.getRules=function(){return this._rules};a.prototype.getGoogleLinks=function(){return this._googleLinks};return function(b){return new a(b)}}();return function(b,d){var c=b;"number"===typeof b&&(c=this.getComponent(b));b=a(c._styles);return this.applyFilter("getComponentStyles",{css:b.getRules(),google:d?b.getGoogleLinks():""},c,d)}}(),renderComponentsStyles:function(a,b,d){var e=this,l="",f="";b=b||this.currentPage;var h=this.resultJSON[b].components;a=a||!1;l=this.applyFilter("beforeRenderStyles",
l,h,a,b,f);if(d&&this.isSecondaryComponent(d)&&!a){var k=c.Deferred(),g=this.applyFilter("componentSelector","#"+d._anchor,d),r=this.getComponentStyles(d,a);less.render(this.applyFilter("beforeRenderStylesForComponent",g+" {\n"+r.css+"}\n",d),function(a,e){a?(k.reject(a),console.log("Error while page ("+b+") less render:",a)):(k.resolve(e),c('[data-app-component-id="'+d._id+'"] > style').html(e.css))});return k.promise()}for(var n in h)if(this.isSecondaryComponent(h[n])&&h[n]._cid&&!h[n]._customHTML)console.log((h[n]._name||
"The Block")+" is broken. Skip style rendering");else if(g=this.applyFilter("componentSelector","#"+h[n]._anchor,h[n]),r=this.getComponentStyles(h[n],a),a||!this.isSecondaryComponent(h[n]))less.render(l+"\n"+g+" {\n"+r.css+"}\n",function(a,c){a?e.APP.showError("The following error occured while creating the "+b+" page:<br>Less render in the "+h[n]._name+" block: "+a.message):(l+="\n"+g+" {\n"+r.css+"}\n",f+=r.google)});else{var q=c('[data-app-component-id="'+h[n]._id+'"]');q.find("> style").length||
q.append("<style/>");less.render(this.applyFilter("beforeRenderStylesForComponent",g+" {\n"+r.css+"}\n",h[n]),function(a,c){a?(e.APP.showError("The following error occured while creating the "+b+" page:<br>Less render in the "+h[n]._name+" block: "+a.message),q.find("> style").html("")):q.find("> style").html(c.css)})}less.render(l,function(a,c){a?console.log("Error while page ("+b+") less render:",a):l=c.css});if(a)return l=f+l,this.applyFilter("afterRenderStyles",l,h,a,b,f);m.html(this.applyFilter("afterRenderStyles",
l,h,a,b,f))},focusComponentBlock:function(a){var b=c('[data-app-component-id="'+a+'"]');if(!b.hasClass("focused")){var d=c("[data-app-component-id].focused");d.length&&e.fire("blurComponent",d.attr("data-app-component-id"));c("[data-app-component-id]").removeClass("focused");"x"!==a?b.addClass("focused"):(e.$body.find(".note-popover > *").attr("style","display: none;"),e.$body.find(".sp-container").addClass("sp-hidden"),e.$body.find(".sp-replacer").css("visibility","hidden"));e.fire("focusedComponent",
"x"!=a&&a)}},getFocusedComponentBlockId:function(){return c("[data-app-component-id].focused").attr("data-app-component-id")},getComponentBlock:function(a){return c('[data-app-component-id="'+a+'"]').get(0)},convertComponentParams:function(a){a=c.extend(!0,{},a);var b={},d;for(d in a)c.isArray(a[d])?(b[d]={},"undefined"!==typeof a[d][0]&&(b[d].type=a[d][0]),"undefined"!==typeof a[d][1]&&(b[d].title=a[d][1]),"undefined"!==typeof a[d][2]&&(b[d].default=a[d][2]),"undefined"!==typeof a[d][3]&&(b[d].values=
a[d][3])):b[d]=a[d];return b},getComponentParams:function(a,b){b=this.getComponent(a,!1,!b);var c=this.convertComponentParams("secondary"==e.theme.type&&e.isSecondaryComponent(b)?b._params:this.components[b._name]._params);return this.applyFilter("getComponentParams",{current:b._params,"default":c},a)},changeComponentParams:function(a,b,d){function e(a,b,d,e){if(h)if(c.isArray(a[b])&&"object"===typeof a[b][Object.keys(a[b])[0]])for(var f in d)c.extend(a[b][f],d[f]);else c.extend(a[b],d);else a[b]=
d;e&&c.extend(a,e)}var l=this.getComponent(a),f=l._params,h=!1,k=this.$template.find("[data-app-component-id="+a+"] > .app-component-content");this.fire("changeComponentParams",a,b,d);if(b){"bgImage"!==b&&"parallax"!==b&&"bgImageRadio"!==b||k.trigger("destroy.parallax");if("object"==typeof d){var g=0,m=0,n;for(n in f[b])g++;for(n in d)m++;h=m<=g}d=this.applyFilter("changeComponentParams",d,b,f,a);e(f,b,d);this.updateGlobalComponents(a,function(a,c){e(c._params,b,d,a._params)})}"undefined"!==typeof l._onParamsChange&&
l._onParamsChange(k,b,d);this.fire("changedComponentParams",a,b,d)},getComponentsAnchorList:function(a,b){var c="",g=1,l;for(l in this.resultJSON[b||this.currentPage].components){var f=this.resultJSON[b||this.currentPage].components[l],h="";a=="#"+f._anchor&&(h='selected="selected"',g=1);if("undefined"!==typeof f._anchor&&!f._positionAbsolute&&!f._alwaysBottom){f.alias&&e.APP.getAddonDir(f.alias);var k=f.alias;var m=f._sourceTheme;k=k?e.APP.getAddonDir(k)+"/"+f._name+"/thumb.png":m?/^mobirise5|startm5$/.test(m)?
e.Bridge.path2app(e.APP.getAddonDir(m))+"/components/"+f._name+"/thumb.png":e.APP.getAddonDir(m)+"/components/"+f._name+"/thumb.png":e.theme.path+"/components/"+f._name+"/thumb.png";m=0===f._anchor.indexOf(f._name+"-")?f._anchor.charAt(0).toUpperCase()+f._anchor.slice(1).replace(/\d/," $&"):f._anchor;c+='<option data-tooltipster="right" data-tooltip-src="'+k+'" value="'+(b||this.currentPage)+"#"+f._anchor+'" '+h+">"+m+"</option>"}}c=this.applyFilter("getComponentsAnchorList",'<option value="'+(b||
"")+'#top" '+("top"==a?'selected="selected"':"")+">Top of Page</option>"+c+'<option value="'+(b||"")+'#bottom" '+("top"==a?'selected="selected"':"")+">Bottom of Page</option>",a);return'<option value="" disabled="disabled" '+(g?'selected="selected"':"")+"></option>"+c},updateGlobalComponents:function(a,b){var c=this.getComponent(a);if(c._global)for(var g in this.resultJSON)for(var l in this.resultJSON[g].components)this.resultJSON[g].components[l]._global&&(c._sourceTheme||this.resultJSON[g].components[l]._sourceTheme?
this.resultJSON[g].components[l]._sourceTheme==c._sourceTheme:1)&&this.resultJSON[g].components[l]._name==c._name&&this.resultJSON[g].components[l]._id!==c._id&&b&&b(c,this.resultJSON[g].components[l]);e.fire("updateGlobalComponents",a,b)}},events:{changeComponentPosition:function(a,b,c){this.changeComponentPosition(a,b,c)},rendered:function(a){this.renderComponentsStyles();"number"===typeof a&&g.call(this,a)}}})})(jQuery,mbrAppCore);
