var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var f=0;return function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,d){a!=Array.prototype&&a!=Object.prototype&&(a[f]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,f){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(d){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(d||"")+"_"+f++,d)}var f=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,f){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var c=d++;return{value:f(c,a[c]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,f,d,e){if(f){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var c=a[e];c in d||(d[c]={});d=d[c]}a=a[a.length-1];e=d[a];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Object.is",function(a){return a?a:function(a,d){return a===d?0!==a||1/a===1/d:a!==a&&d!==d}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,d){var e=this;e instanceof String&&(e=String(e));var c=e.length;d=d||0;for(0>d&&(d=Math.max(d+c,0));d<c;d++){var b=e[d];if(b===a||Object.is(b,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,f,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6","es3");
$jscomp.findInternal=function(a,f,d){a instanceof String&&(a=String(a));for(var e=a.length,c=0;c<e;c++){var b=a[c];if(f.call(d,b,c,a))return{i:c,v:b}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
defineM("app-plugin-github",function(a,f,d){"android"!=Bridge.getPlatform()&&f.regExtension({name:"github",global:{gitHubSendRequest:function(e,c,b,f,d){var g=a.Deferred();Bridge.http("https://api.github.com/"+e,{method:f||"GET",timeout:d||5E3,data:c?JSON.stringify(c):"",success:function(a,b,e){if(401==b.status||422==b.status||404==b.status)g.reject();else if(204==b.status)g.resolve();else try{a=JSON.parse(a),g.resolve(a)}catch(v){g.reject("error parsing response")}},error:function(a,b){g.reject(b)},
headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36",Authorization:"token "+b.code}});return g.promise()},gitHubGetUserInfo:function(a,c){return f.gitHubSendRequest(a?"users/"+a:"user","",c)},gitHubGetUserReps:function(a,c){return f.gitHubSendRequest(a?"users/"+a+"/repos":"user/repos","",c)},gitHubCreateRep:function(a,c,b,d){return f.gitHubSendRequest("user/repos",{name:a,homepage:b,description:c,auto_init:!0},
d,"POST")},gitHubCreateFile:function(a,c,b,d,k,h){b=btoa(b);return f.gitHubSendRequest("repos/"+d+"/"+k+"/contents/"+a,{message:c,content:b},h,"PUT")},gitHubCreateBlob:function(a,c,b,d,k){return f.gitHubSendRequest("repos/"+c+"/"+b+"/git/blobs",{encoding:k?k:"base64",content:a},d,"POST",15E3)},gitHubGetContent:function(a,c,b,d,k){return f.gitHubSendRequest("repos/"+c+"/"+b+"/contents/"+a,"",k,"GET")},gitHubGetReference:function(e,c,b,d){var g=new a.Deferred;f.gitHubSendRequest("repos/"+e+"/"+c+"/git/refs/"+
b,"",d,"GET").done(function(a){a.object?g.resolve(a):f.gitHubGetReference(e,c,"heads/main",d).done(function(a){return f.gitHubCreateReference(a.object.sha,e,c,"refs/"+b,d)}).done(function(a){g.resolve(a)}).fail(function(){g.reject()})}).fail(function(a){-1==b.indexOf("main")?f.gitHubGetReference(e,c,"heads/main",d).done(function(a){return f.gitHubCreateReference(a.object.sha,e,c,"refs/"+b,d)}).done(function(a){g.resolve(a)}).fail(function(){g.reject()}):g.reject(a)});return g},gitHubGetCommit:function(a,
c,b,d){return f.gitHubSendRequest("repos/"+a+"/"+c+"/git/commits/"+b,"",d,"GET")},gitHubUpdateFile:function(a,c,b,d,k,h,l){b=btoa(b);return f.gitHubSendRequest("repos/"+k+"/"+h+"/contents/"+a,{message:c,content:b,sha:d},l,"PUT")},gitHubCreateTree:function(a,c,b,d,k){return f.gitHubSendRequest("repos/"+b+"/"+d+"/git/trees",{base_tree:a,tree:c},k,"POST")},gitHubCreateCommit:function(a,c,b,d,k,h){return f.gitHubSendRequest("repos/"+d+"/"+k+"/git/commits",{message:a,tree:c,parents:b},h,"POST")},gitHubUpdateReference:function(a,
c,b,d,k){return f.gitHubSendRequest("repos/"+c+"/"+b+"/git/refs/"+d,{sha:a},k,"PATCH")},gitHubCreateReference:function(a,c,b,d,k){return f.gitHubSendRequest("repos/"+c+"/"+b+"/git/refs",{ref:d,sha:a},k,"POST")},gitHubCheckCred:function(a,c){return f.gitHubGetUserInfo(null,a)},gitHubCheckRepository:function(d,c){var b=a.Deferred();f.gitHubGetUserReps(null,c).then(function(a,c,f){a.some(function(a,b,c){return a.name===d})?b.resolve(!0):b.resolve(!1)}).fail(function(a){b.reject(a)});return b},gitHubCreateAuthorization:function(e,
c){var b=new a.Deferred;Bridge.getSettings("gitHub/"+c.name,function(e){var g=new a.Deferred,h=function(){var b='<div class="row">         <div class="col-lg-6">\t\t\t<label>'+d("GitHub UserName")+'</label>\t\t\t<input type="text" class="form-control" name="gitHubUser" value="'+c.name+'">\t\t  </div>\t\t  <div class="col-lg-6">\t\t\t<label>'+d("GitHub Token")+' </label> <a class="gh-token-help" href="#">[?]</a>\t\t\t<input type="password" class="form-control" name="gitHubPass">\t\t  </div>\t\t</div>           <span class = "gp-about-new">'+
d("You can create GitHub Account %here%").replace(/%(.+)%/,'<a class="gp-link" href="https://github.com/join">$1</a>')+"</span>";f.showDialog({title:d("Enter your credentials"),className:"github",body:b,oncancel:function(){g.reject()},buttons:{gitOK:{label:d("\u041e\u041a"),default:!0,callback:function(){var b={name:a('[name="gitHubUser"]').val().trim(),code:a('[name="gitHubPass"]').val().trim()};f.gitHubCheckCred(b).done(function(a){g.reject(b)}).fail(function(a){h()})}}},show:function(){a(".gh-token-help").on("click",
function(a){a.preventDefault();a.stopPropagation();f.openUrl("https://mobirise.com/help/GitHub-publish-371.html")})}}).on("shown.bs.modal",function(){a(this).on("click","a",function(b){b.preventDefault();b.stopPropagation();f.openUrl(a(b.target).attr("href"))})})};e?Bridge.decode(e,function(a){a?(c.code=a,f.gitHubCheckCred(c).done(function(b){console.log(b);g.resolve(a,c.name)}).fail(function(){h()})):h()}):h();g.then(function(a,c){b.resolve(a,c)},function(a){a?b.resolve(a.code,a.name):b.reject()})});
return b},gitHubCreatePagesRepo:function(d,c){var b=a.Deferred();f.gitHubCheckRepository(d,c).then(function(a){a?b.resolve(!1):f.gitHubCreateRep(d,"GitHub Pages","github.com",c).then(function(){b.resolve(!0)})},function(a){b.reject(a)});return b},gitHubUploadFiles:function(d,c,b,g){var e,h=g.name,l,m,p=a.Deferred();f.gitHubCreatePagesRepo(c,g).then(function(a){return f.gitHubGetReference(h,c,b,g)}).then(function(a){e=a.object.sha;return f.gitHubGetCommit(h,c,e,g)}).then(function(a){a=a.tree.sha;var b=
[];d.map(function(a){a.data||""===a.data?b.push({path:a.name,mode:"100644",type:"blob",content:a.data,encoding:"base64"}):b.push({path:a.name,mode:"100644",type:"blob",sha:a.sha})});return f.gitHubCreateTree(a,b,h,c,g)}).then(function(a){l=a.sha;return f.gitHubCreateCommit("create github pages",l,[e],h,c,g)}).then(function(a){m=a.sha;return f.gitHubUpdateReference(m,h,c,b,g)}).then(function(a){p.resolve()}).fail(function(a){p.reject(a)});return p},uploadToGit:function(e,c,b){var g=!1,k=[],h=["github"];
if(!c&&!e)return h;if(!(0>h.indexOf(e.split(":")[0]))){var l=e.split("github://").pop();e=l.split("/")[0].trim();var m=l.split("/")[1].trim(),p=m?m:e+".github.io",v=m?"heads/gh-pages":"heads/main",t=0;m&&Bridge.setSettings("gitHubLastPath",m);b.onStart(c.length);l={name:e,code:""};f.gitHubCreateAuthorization(["repo"],l).done(function(e,h){l.name=h;Bridge.encode(e,function(a){Bridge.setSettings("gitHub/"+l.name,a);Bridge.setSettings("gitHubLast",l.name)});l.code=e;f.gitHubCreatePagesRepo(p,l).then(function(){function e(d){function m(a,
c,g,k){b.onFile(g);f.gitHubCreateBlob(a,c.name,p,c,k?"utf-8":"base64").then(function(a){h.push({name:g,sha:a.sha});b.onUploaded(g);e(d)}).fail(function(){t++;e(d)})}if(g){var q=setTimeout(e.bind(this,d),500);k[d]=q}else{if(w>=c.length&&(u--,0>=u))return x.resolve();var n=c[w++];if(n&&Object.keys(n).includes("srcList")&&1===n.srcList.length){var y=n.dest;q=n.srcList[0];var r=q.src;q.filter?(q=b.onData(r),m(q,l,y,"utf-8")):Bridge.loadLocalBase64(r,function(a){m(a,l,y)})}else n&&Object.keys(n).includes("srcList")&&
function(){var d=n.dest,c="",e=a.Deferred(),f=[];n.srcList.forEach(function(d){var e=a.Deferred();f.push(e);var g=d.src;(function(a){a?(c+=b.onData(g),e.resolve()):Bridge.loadLocalFile(g,function(a){c+=a;e.resolve()})})(d.filter?!0:!1)});a.when.apply(a,f).then(function(){e.resolve(c,d)});return e}().then(function(a,b){m(a,l,b,"utf-8")})}}for(var h=[],w=0,x=a.Deferred(),u=4,r=0;r<u;r++)e(r);x.then(function(){var b=new a.Deferred;f.gitHubUploadFiles(h,p,v,l).then(function(){0==t?b.resolve():b.reject()}).fail(function(){b.reject()});
return b}).then(function(){var a="https://"+l.name+".github.io/"+(m?m+"/":"");bootbox.dialog({className:"github",message:'<div class="congrats-modal text-center">\n                                        <br>\n                                        <h3 class="title">\n                                            <span><b>'+d("Congratulations!")+"</b></span>\n                                        </h3>\n                                        <br>\n                                        <div>"+
d("Your site is published. Note that it takes a while for Github Pages to show updated content.")+'</div>\n                                        <span><a class="congrats-site-link" href="'+a+'" target="_blank">'+a+'</a></span>\n                                        <button class="btn btn-primary" id="viewSite">View Site</button>\n                                    </div>',buttons:{cancel:{label:d("ok"),className:"btn-primary"}}}).on("hidden.bs.modal",function(){b.onClose()}).on("click","#viewSite",
function(){b.onClose(a)})}).fail(function(){f.showDialog({title:d("Error"),className:"github",body:t+" "+d("error(s) occured while uploading files to GitHub.com. Do you want to open $link$ anyway?").replace("$link$"," <a>https://"+l.name+".github.io</a>"),buttons:{gitClose:{label:d("Cancel"),default:!0,callback:function(){b.onClose("error")}},gitOpen:{label:d("Open"),default:!1,callback:function(){b.onClose("https://"+l.name+".github.io/"+(m?m+"/":""))}}}})})})}).fail(function(a){b.onClose("error");
c="";e=d("Check your credentials and internet connection");if(a&&a.status){var c=a.statusText?a.statusText:a.status?a.status:"",e="";if(a.response)try{e=JSON.parse(a.response).message}catch(z){e=""}}b.onClose();f.showDialog({title:d("Error")+" "+c,className:"github",body:d("Error while connecting to Github.")+" "+e,buttons:{gitClose:{label:d("Close"),default:!0,callback:function(){}}}})});this.pause=function(){g=!0};this.resume=function(){g=!1};this.exit=function(){b.onClose();k.forEach(function(a){clearInterval(a)});
g=!1};return this}}},events:{createPublishModal:function(e){var c='<div class="publishMethod">\t\t  <div class="radio radio-primary publishRadio">\t\t\t<label>\t\t\t  <input type="radio" name="publishType" value="github"><span class="circle"></span><span class="check"></span>'+d("GitHub Pages")+'\t\t\t</label><a class="gp-help" href="#">[?]</a>\t\t  </div>\t\t  <div class="publishBody">\t\t\t<div class="row">\t\t\t  <div class="col-md-4">\t\t\t\t<input type="text" class="form-control" placeholder="'+
d("Account")+'" name="accountName">\t\t\t  </div>              <div class="col-md-2 gp-domain">.github.io/</div>\t\t\t  <div class="col-md-4">\t\t\t\t<div class="input-group">\t\t\t\t  <span class="input-group-btn input-wrapper">\t\t\t\t\t<input type="text" class="form-control" placeholder="['+d("folder")+']" name="gitPath">\t\t\t\t  </span>                 <div class="input-group-btn">\t\t\t\t\t<button class="btn btn-primary upload-github hidden" type="button">'+d("Upload")+'</button>\t\t\t\t  </div>\t\t\t\t</div>\t\t\t  </div>\t\t\t</div>           <span class = "gp-about">'+
d("You can create GitHub Account %here%").replace(/%(.+)%/,' <a class="gp-link" href="https://github.com/join">$1</a>')+"</span>\t\t  </div>\t\t</div>";"true"===f.appSettings.showGitHub?(e.find(".publishMethod").last().after(c),e.on("keypress",'[name="gitPath"]',function(a){var b=/[\w-]/g,c=String.fromCharCode(a.which);return 8==a.keyCode||37==a.keyCode||39==a.keyCode||b.test(c)?!0:!1}),e.on("paste",'[name="gitPath"]',function(a){a.preventDefault()}),c=f.projectSettings||{},void 0===c.gitHubPath||
null===c.gitHubPath?Bridge.getSettings("gitHubLastPath",function(a){null!=a&&e.find('.bootbox-body [name="gitPath"]').val(a)}):e.find('.bootbox-body [name="gitPath"]').val(c.gitHubPath),void 0===c.gitHubName||null===c.gitHubName?Bridge.getSettings("gitHubLast",function(a){"string"===typeof a&&e.find('.bootbox-body [name="accountName"]').val(a.split("@")[0])}):e.find('.bootbox-body [name="accountName"]').val(c.gitHubName.split("@")[0]),e.find(".gp-link").on("click",function(b){b.preventDefault();b.stopPropagation();
f.openUrl(a(this).attr("href"))}),e.find(".gp-help").on("click",function(a){a.preventDefault();a.stopPropagation();f.openUrl("https://mobirise.com/help/GitHub-publish-371.html")}),e.find('[name="accountName"]').on("change",function(a){a=a.target.value;Bridge.setSettings("gitHub/"+a,"");Bridge.setSettings("gitHubLast",a)}),e.find(".test-github").on("click",function(b){a(this).closest(".publishBody").find('[name="accountName"]').val().trim();a(this).closest(".publishBody").find('[name="token"]').val().trim()})):
e.find(".publishBody").each(function(){a(this).closest(".publishMethod").find(".publishRadio input").attr("checked")||a(this).css("display","none")})},load:function(){f.addFilter("publishIndex",function(a,c){c&&0==c.indexOf("github")&&"index.html"==a&&(a="/");return a});f.addFilter("publishProjectSettings",function(a,c){c&&(delete a.gitHubPath,delete a.gitHubName);return a});f.addFilter("getPublishUrl",function(a,c,b){"github"===c&&(c=b.find("[name=accountName]").val().trim(),b=b.find("[name=gitPath]").val().trim(),
a="github://"+c+"/"+b,f.projectSettings.gitHubName=c,f.projectSettings.gitHubPath=b);return a});Bridge.fileManagerAddUploader(f.uploadToGit)}}})},["jQuery","mbrApp","TR()"]);
