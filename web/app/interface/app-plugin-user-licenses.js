var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var g=a.length,f=0;f<g;f++){var d=a[f];if(c.call(b,d,f,a))return{i:f,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,g){if(c){b=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var f=a[g];f in b||(b[f]={});b=b[f]}a=a[a.length-1];g=b[a];c=c(g);c!=g&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");
defineM("user-licenses",function(a,c,b,g){var f=function(){function d(){this.state={shown:!1,modal:null,loading:!1,data:[],sites:[]}}d.prototype.renderLicenses=function(){function a(a,c){return function(b){var l=b.items[0]&&b.items[0].expiredDate,e=+new Date;return l?c?1E3*l<e:b.items[0].type===a&&1E3*l>=e:!1}}function c(a){if(!a.data.length)return"";switch(a.type){case "subscription":return"\n                            <label>"+b("Kits")+"</label>\n                            "+k(a.data);case "theme":return"\n                            <label>"+
b("Themes")+"</label>\n                            "+k(a.data);case "plugin":return"\n                            <label>"+b("Extensions")+"</label>\n                            "+k(a.data);case "site_plan":return"\n                            <label>"+b("Sites")+"</label>\n                            "+k(a.data);case "archive":return'\n                            <label class="collapsed" data-toggle="collapse" href="#archiveList">\n                                <span style="margin-right: 5px">'+
b("Expired")+'</span>\n                                <span class="user-license__expired-icon mbr-icon-angle-right"></span>\n                            </label>\n                            <div class="collapse" id="archiveList">\n                                '+k(a.data)+"\n                            </div>";default:return""}}function k(a){var c={year:"numeric",month:"long",day:"numeric"};return a.reduce(function(a,b){return a+=b.items.map(function(a){return'<div id="license-'+b.id+'" class="user-license">\n                            <div>\n                                <span>'+
("subscription"===a.type?a.paymentTitle:a.title)+"</span>\n                                "+("site_plan"===a.type?'<span class="user-license__domain"><a href="javascript:void(0)" dataHref="'+d(f.state.sites.items.find(function(c){return c.id===a.params.site.id}))+'">'+d(f.state.sites.items.find(function(c){return c.id===a.params.site.id}))+"</a></span>":"")+'\n                            </div>\n                            <div>\n                                <span class="user-license__expiration '+
g(a.expiredDate)+'">\n                                    '+(new Date(1E3*a.expiredDate)).toLocaleDateString("en-US",c)+"\n                                </span>\n                            </div>\n                        </div>"})},"")}function d(a){return a&&a.domains?a.domains[a.domains.length-1].name:""}function g(a){return a&&+new Date+6048E5>1E3*a?"expires":""}var f=this,h=this.state.data;if(!h.length)return'<span class="user-licenses-wrap__nolicense">'+b("No active licenses")+"</span>";var n=
{type:"subscription",data:h.filter(a("subscription"))},p={type:"theme",data:h.filter(a("theme"))},q={type:"plugin",data:h.filter(a("plugin"))},r={type:"site_plan",data:h.filter(a("site_plan"))},m={type:"archive",data:h.filter(a(null,!0))};n.data.forEach(function(a){m.data=m.data.filter(function(c){return c.items[0].name!==a.items[0].name})});return""+c(n)+c(p)+c(q)+c(r)+c(m)||'<span class="user-licenses-wrap__nolicense">'+b("No active licenses")+"</span>"};d.prototype.getPlansLicenses=function(){return this.state.data.filter(function(a){return"site_plan"===
a.items[0].type})};d.prototype.show=function(){var e=this;c.showDialog({title:b("User Licenses"),className:"app-user-licenses",body:'<div class="row"><div id="user-licenses-wrap" class="col-md-12"></div></div>',show:function(b){e.state.modal=b;c.fire("showUserLicenses",b);e.state.loading=!0;e.state.modal.find("#user-licenses-wrap").html(c.preloaderHTML);e.serverSync().then(function(){return e.getUserSites()}).then(function(a){e.state.sites=a;return e.renderLicenses()}).then(function(e){b.find("#user-licenses-wrap").html(e);
b.find("a[dataHref]").each(function(b,e){a(e).click(function(b){c.openUrl("https://"+a(e).attr("dataHref"))})})})},hide:function(){e.state.shown=!1;e.state.modal=null}});this.state.shown=!0};d.prototype.close=function(){this.state.shown&&this.state.modal&&(this.state.shown=!1,this.state.modal.remove(),this.state.modal=null)};d.prototype.serverSync=function(){var b=this,d=a.Deferred();g.licenses().then(function(a){b.state.data=a;d.resolve(a)},function(a,b){d.reject(a);c.handleServerError(a,b)});return d};
d.prototype.getUserSites=function(){var b=a.Deferred();if(!c.domainManager)return b.resolve([]);c.domainManager.api.get("/me/sites").then(function(a){b.resolve(a)});return b};return d}();c.regExtension({name:"user-licenses",global:{userLicenses:new f},events:{initAccountSettings:function(a){a.find("#app-settings-btn").after('<div class="hover-block" id="app-user-licenses"><label>'+b("Licenses")+"</label></div>")},load:function(){a("#app-user-licenses").click(function(){c.userLicenses.show()})},loaded:function(){c.userLicenses.serverSync()}}})},
["jQuery","mbrApp","TR()","mbrServer"]);
