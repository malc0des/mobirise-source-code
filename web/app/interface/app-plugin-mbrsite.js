var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,f){a instanceof String&&(a=String(a));for(var h=a.length,n=0;n<h;n++){var q=a[n];if(b.call(f,q,n,a))return{i:n,v:q}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,f){a!=Array.prototype&&a!=Object.prototype&&(a[b]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,f,h){if(b){f=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var n=a[h];n in f||(f[n]={});f=f[n]}a=a[a.length-1];h=f[a];b=b(h);b!=h&&null!=b&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,f){if(null==a)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,a){var f=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var n=f.length,q=b.length;a=Math.max(0,Math.min(a|0,f.length));for(var t=0;t<q&&a<n;)if(f[a++]!=b[t++])return!1;return t>=q}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(f){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+b++,f)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,h={next:function(){if(f<a.length){var n=f++;return{value:b(n,a[n]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Object.is",function(a){return a?a:function(b,a){return b===a?0!==b||1/b===1/a:b!==b&&a!==a}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,a){var f=this;f instanceof String&&(f=String(f));var n=f.length;a=a||0;for(0>a&&(a=Math.max(a+n,0));a<n;a++){var q=f[a];if(q===b||Object.is(q,b))return!0}return!1}},"es7","es3");
$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,f){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,f||0)}},"es6","es3");$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var h="";a;)if(a&1&&(h+=b),a>>>=1)b+=b;return h}},"es6","es3");
defineM(function(a,b,f,h,n){function q(){b.$projectName.each(function(c,e){c=a(e);c.closest(".navbar-url").length?(e=b.projectSettings.mbrsite)?(e=(new p(e)).getUrl(),c.html(b.escapeHtml(e)).addClass("navbar-domain").tooltipster("content",f("Change Site Domain"))):c.html(b.escapeHtml(b.projectSettings.name)).removeClass("navbar-domain").tooltipster("content",f("Change Site Name")):c.html(b.escapeHtml(b.projectSettings.name))})}var t="en",m={},u=function(){var b=a.Deferred();p.Api.get("/sites").then(function(a){b.resolve(a)},
function(a){b.reject("Error getting list of online sites. "+a)});return b.promise()},z=function(c){c.stopPropagation();var e=a(c.target).closest(".project-element");c=e.find(".project-domain").text();b.confirmDlg(f("There is no local copy of the site, do you want to download it from $url$?").replace("$url$",'<a href="#" class="mbrsite-delete-link">'+c+"</a>"),function(c){if(c){var g=a(b.preloaderHTML).appendTo(".show-site-list-modal").on("click",function(a){a.stopPropagation()});h.initProject(function(c,
d){if(!c&&d&&d.path){var k=e.attr("site-id"),l=e.attr("site-domain"),y=d.path+"/project.mobirise";p.Api.get("/sites/"+k+"/files/").then(function(c){if(c&&c.contents&&c.contents.length){var e=function(b){var c=a.Deferred(),g="https://r.mobirisesite.com/"+k+"/"+b;h.download3(g,{callback:function(a){a&&"Incorrect status code"!==a?h.moveLocal(a,d.path+"/"+b,function(a){a?c.resolve():c.reject("error getting file: "+g)}):c.reject("error getting file: "+g)}});return c.promise()};c=c.contents.filter(function(a){return a.startsWith("assets/images/")||
"project.mobirise"===a});a.when.apply(a,c.map(function(a){return e(a)})).then(function(){return $Bridge.getLocalJSON(y)},function(a){console.error(a)}).then(function(a){if(a){var c=new p({id:k,domain:l,protocol:"mbrsite"});a.settings.mbrsite=c.toString();delete a.settings.screenshot;b.runSaveProject(function(c){c||console.error("Error: unable to save current project");b.loadProject(y,a,{onError:function(a){b.showError(f("Error loading project")+": "+a);g.remove()},onDone:function(){b.closeSidebar();
g.remove()}})},!1)}else g.remove()},function(a){b.showError(f("Error loading project")+": "+a);g.remove()})}else b.showError(f("Can't download the site because it was published incorrectly.")),g.remove()})}else b.showError(f("Unable to init project")),g.remove()})}}).find(".mbrsite-delete-link").click(function(a){b.openUrl(a.target.textContent)})},A=function(c){c.stopPropagation();var e=a(b.preloaderHTML).on("click",function(a){a.stopPropagation()}),d=a(c.target).closest(".project-element"),g=d.attr("site-id");
c=d.attr("site-domain");var k=new p({id:g,domain:c,protocol:"mbrsite"});c=b.confirmDlg({message:f("Do you want to remove the domain $domain$? Your site will be completely removed from the Web.").replace("$domain$",'<a href="#" class="mbrsite-delete-link">'+b.escapeHtml(k.get("domain"))+"</a>").replace("?","?<br>"),callback:function(a){a&&(e.appendTo(".show-site-list-modal"),k.delete().then(function(){d.remove();for(var a=0;a<m.items.length;a++)if(m.items[a].id===parseInt(g)){m.items.splice(a,1);--m.count;
break}},function(a){b.showError(f("Error removing site")+": "+a)}).always(function(){e.remove()}))},buttons:{cancel:{label:f("Cancel")},confirm:{label:f("Remove")}}});c.find(".modal-footer .btn-primary").removeClass("btn-primary").addClass("btn-danger");c.find(".mbrsite-delete-link").click(function(){b.openUrl(k.getUrl())})},w=function(){function a(b){b||(b={});this.content=b.content||"";this.encoding=b.encoding||"utf8";this.sourcePath=b.sourcePath||null;Object.defineProperty(this,"size",{get:function(){return a.size(this)}})}
a.size=function(a){var b=a.content.length;if(0==a.encoding.indexOf("base64")){if(!b||b%4)return 0;a=atob(a.content.substr(-4));return 3*(b/4-1)+a.length}return"utf8"==a.encoding?b+(encodeURIComponent(a.content).match(/%[89ABab]/g)||[]).length:b};return a}(),B={readFile:function(b,e){var c=a.Deferred();e||(e={});e.encoding||(e.encoding="base64");if(e.templating)c.resolve(new w({content:h.templating(b),encoding:"utf8",sourcePath:b}));else h["base64"==e.encoding?"loadLocalBase64":"loadLocalFile"](b,
function(a){c.resolve(new w({content:a,encoding:e.encoding,sourcePath:b}))});return c.promise()}},p=function(){function c(){return n.jwt().then(null,function(c,k){b.handleServerError(c,k);return a.Deferred().reject(Error(c)).promise()})}function e(b){return n.get("sites/"+b+"/licenses").then(function(a){for(var b={},c=0;c<a.length;c++)a[c].isExpired||a[c].plan.features.forEach(function(a){return b[a]=1});return Object.keys(b)},function(b){console.error(b);return a.when([])})}function d(b){"string"==
typeof b?b=d.parseString(b):b||(b={});this.fs=new C({site:this});this.id=null;this.attrs={};this.set(a.extend({protocol:"site"},b))}d.parseString=function(b){return(b=b.match(/^([-a-z0-9]+):\/\/(.*)$/i))?a.extend(JSON.parse(decodeURIComponent(b[2])),{protocol:b[1]}):{}};d.Api={_request:function(b,e){return c().then(function(c){var g=a.Deferred();b||(b={});"string"==typeof b&&(b={path:b});b.headers=a.extend({"X-App":h.appName+"/"+h.version,Authorization:"Bearer "+c,"Accept-Language":t},b.headers||
{});if(b.dataType)switch(c=String(b.dataType),c.toLowerCase()){case "json":b.data=JSON.stringify(b.data);b.headers["Content-Type"]="application/json";break;default:return g.reject(Error('Unknown dataType: "'+c+'".')).promise()}e&&a.extend(!0,b,e);h.http("https://api.mobirisesite.com/v1"+(b.path||"/"),{method:b.method||"GET",timeout:b.timeout||3E4,data:b.data||"",headers:b.headers,success:function(b,c){try{b=JSON.parse(b),400<=c.statusCode?g.reject(a.extend(Error(b.message),{code:c.statusCode})):g.resolve(b)}catch(G){g.reject(Error(f("Incorrect server response."))),
console.log("Incorrect server response:",b)}},error:function(a){g.reject(Error(a))}});return g.promise()})},request:function(a){return this._request(a)},get:function(a){return this._request(a,{method:"GET"})},post:function(a){return this._request(a,{method:"POST"})},put:function(a){return this._request(a,{method:"PUT"})},delete:function(a){return this._request(a,{method:"DELETE"})}};d.prototype.set=function(a,b){if("object"==typeof a)for(a in b=a,b)this.set(a,b[a]);else this.attrs[a]=b,"id"===a&&
(this.id=b);return this};d.prototype.get=function(a){return this.attrs[a]};d.prototype.getUrl=function(){return b.domainManager&&b.domainManager.siteId===this.id&&b.domainManager.isConnected&&b.domainManager.isReady?"https://"+b.domainManager.getCustomDomainInfo().name:"https://"+this.attrs.domain};d.prototype.toString=function(){return this.attrs.protocol+"://"+encodeURIComponent(JSON.stringify(this))};d.prototype.toJSON=function(){return{id:this.id,domain:this.attrs.domain}};d.prototype.save=function(c){c=
a.extend(this.toJSON(),c||{});return b.getSubdomain(c.domain)?this.id?d.Api.put({path:"/sites/"+this.id,data:c,dataType:"json"}).then(this.set.bind(this)):d.Api.post({path:"/sites",data:c,dataType:"json"}).then(this.set.bind(this)):a.Deferred().reject(Error(f("Incorrect domain name."))).promise()};d.prototype.delete=function(){return d.Api.delete({path:"/sites/"+this.id}).then(function(){this.set("id",null)}.bind(this))};d.prototype.isAvailableFeature=function(a){return e(this.id).then(function(b){return b.includes(a)})};
return d}(),C=function(){function b(b){a.extend(this,b||{})}b.prototype.deleteFile=function(b){return this.site.id?p.Api.delete("/sites/"+this.site.id+"/files/"+b):a.Deferred().reject(Error("Unable to delete file.")).promise()};b.prototype.uploadFile=function(b,c){if(!this.site.id)return a.Deferred().reject(Error("Unable to upload file.")).promise();if(6E6<c.size)return a.Deferred().reject(Error(f("File too large")+": "+b)).promise();var e={};"utf8"!=c.encoding&&(e["X-Payload-Encoding"]=c.encoding);
return p.Api.post({path:"/sites/"+this.site.id+"/files/"+b,data:c.content,headers:e})};return b}(),x=function(c){c||(c={});c.pipes||(c.pipes=[]);var e=function(){return function(){for(var a=Math.floor((new Date).getTime()/1E3),b="";0<a;)b="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(a%62)+b,a=(a-a%62)/62;return b}}();return function(d,g,k){if(0==d.indexOf(c.name+"://")){k.onStart(g.length);var l=new p(d),r=new x.Stream(g);d={ver:e(),site:l,stream:r};for(g=0;g<c.pipes.length;g++)r.pipe(c.pipes[g].bind(d));
r.pipe(function(a){k.onFile(a.destPath);return l.fs.uploadFile(a.destPath,a).then(function(){k.onUploaded(a.destPath)})}).done(function(){bootbox.dialog({className:"mbrsite",message:'<div class="congrats-modal text-center">\n                                <br>\n                                <h3 class="title">\n                                    <span><b>'+f("Congratulations!")+"</b></span>\n                                </h3>\n                                <br>\n                                <div>"+
f("Your site is published and live online:")+'</div>\n                                <span><a class="congrats-site-link" href="'+l.getUrl()+'" target="_blank">'+l.getUrl()+'</a></span>\n                                <button class="btn btn-primary" id="viewSite">View Site</button>\n                                <br>\n                                '+(b.domainManager&&!0===b.domainManager.isConnected?"":'<div class="separator">\n                                            <h3>'+f("Next:")+"</h3>\n                                            <div>"+
f("Edit your site online:")+'</div>\n                                            <span><a href="'+l.getUrl()+'/edit/" target="_blank">'+l.getUrl()+'/edit/</a></span>\n                                            <button class="btn btn-primary" id="editSite">Edit Site</button>\n                                        </div>\n                                        <div class="item mbrsite-domain-control">\n                                            <span>'+f("Connect your own domain")+"</span>\n                                            <br>\n                                            <span>"+
f("https://")+'</span>\n                                            <input id="custom-domain" type="text" placeholder="yourdomain.com" class="form-control">\n                                            <button class="btn btn-primary" id="connect-custom-btn">Connect</button>\n                                        </div>')+"\n                            </div>",buttons:{cancel:{label:f("ok"),className:"btn-primary"}}}).on("hidden.bs.modal",function(){k.onClose()}).on("click","#viewSite",function(){k.onClose(l.getUrl())}).on("click",
"#editSite",function(){k.onClose(l.getUrl()+"/edit/")}).on("click","#connect-custom-btn",function(a){k.onClose()});b.fire("endUploader")}).fail(function(a){k.onError(a.message)});return a.extend(r.control(),{exit:function(){r.pause();k.onClose()}})}}};x.Stream=function(){function b(b){a.extend(this,{_pos:0,_list:b||[],_funcs:{pipe:[],done:[],fail:[this.pause.bind(this)]},_timeout:setTimeout(this.resume.bind(this),0),_isPaused:!0})}b.isBinaryFile=function(a){return 1!=a.length||a[0].filter?!1:!/\.(html|xml|css|map|less|js|json|mobirise)$/.test(a[0].src)};
b.prototype._next=function(){if(this._pos>=this._list.length)this._funcs.done.forEach(function(a){a()});else{var c=this._list[this._pos++],d=c.srcList,g=b.isBinaryFile(d);d=a.when.apply(a,d.map(function(a){return B.readFile(a.src,{encoding:g?null:"utf8",templating:a.filter})})).then(function(){var a=[].slice.call(arguments);a=2>a.length?a[0]:new w({content:a.map(function(a){return a.content}).join(""),encoding:"utf8"});a.destPath=c.dest;return a});d=this._funcs.pipe.reduce(function(a,b){return a.then(b)},
d).then(function(){!this.isPaused()&&this._next()}.bind(this));this._funcs.fail.reduce(function(a,b){return a.fail(b)},d)}};b.prototype.isPaused=function(){return this._isPaused};b.prototype.pause=function(){clearTimeout(this._timeout);this._isPaused=!0;return this};b.prototype.resume=function(){this.isPaused()&&(this._isPaused=!1,this._next());return this};b.prototype.pipe=function(a){return this._funcs.pipe.push(a),this};b.prototype.done=function(a){return this._funcs.done.push(a),this};b.prototype.fail=
function(a){return this._funcs.fail.push(a),this};b.prototype.repeat=function(){0<this._pos&&this._pos--;return this.resume()};b.prototype.control=function(){return{pause:this.pause.bind(this),resume:this.resume.bind(this),repeat:this.repeat.bind(this)}};return b}();var D=function(){var a=/(\.png|\.jpe?g|\.gif|\/mbr-additional\.css)$/,b=/url\((["']?)(?:\.\.\/)*(assets\/.+?)\1\)/g,d=/(href|src)="(?:\.\.\/)*(assets\/.+?)"/g,g=/(href|src)=\\"(?:\.\.\/)*(assets\/.+?)\\"/g,f=/url\((["']?)(.+?)\1\)/g,l=
/(content)="(?:\.\.\/)*(assets\/.+?)"/g,r=/(href="data:application\/json,)(.*?)(?=")/g,h=/(tap:.+'images':\[')(.+?)']/g;return function(c){var e=this;switch(c.destPath.split(".").pop()){case "html":c.content=c.content.replace(d,function(b,c,d){b=a.test(d)?"?v="+e.ver:"";return c+'="https://r.mobirisesite.com/'+e.site.id+"/"+d+b+'"'}).replace(g,function(b,c,d){b=a.test(d)?"?v="+e.ver:"";return c+'=\\"https://r.mobirisesite.com/'+e.site.id+"/"+d+b+'\\"'}).replace(b,function(a,b,c){return"url("+b+"https://r.mobirisesite.com/"+
e.site.id+"/"+c+"?v="+e.ver+b+")"}).replace(h,function(b,c,d){b=a.test(d)?"?v="+e.ver:"";d="https://r.mobirisesite.com/"+e.site.id+"/"+d+b;return c+d+"']"}).replace(r,function(b,c,d){b=JSON.parse(decodeURIComponent(d));d=a.test(b.images)?"?v="+e.ver:"";b.images="https://r.mobirisesite.com/"+e.site.id+"/"+b.images+d;return c+encodeURIComponent(JSON.stringify(b))+'"'});c.content=c.content.replace(l,function(a,b,c){return b+'="https://r.mobirisesite.com/'+e.site.id+"/"+c+'"'});break;case "css":c.content=
c.content.replace(f,function(b,c,d){b=d;d=(/^(\.|https?:|data:)/.test(b)?"":"./")+b;"."==d.charAt(0)&&a.test(d)&&(d+="?v="+e.ver);return"url("+c+d+c+")"})}switch(c.destPath){case "manifest.json":c.content=c.content.replace("assets/icons/512x512.png","https://r.mobirisesite.com/"+e.site.id+"/assets/icons/512x512.png");break;case "sw.js":c.content=c.content.replace("importScripts('assets/sw-toolbox.js')","importScripts('https://r.mobirisesite.com/"+e.site.id+"/assets/sw-toolbox.js');")}return c}}(),
E=function(a){return"utf8"==a.encoding&&6E6<a.size?$Bridge.gzipBase64(a.content).then(function(b){a.content=b;a.encoding="base64-gzip";return a}):a},F=function(c){return b.applyFilter("mbrsiteUploadFile",a.when(c))},v=a('<h3 class="project-label project-domain text-primary"></h3>');b.regExtension({name:"mbrsite",global:{isAvailableFeature:function(a){var c=b.projectSettings||(b.projectSettings={});a=c.mbrsite?(new p(c.mbrsite)).isAvailableFeature(a):!1;return a}},events:{createPublishModal:function(a){if(!b.accountMode.isOffline()){var c=
b.domainManager?b.domainManager.getCustomDomainInfo()?b.domainManager.getCustomDomainInfo().name:"*.mobirisesite.com":"Mobirise";c='<div class="publishMethod mbrsite-publish-settings mbrsite-wrapper"><div class="radio radio-primary publishRadio"><label><input type="radio" name="publishType" value="mbrsite" checked><span class="circle"></span><span class="check"></span>'+c+'</label></div><div class="publishBody"><div class="row"><div class="col-md-4"><input type="text" class="mbrsite-domain form-control" placeholder="name" name="mbrsiteDomain"></div><div class="col-md-2 gp-domain">.mobirisesite.com</div><div class="col-md-4"></div></div><span class="mbrsite-input-status">IMPORTANT! Use this option for testing only</span></div></div>';
a.find(".publishMethod:first").before(c);c=b.projectSettings&&b.projectSettings.mbrsite;a.find('input[name="mbrsiteDomain"]').val(c?b.getSubdomain(p.parseString(c).domain):b.getUID(10).toLowerCase());b.domainManager&&b.domainManager.checkPublishTemplate(a)}},loaded:function(){var c=this;b.addFilter("getPublishUrl",function(e,d,f){if("mbrsite"===d){var g=b.projectSettings||(b.projectSettings={}),l=new p(g.mbrsite||{protocol:"mbrsite"});return(!g.mbrsite||c.$codeEditor?a.when():l.isAvailableFeature("RemoveAdvertising").then(function(a){Object.defineProperty(g,
"removeAdvertising",{writable:!0,enumerable:!1,configurable:!0,value:a})})).then(function(){var c=a(b.preloaderHTML).css({opacity:.8,borderRadius:"8px"}),d=b.withSubdomain(f.find('input[name="mbrsiteDomain"]').val().trim());f.find(".modal-content").before(c);return l.save({domain:d}).then(null,function(b){return 404===b.code?l.set("id",null).save({domain:d}):a.Deferred().reject(b).promise()}).then(function(){f.modal("hide");g.mbrsite!==l.toString()&&(g.mbrsite=l.toString(),b.runSaveProject(null,!0));
u().then(function(a){m=a},function(a){console.error(a)});return l.toString()},function(a){a&&f.find(".mbrsite-publish-settings").addClass("mbrsite-domain-error").end().find(".mbrsite-input-status").html(a.message)}).always(function(){c.remove()}).promise()})}return e})},load:function(){b.addFilter("removeProject",function(c,e){return c.then(function(){return $Bridge.getLocalJSON(e+"/project.mobirise")}).then(function(c){var d=a.Deferred();if(c=c&&c.settings&&c.settings.mbrsite){var e=new p(c),l=e.id;
c=b.confirmDlg({message:f("Do you want to remove the domain $domain$? Your site will be completely removed from the Web.").replace("$domain$",'<a href="#" class="mbrsite-delete-link">'+b.escapeHtml(e.get("domain"))+"</a>").replace("?","?<br>"),callback:function(c){if(c){var g=a(b.preloaderHTML).appendTo(".show-site-list-modal").on("click",function(a){a.stopPropagation()});e.delete().then(function(){for(var a=0;a<m.items.length;a++)if(m.items[a].id===parseInt(l)){m.items.splice(a,1);--m.count;break}},
function(a){b.showError(f("Error removing site")+": "+a)}).always(function(){g.remove();d.resolve()})}else{c=b.$body.find(".show-site-list-modal .site-list .project-element").eq(0);var k=c.clone(),r=e.getUrl(),h=e.get("domain");k.attr({"site-id":l,"site-domain":h}).find(".project-element-panel").removeClass("active").addClass("project-remote").find(".project-img").addClass("project-img-icon").html('<i class="mbr-icon-globe-with-americas-shown"></i>').end().find(".project-name").text(b.getSubdomain(h)).end().find(".btn-group > .btn:not(.app-project-remove)").remove();
k.find(".project-domain").length?k.find(".project-domain").text(r):(h=v.clone(),h.text(r),k.find(".project-name").after(h));c.after(k);k.find(".project-domain").on("click",function(a){a.stopPropagation();b.openUrl(a.target.textContent)});k.find(".project-remote").on("click",z);k.find(".app-project-remove").on("click",A).tooltipster({content:f("Remove Site"),delay:0,speed:100,position:"bottom"});d.resolve()}},show:function(a){a.one("keypress",function(b){a.find("[data-bb-handler='confirm']").click()})},
buttons:{cancel:{label:f("Cancel")},confirm:{label:f("Remove")}}});c.find(".modal-footer .btn-primary").removeClass("btn-primary").addClass("btn-danger");c.find(".mbrsite-delete-link").click(function(){b.openUrl(e.getUrl())})}else d.resolve();return d.promise()})});b.addFilter("projectHashesUrl",function(a){return a&&0==a.indexOf("mbrsite://")?(a=p.parseString(a),a.protocol+"://"+encodeURIComponent(JSON.stringify({id:a.id}))):a});b.addFilter("publishProjectSettings",function(a,b){b&&delete a.mbrsite;
return a});h.getSettings("language",function(a){a&&(t=a)});h.fileManagerAddUploader(new x({name:"mbrsite",pipes:[D,F,E]}));b.addFilter("showProjectsListEach",function(b,e,d){return d.mbrsite?(b=a(b),d=new p(d.mbrsite),e=v.clone(),e.text(d.getUrl()),b.find(".project-element-panel").find(".project-name").after(e),b[0].outerHTML):b});this.$body.on("click",".mbrsite-open",function(){var a=b.projectSettings&&b.projectSettings.mbrsite;a&&(a=new p(a),b.openUrl(a.getUrl()))});this.$body.on("click",".mbrsite-delete",
function(){var c=a(".app-layer-common");a(".mbrsite-domain-control");var e=b.projectSettings&&b.projectSettings.mbrsite;if(e){var d=new p(e);e=b.confirmDlg(f("Do you want to remove the domain $domain$? Your site will be completely removed from the Web.").replace("$domain$",'<a href="#" class="mbrsite-delete-link">'+b.escapeHtml(d.get("domain"))+"</a>").replace("?","?<br>"),function(e){if(e){var f=a(b.preloaderHTML).css("opacity",.8);c.find(".app-layer-cont").before(f);var g=d.id;d.delete().then(null,
function(b){return 404===b.code?a.Deferred().resolve().promise():a.Deferred().reject(b).promise()}).then(function(){for(var c=0;c<m.items.length;c++)if(m.items[c].id===g){m.items.splice(c,1);--m.count;break}return a.Deferred(function(a){delete b.projectSettings.mbrsite;b.runSaveProject(function(c){a.resolve();b.fire("mbrsiteDeleted")},!0)}).promise()}).always(function(){f.remove()})}});e.find(".modal-footer .btn-primary").removeClass("btn-primary").addClass("btn-danger");e.find(".mbrsite-delete-link").click(function(){b.openUrl(d.getUrl())});
return!1}}).end();b.addFilter("publishFiles",function(a,e){"mbrsite"===b.projectSettings.publishType&&a.push({dest:"edit/index.html",srcList:[{src:"edit/index.html",filter:"template"}]});return a});b.addFilter("publishTemplating",function(a,e){return"mbrsite"===b.projectSettings.publishType&&"edit/index.html"==e?'<!DOCTYPE html>\n                                <html lang="en">\n                                    <head>\n                                        <meta charset="UTF-8">\n                                        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                                        <title>CMS</title>\n                                    </head>\n                                    <body>\n                                        <script src="https://c.ybnz.com/creator.js">\x3c/script>\n                                    </body>\n                                </html>':
a})},showedProjectsList:function(c){var e=a(b.preloaderHTML).appendTo(".show-site-list-modal").on("click",function(a){a.stopPropagation()}),d=function(b){var c=a.Deferred(),d=a(b);d.find(".project-domain").length?c.resolve():(b=d.attr("data-url"),$Bridge.getLocalJSON(b).then(function(a){if(a=a&&a.settings&&a.settings.mbrsite){a=new p(a);var b=v.clone();b.text(a.getUrl());d.find(".project-element-panel").find(".project-name").after(b)}c.resolve()}).catch(function(a){console.log(a);c.resolve()}));return c.promise()};
a.when.apply(a,c.find(".site-list .project-element").toArray().map(function(a){return d(a)})).then(function(){m.count?u().then(function(a){m=a;m.items.forEach(function(a){var d="https://"+a.domain,e=!1;b.domainManager&&b.domainManager.siteId===a.id&&b.domainManager.isConnected&&b.domainManager.isReady&&(d="https://"+b.domainManager.getCustomDomainInfo().name);c.find(".site-list .project-element .project-domain").each(function(a,b){if(d===b.textContent)return e=!0,!1});if(!e){var f=c.find(".site-list .project-element").eq(0),
g=f.clone();g.attr({"site-id":a.id,"site-domain":a.domain}).find(".project-element-panel").removeClass("active").addClass("project-remote").find(".project-img").addClass("project-img-icon").html('<i class="mbr-icon-globe-with-americas-shown"></i>').end().find(".project-name").text(b.getSubdomain(a.domain)).end().find(".btn-group > .btn:not(.app-project-remove)").remove();g.find(".project-domain").length?g.find(".project-domain").text(d):(a=v.clone(),a.text(d),g.find(".project-name").after(a));f.after(g)}});
c.find(".site-list .project-element > .project-element-panel.project-remote").on("click",z);c.find(".site-list .project-element .project-domain").on("click",function(a){a.stopPropagation();b.openUrl(a.target.textContent)});c.find(".site-list .project-element > .project-element-panel.project-remote .app-project-remove").on("click",A).tooltipster({content:f("Remove Site"),delay:0,speed:100,position:"bottom"});e.remove()},function(a){e.remove();console.error(a)}):e.remove()},function(a){console.error(a);
e.remove()})},cancelProjectRemove:function(c,e){$Bridge.getLocalJSON(c).then(function(d){var g=d&&d.settings&&d.settings.mbrsite;if(g){var k=new p(g),l=k.id;g=b.confirmDlg({message:f("Do you want to remove the domain $domain$? Your site will be completely removed from the Web.").replace("$domain$",'<a href="#" class="mbrsite-delete-link">'+b.escapeHtml(k.get("domain"))+"</a>").replace("?","?<br>"),callback:function(g){if(g){var r=a(b.preloaderHTML).appendTo(".show-site-list-modal").on("click",function(a){a.stopPropagation()});
k.delete().then(function(){var b=c.substring(0,c.lastIndexOf("/"));h.changeRecentSettings(b,{mbrsite:""},function(b){delete d.settings.mbrsite;h.saveLocalFile(c,JSON.stringify(d),function(b){for(b=0;b<m.items.length;b++)if(m.items[b].id===parseInt(l)){m.items.splice(b,1);--m.count;break}a(e.target).closest(".project-element").find(".project-domain").remove();q()})})},function(a){b.showError(f("Error removing the domain")+": "+a)}).always(function(){r.remove()})}},buttons:{cancel:{label:f("Cancel")},
confirm:{label:f("Remove")}}});g.find(".modal-footer .btn-primary").removeClass("btn-primary").addClass("btn-danger");g.find(".mbrsite-delete-link").click(function(){b.openUrl(k.getUrl())})}})},loadedProject:function(){q()},savedProject:function(){q()},changedProjectSettings:function(){q()},domainManagerLoaded:function(){var c=b.projectSettings&&b.projectSettings.mbrsite;if(c){c=new p(c);var e=a(".app-layer-common"),d=a(".mbrsite-domain-control"),f=e.find(".mbrsite-change-domain-btn");try{var h=a(".app-layer-common").find(".mbrsite-change-domain-btn"),
l=b.domainManager.data?b.getSubdomain(b.domainManager.getDomainInfo().name):c.attrs?b.getSubdomain(c.attrs.domain):"";a(".app-layer-common").find("#site-settings-domain").attr("value",l).on("focus",function(){h.css("visibility","visible")}).on("blur",function(b){(b=b.relatedTarget)&&a(b).hasClass("mbrsite-change-domain-btn")||h.css("visibility","hidden")}).end()}catch(r){console.error(r)}f.on("click",function(){var c=b.projectSettings||(b.projectSettings={});if(c.mbrsite){var g=new p(c.mbrsite),h=
b.withSubdomain(e.find("input.mbrsite-domain").val().trim());if(h===g.get("domain"))f.css("visibility","hidden");else{var k=a(b.preloaderHTML).css("opacity",.8).appendTo(e);d.removeClass("mbrsite-domain-error");g.save({domain:h}).then(function(){c.mbrsite=g.toString()},function(b){if(404===b.code)return delete c.mbrsite,a.Deferred().resolve().promise();d.addClass("mbrsite-domain-error").find(".mbrsite-input-status").html(b.message);k.remove();return a.Deferred().reject(b).promise()}).always(function(){f.css("visibility",
"hidden");b.domainManager&&b.domainManager.syncDomainData();k.remove()})}}});q()}},accountInited:function(){u().then(function(a){m=a},function(a){console.error(a)})},signedin:function(){u().then(function(a){m=a},function(a){console.error(a)})}}})},["jQuery","mbrApp","TR()","Bridge","mbrServer"]);
