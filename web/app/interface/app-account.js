var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,c,g){d instanceof String&&(d=String(d));for(var h=d.length,k=0;k<h;k++){var n=d[k];if(c.call(g,n,k,d))return{i:k,v:n}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,g){d!=Array.prototype&&d!=Object.prototype&&(d[c]=g.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,c,g,h){if(c){g=$jscomp.global;d=d.split(".");for(h=0;h<d.length-1;h++){var k=d[h];k in g||(g[k]={});g=g[k]}d=d[d.length-1];h=g[d];c=c(h);c!=h&&null!=c&&$jscomp.defineProperty(g,d,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(c,d){return $jscomp.findInternal(this,c,d).v}},"es6","es3");
defineM("app-account",function(d,c,g,h){function k(a,b){b=b||{};f={email:a,token:b.token,id:b.id,verified:b.verified};g.setSettings("account",JSON.stringify(f))}var n,m,q=/^((([a-z]|\d|[!#$%&'*+\-\/=?\^_`{|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#$%&'*+\-\/=?\^_`{|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,
f=!1,p=function(){var a={get status(){return this._status},set status(a){switch(a){case "offline":c.fire("accountSatusChanged","offline");this._status=a;break;case "wait":c.fire("accountSatusChanged","wait");this._status=a;break;case "online":c.fire("accountSatusChanged","online"),this._status=a}}};a.status="offline";return{turnOnline:function(){a.status="online"},turnWait:function(){a.status="wait"},turnOffline:function(){a.status="offline"},isOffline:function(){return"offline"===a.status},isOnline:function(){return"online"===
a.status}}}();c.regExtension({name:"account",global:{accountMode:{isOffline:p.isOffline,isOnline:p.isOnline},getUserInfo:function(){if(f){var a=d.extend({},!0,f);delete a.token;return a}return!1},getAccountPath:function(){if(!f||!f.email)return"";var a=f.email;a=a.toLowerCase();for(var b=/[a-z0-9]/,e="",l=0;l<a.length;l++)e=b.test(a[l])?e+a[l]:e+("_"+("000"+a.charCodeAt(l).toString(16)).substr(-4));return g.dataLocation+"/"+e},checkUserInfo:function(a){var b=this;a=a||function(){};f?f.id&&"verified"in
f?a(b.getUserInfo()):h.profile().then(function(e){e||console.error("requested profile is empty!");k(f.email,d.extend(f,e));a(b.getUserInfo())},function(b){console.error(b);a()}):a()},signIn:function(a,b,e){var l=this;e=e||function(){};h.signin(a,b).then(function(b){l.fire("signin");k(a,b);e();l.fire("signedin")},function(a,b,c){l.fire("signinError",a,b);e(a,c)})},signInWith:function(a,b){var e=this;h.signinWith(a).then(function(a){e.fire("signin");k(a.profile.email,a);b();e.fire("signedin")},function(a,
c,d){e.fire("signinError",a,c);b(a,d)})},checkSign:function(a,b){function e(){g=!0}function d(){c.off("closedSignForm",d);c.off("signedin",e);a&&a(g)}var f=c.getUserInfo();if(f&&f.email)a(!0);else{var g=!1;c.on("signedin",e);c.on("closedSignForm",d);c.showSignForm(0,b)}},handleServerError:function(a,b){403==b&&f&&f.token&&c.fire("accountAccessExpired")},checkAccountExpired:function(){h.profile().then(null,function(a,b){c.handleServerError(a,b)})},getServiceToken:function(a,b){return h.getServiceToken(a,
b)},showSignForm:function(a,b,e){var c=this;e=e||{};if(!d(".app-registration-form").length)return c.fire("showSignForm"),n="email",m=void 0,dialog=bootbox.dialog({title:b||"Please login to get latest updates and extensions",className:"account-registration-dialog",message:['<div class="login-with">\n   <a href="#" data-network="google" class="login-with__item login-with__item_google">Login with Google</a>\n   <a href="#" data-network="facebook" class="login-with__item login-with__item_facebook">Login with Facebook</a>\n</div>\n<div class="login-with">\n   <p class="login-with__or">or</p>\n</div>\n<div class="app-registration-form">\n<input type="email" class="form-control" name="userInput" placeholder="Enter your email">\n<div><p class="app-registration-form-response"></p></div>\n<div class="input-group-btn text-center">\n<button id="sign-in" class="btn btn-primary" type="button" style="border-radius:6px;">Login</button>',
!e.skipButton||a&2?"":'<br><button id="skip-sign" class="btn btn-default" type="button">Use free version</button>',"</div>\n</div>"].join("\n"),buttons:{main:{label:"No, I don't need this and don't show me this anymore",className:"btn-link pull-left btn-sign-form-link",callback:function(){g.setSettings("showSignFormOnLoad","no")}},reset:{label:"Forgot password?",className:"btn-link pull-left btn-sign-form-link",callback:function(){c.resetPassword(m);return!(a&2)}}},closeButton:!(a&2),onEscape:!(a&
2),callback:a&2&&function(){return!1}}),a&1||dialog.find("button[data-bb-handler=main]").hide(),dialog.find("button[data-bb-handler=reset]").hide(),dialog.on("hidden.bs.modal",e.onHide&&e.onHide.bind(null,dialog)),c.fire("showedSignForm",dialog),dialog},setSignResponse:function(a,b,e){var c=this.$body.find(".app-registration-form-response");c.removeClass("text-danger text-success");"error"===b?c.addClass("text-danger"):"success"===b&&c.addClass("text-success");"getaddrinfo ENOTFOUND my.mobirise.com"===
a.message&&(a.message="Check your internet connection and try again");c.text(a||"");e&&(c.html('<a class="text-danger" href="javascript:void(0)">'+c.html()+'</a><div style="display:none;-webkit-user-select:all">'+e+"</div>"),c.find("a").click(function(){d(this).parent().find("div").show()}))},setSignFormLoading:function(a){a.find("> *").css("opacity",0);a.append('<div class="mobirise-spinner"><i></i><i></i><i></i><i></i></div>')},unsetSignFormLoading:function(a){a.find(".mobirise-spinner").remove();
a.find("> *").css("opacity",1)},setSignFormSuccess:function(a){this.fire("setSignFormSuccess");var b=a.find("button");a.find("[name=userInput]").remove();a.addClass("text-center");b.text("Ok");b.on("click",function(){g.reload()});a.siblings().remove();a.find("#skip-sign").remove();a.find(".btn-change-email").remove();a.find(".btn-forgot-password").remove();a.find(".login-with").remove();this.setSignResponse("You successfully signed in","success");this.fire("settedSignFormSuccess")},sendSignForm:function(){function a(){f.attr("placeholder",
"Enter password");f.attr("type","password");f.val("");d.text("Login");dialog.find("button[data-bb-handler=main]").hide();dialog.find("h4").text("Enter your password");n="password"}var b=this,e=b.$body.find(".app-registration-form").parents(".modal-body:eq(0)"),d=e.find("button"),f=e.find("[name=userInput]"),g=f.val();switch(n){case "email":if(!g.match(q)){b.fire("sendSignFormNoValidEmail",g);b.setSignResponse("Please enter a valid email address","error");break}b.setSignFormLoading(e);h.signup(g).then(function(c){b.fire("signup",
c);m=g;a();dialog.find("h4").css({display:"inline","padding-right":"5px"}).text("Check your email. Your password is sent to $email$".replace("$email$",m)).after('<a class="btn btn-link btn-sign-form-link btn-change-email" style="margin: 0;padding: 0 !important;">Change email</a>');dialog.find("#skip-sign").remove();b.setSignResponse("If you haven't received the email, please check Spam folder.");b.unsetSignFormLoading(e)},function(c,d,f){b.fire("signupError",c,d);301==d?(m=g,a(),dialog.find("h4").text("You already have the Mobirise account for $email$. Enter your password.".replace("$email$",
m)),b.setSignResponse("Your password is sent to $email$ with first sign up. Check your email to find it.".replace("$email$",m)),b.$body.find(".app-registration-form-response").after('<a class="btn btn-link btn-sign-form-link btn-forgot-password" style="margin: 0;padding: 0 !important;">Forgot password?</a>').after('<a class="btn btn-link btn-sign-form-link btn-change-email" style="margin: 0;padding: 0 5px 0 0 !important;">Change email.</a>'),dialog.find("#skip-sign").remove()):b.setSignResponse(c,
"error",f);b.unsetSignFormLoading(e)});break;case "password":b.setSignFormLoading(e);c.signIn(m,g,function(a,c){a?(b.setSignResponse(a,"error",c),b.unsetSignFormLoading(e)):(n="success",b.unsetSignFormLoading(e),b.setSignFormSuccess(e))});break;case "success":dialog.modal("hide")}},logout:function(a){function b(){h.signout().always(function(){g.setSettings("account","",function(a){c.fire("logout",f.email);g.reload()})})}a=a||{};f&&(a.force?b():c.confirmDlg("Are you sure you want to logout?",function(a){a&&
b()}))},resetPassword:function(a){a=a||c.getUserInfo().email;h.lostpassword(a).then(function(b){bootbox.dialog({message:"We've sent an email with instructions on how to reset your password to the email address $email$".replace("$email$",a)})},function(a,c){bootbox.dialog({message:a+"("+c+")"})});c.fire("sendSignFormResetPassword",a);return!1}},events:{bridgeInit:function(){var a=this;g.getSettings("account",function(b){try{f=JSON.parse(b||!1)}catch(l){console.log(l)}if(f){var e=function(){f&&h.profile(f);
a.fireOnce("accountInited")};g.checkInternetConnected().then(function(){g.setSettings("lastOnline",(new Date).toISOString());p.turnOnline();e()}).catch(function(){d.Deferred();g.getSettings("lastOnline",function(b){!b||2592E5<Date.parse(new Date)-Date.parse(b)?a.logout({force:!0}):(p.turnWait(),e())})})}else g.getSettings("firstrun",function(b){b&&"yes"!==b?c.showSignForm(0,"Please login to access your premium themes and extensions",{onHide:function(b){c.fire("closedSignForm",b);f&&h.profile(f);a.fireOnce("accountInited")},
skipButton:!0}):c.showSignForm(2,"Please login to load the free themes and extensions",{onHide:function(b){c.fire("closedSignForm",b);f&&h.profile(f);a.fireOnce("accountInited")}})})});a.$body.on("click",".app-registration-form button#sign-in",function(){a.sendSignForm()});a.$body.on("click",".app-registration-form button#skip-sign",function(){bootbox.hideAll()});a.$body.on("keyup",".app-registration-form [name=userInput]",function(b){13==b.keyCode&&a.sendSignForm()});a.$body.on("click",".btn-forgot-password",
function(){a.resetPassword(m)});a.$body.on("click",".btn-change-email",function(){dialog.on("hidden.bs.modal",function(){a.showSignForm(2,"Please login to load the free themes and extensions")});dialog.modal("hide")});a.$body.on("click",".login-with .login-with__item",function(b){var e=d(this).data("network"),f=a.$body.find(".app-registration-form").parents(".modal-body:eq(0)");b.preventDefault();a.setSignFormLoading(f);c.signInWith(e,function(b,c){b?a.setSignResponse(b,"error",c):(n="success",a.setSignFormSuccess(f));
a.unsetSignFormLoading(f)})})},accountAccessExpired:function(){var a=!1;return function(){a||(a=!0,c.showError("Your account token has expired, please log in again",function(){c.logout({force:!0})}))}}(),settedSignFormSuccess:function(){c.getUserInfo()&&p.turnOnline()}}})},["jQuery","mbrApp","Bridge","mbrServer"]);
