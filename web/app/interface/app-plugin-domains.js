var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var f=a.length,d=0;d<f;d++){var k=a[d];if(b.call(c,k,d,a))return{i:d,v:k}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,f){if(b){c=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var d=a[f];d in c||(c[d]={});c=c[d]}a=a[a.length-1];f=c[a];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,f={next:function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var f=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){f(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(p){b.reject(p)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(h){c||(c=!0,a.call(b,h))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(p){this.reject_(p);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)k.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var k=new b;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(g){h(g)}}:b}var f,h,k=new d(function(a,b){f=a;h=b});this.callWhenSettled_(c(a,f),c(b,h));return k};
d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?k.asyncExecute(c):this.onSettledCallbacks_.push(c)};d.resolve=c;d.reject=function(a){return new d(function(b,c){c(a)})};d.race=function(a){return new d(function(b,d){for(var f=$jscomp.makeIterator(a),h=f.next();!h.done;h=f.next())c(h.value).callWhenSettled_(b,
d)})};d.all=function(a){var b=$jscomp.makeIterator(a),f=b.next();return f.done?c([]):new d(function(a,d){function h(b){return function(c){k[b]=c;l--;0==l&&a(k)}}var k=[],l=0;do k.push(void 0),l++,c(f.value).callWhenSettled_(h(k.length-1),d),f=b.next();while(!f.done)})};return d},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var d=b.length;c=c||0;for(0>c&&(c=Math.max(c+d,0));c<d;c++){var k=b[c];if(k===a||Object.is(k,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
defineM(function(a,b,c,f,d){function k(){return d.jwt().then(null,function(c,e){b.handleServerError(c,e);return a.Deferred().reject(Error(c)).promise()})}function h(b,e){return k().then(function(g){var d=a.Deferred();b||(b={});"string"==typeof b&&(b={path:b});b.headers=a.extend({"X-App":f.appName+"/"+f.version,Authorization:"Bearer "+g},b.headers||{});if(b.dataType)switch(g=String(b.dataType),g.toLowerCase()){case "json":b.data=JSON.stringify(b.data);b.headers["Content-Type"]="application/json";break;
default:return d.reject(Error('Unknown dataType: "'+g+'".')).promise()}e&&a.extend(!0,b,e);f.http("https://api.mobirisesite.com/v2"+(b.path||"/"),{method:b.method||"GET",timeout:b.timeout||3E4,data:b.data||"",headers:b.headers,success:function(b,e){try{b=JSON.parse(b),400<=e.statusCode?d.reject(a.extend(Error(b.message),{code:e.statusCode})):d.resolve(b)}catch(x){d.reject(Error(c("Incorrect server response."))),console.log("Incorrect server response:",b)}},error:function(a){d.reject(Error(a))}});
return d.promise()})}function u(a){return'<div class="col-md-12">\n                    <div class="col-md-6">\n                        <input name="name" type="text" value="your nameserver" class="form-control" readonly>\n                    </div>\n                    <div class="col-md-6">\n                        <input name="name" type="text" value="'+(a?a[0]:"ns1.mobirisesite.com")+'" class="form-control domain-readonly" readonly>\n                        <span class="domain-copy btn-primary">'+
c("Copy")+'</span>\n                    </div>\n                </div>\n                <div class="col-md-12">\n                    <div class="col-md-6">\n                        <input name="name" type="text" value="your nameserver" class="form-control" readonly>\n                    </div>\n                    <div class="col-md-6">\n                        <input name="name" type="text" value="'+(a?a[1]:"ns2.mobirisesite.com")+'" class="form-control domain-readonly" readonly>\n                        <span class="domain-copy btn-primary">'+
c("Copy")+"</span>\n                    </div>\n                </div>"}function p(a,b){return'<div class="col-md-12">\n                    <div class="col-md-2">\n                        <input name="name" type="text" value="'+b+'" class="form-control uppercase" readonly>\n                        <span class="uppercase-text">Name</span>\n                    </div>\n                    <div class="col-md-3">\n                        <input name="name" type="text" value="CNAME" class="form-control uppercase" readonly>\n                        <span class="uppercase-text">Type</span>\n                    </div>\n                    <div class="col-md-7">\n                        <input name="name" type="text" value="'+
(a?a[0]:"adam.ds.mobirisesite.com")+'" class="form-control uppercase domain-readonly" readonly>\n                        <span class="uppercase-text">Target</span>\n                        <span class="domain-copy btn-primary">'+c("Copy")+"</span>\n                    </div>\n                </div>"}function l(a){if(!a)return!1;a=psl.parse(a);return a.subdomain?a.subdomain:!1}function t(g){b.showDialog({title:c("Connect domain"),className:"domain-settings-modal",buttons:{success:{label:c("OK"),"default":!0,
className:"iconfont-ok",callback:function(){}}},body:['<div class="row wrapper">\n                    <div class="col-md-12">\n                        <div class="form-group row">\n                            <div class="col-md-12 control-label">\n                                '+c("1. Log into your")+" <b> "+(g?g:"domain")+" </b> "+c("domain provider's account")+"<br>\n                                "+c("2. Go to your domain's DNS / name server settings.")+"<br>\n                            "+
(l(g)?'<span class="control-label">\n                                        '+c("3. Create a CNAME record for your subdomain.")+'<br>\n                                    </span>\n                                    <div class="user-domains cname">\n                                        <div>\n                                            '+(b.domainManager.requiredDnsRecords?p(r(b.domainManager.requiredDnsRecords,"CNAME"),l(g)):b.preloaderHTML)+"\n                                        </div>\n                                    </div>":
'<span class="control-label">\n                                        '+c("3. Replace your current name servers with the mobirisesite name servers shown below.")+'<br>\n                                    </span>\n                                    <div class="col-md-12 user-domains nss">\n                                        <div>\n                                            '+(b.domainManager.requiredDnsRecords?u(r(b.domainManager.requiredDnsRecords,"NS")):b.preloaderHTML)+'\n                                        </div>\n                                    </div>\n                                    <span class="control-label">\n                                        '+
c("After your nameservers change it may take from 20 minutes to 48 hours for your domain to be visible online.")+"<br>\n                                    </span>")+"\n                            </div>\n                        </div>\n                    </div>\n                </div>"].join("\n"),create:function(){var e=this;b.domainManager.requiredDnsRecords||b.domainManager.getRequiredDns().then(function(c){a(e).find(".user-domains.nss").html(u(r(b.domainManager.requiredDnsRecords,"NS")));a(e).find(".user-domains.cname").html(p(r(b.domainManager.requiredDnsRecords,
"CNAME"),l(g)))})}})}function r(a,b){return a.filter(function(a){return a.type===b})[0].values}var q="a aaaa cname ns mx txt caa srv".split(" "),v=new RegExp("^(.+?)\\."+"mobirisesite.com".replace(/\./g,"\\.")+"$"),n=function(){function d(){this.data;this.siteId;this.sidebarHTML;this.publishHTML;this.isConnected;this.isReady;this.isLoading;this.requiredDnsRecords;this.subdomain;Object.defineProperty(this,"isLoading",{set:function(e){e?a(this.sidebarHTML).prepend(b.preloaderHTML):a(this.sidebarHTML).find("div.preloader").remove()}})}
d.prototype.api={request:function(a){return h(a)},get:function(a){return h(a,{method:"GET"})},post:function(a){return h(a,{method:"POST"})},put:function(a){return h(a,{method:"PUT"})},delete:function(a){return h(a,{method:"DELETE"})}};d.prototype.getDomainInfo=function(){return this.data&&this.data.domains&&this.data.domains[0]?this.data.domains[0]:null};d.prototype.getCustomDomainInfo=function(){return this.data&&this.data.domains&&this.data.domains[1]?this.data.domains[1]:null};d.prototype.getDomainStatus=
function(){var a=this.getCustomDomainInfo();return a&&a.status?"..."===a.status.description.slice(-3)?a.status.description:a.status.description+"...":"Connecting..."};d.prototype.onLoaded=function(){this.isLoading=!1;a("#app-project-sidebar").length&&(a(this.sidebarHTML).empty().html(this.getSidebarTemplate()),a(this.sidebarHTML).find("#pending-overlay").hide());b.fire("domainManagerLoaded")};d.prototype.onLoad=function(){this.isLoading=!0};d.prototype.syncDomainData=function(){var e=this;if(b.projectSettings.mbrsite){var c=
b.projectSettings.mbrsite.match(/^([-a-z0-9]+):\/\/(.*)$/i);if(c){var d="https://"+a.extend(JSON.parse(decodeURIComponent(c[2]))).domain+"/";this.onLoad();return new Promise(function(a,b){e.api.get("/me/sites").then(function(b){b.items.map(function(b){if(b.publicUrl===d){var c=e.getCustomDomainInfo();e.data=b;e.siteId=b.id;e.isConnected=c?!0:!1;e.isConnected&&(e.subdomain=l(c.name));e.isConnected&&"Deployed"===c.status.name&&(e.isReady=!0);e.onLoaded();a(b)}})}).catch(function(a){e.onLoaded();b(a)})})}throw Error("Invalid domain");
}this.onLoaded()};d.prototype.checkPublishTemplate=function(a){var c=this;if(b.projectSettings.mbrsite){var e=a.find(".mbrsite-publish-settings .publishBody"),d=a.find(".mbrsite-publish-settings .publishBody .row");d.addClass("custom-domain-publish-row");if(this.getCustomDomainInfo()||!1!==this.isConnected){var m=this.getCustomDomainInfo().name;this.getCustomDomainInfo()&&this.isReady?(d.find('[class^="col-"]').hide(),d.append('\n                    <div class="custom-domain-publish-wrap">\n                        <span class="control-label">https://</span>\n                        <input id="custom-domain" type="text" class="form-control" value="'+
(m||"")+'" disabled>\n                        <button id="custom-dmn-settings" class="btn btn-primary" style="display: flex;"><i class="mbr-icon-cog"></i></button>\n                    </div>\n                ')):(this.isReady||this.syncDomainData(),d.find('[class^="col-"]').hide(),d.append('<div class="custom-domain-publish-wrap">'+b.preloaderHTML+"</div>"),setTimeout(function(){d.find(".custom-domain-publish-wrap").remove();c.isReady?d.append('\n                        <div class="custom-domain-publish-wrap">\n                            <span>https://</span>\n                            <input id="custom-domain" type="text" class="form-control" value="'+
(m||"")+'" disabled>\n                            <button id="custom-dmn-settings" class="btn btn-primary" style="display: flex;"><i class="mbr-icon-cog"></i></button>\n                        </div>\n                    '):(d.find('[class^="col-"]').show(),e.append('<div class="custom-dmn__pending" data-domain="'+m+'">Domain '+(c.getCustomDomainInfo()?m:"")+" pending connection...</div>"))},3E3))}}};d.prototype.getSidebarTemplate=function(){if(!this.isConnected)return'<div class="row">\n                                <label class="control-label col" for="site-settings-domain">'+
c("Site Domain")+'</label>\n                            </div>\n                            <div class="row" style="justify-content: center;padding-bottom: 10px;">\n                                <div style="display:flex;flex-direction:row;">\n                                    <div style="padding-right: 5px;">\n                                        <span class="control-label">https://</span>\n                                        <input id="custom-domain" type="text" placeholder="yourdomain.com" class="form-control">\n                                    </div>\n                                    <button id="connect-custom-btn" class="btn btn-primary">'+
c("Connect")+'</button>\n                                </div>\n                            </div>\n                            <div class="row">\n                                <div class="col">\n                                    <input name="mbrsiteDomain" id="site-settings-domain" type="text" '+(this.getDomainInfo()?'placeholder="'+b.getSubdomain(this.getDomainInfo().name)+'"':'value="'+b.getUID(10).toLowerCase()+'"')+' class="mbrsite-domain form-control">\n                                    <label class="control-label">.mobirisesite.com</label>\n                                    <button class="btn btn-info mbrsite-change-domain-btn pull-right" data-tooltipster="bottom" title="'+
c("OK")+'">\n                                        <i class="mbr-icon-check"></i>\n                                    </button>\n                                </div>\n                            </div>\n                            <div class="row">\n                                <div class="col-md-12">\n                                    <small class="mbrsite-input-status col-12"></small>\n                                </div>\n                            </div>\n                            '+
(this.getDomainInfo()?'<div class="mbrsite-buttons form-row">\n                                        <div class="col">\n                                            <a href="#" class="mbrsite-delete btn btn-danger w-100">'+c("Remove Domain")+'</a>\n                                        </div>\n                                        <div class="col">\n                                            <a href="#" class="mbrsite-open btn btn-primary w-100 if-custom-connected">'+c("Open in Browser")+"</a>\n                                        </div>\n                                    </div>":
'<div class="mbrsite-buttons form-row">\n                                        <div class="col">\n                                            <a href="#" id="publish-default-btn" class="mbrsite-open btn btn-primary w-100 if-custom-connected">'+c("Publish")+"</a>\n                                        </div>\n                                    </div>");if(this.isConnected&&!this.isReady)return'<div class="row">\n                                <label class="control-label col" for="site-settings-domain">'+
c("Site Domain")+'</label>\n                            </div>\n                            <div class="row">\n                                <div class="custom-domain" style="justify-content: center;">\n                                    <div style="padding-right: 5px;display: flex;justify-content: center;">\n                                        <span class="control-label" style="padding-right: 10px;">https://</span>\n                                        <input id="custom-domain" type="text" class="form-control" value="'+
(this.getCustomDomainInfo().name||"")+'" disabled>\n                                    </div>\n                                </div>\n                                <div class="custom-domain__status">\n                                    <span id="domainHelp">'+this.getDomainStatus()+'</span>\n                                </div>\n                            </div>\n                            <div class="mbrsite-buttons form-row">\n                                <div class="col">\n                                    <a href="#" class="disconnnect-domain btn btn-danger w-100">'+
c("Cancel")+'</a>\n                                </div>\n                                <div class="col">\n                                    <a href="#" class="custom-dmn-recheck btn btn-primary w-100">'+c("Recheck")+"</a>\n                                </div>\n                            </div>";if(this.isConnected&&this.isReady)return'<div class="row">\n                                <label class="control-label col" for="site-settings-domain">'+c("Site Domain")+'</label>\n                            </div>\n                            <div class="row">\n                                <div class="custom-domain" style="justify-content: center;">\n                                    <div style="display: flex;flex-direction: row;justify-content: center;">\n                                        <div style="padding-right: 5px;display: flex;justify-content: center;">\n                                            <span class="control-label" style="padding-right: 10px;">https://</span>\n                                            <input id="custom-domain" type="text" class="form-control" value="'+
(this.getCustomDomainInfo().name||"")+'" disabled>\n                                        </div>\n                                        '+(this.subdomain?"":'<button id="custom-dmn-settings" class="btn btn-primary" style="display: flex;"><i class="mbr-icon-cog"></i></button>')+'\n                                    </div>\n                                    <div class="custom-domain__status">\n                                        <span id="domainHelp" class="deployed">Deployed</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="mbrsite-buttons form-row">\n                                <div class="col">\n                                    <a href="#" class="disconnnect-domain btn btn-danger w-100">'+
c("Disconnect")+'</a>\n                                </div>\n                                <div class="col">\n                                    <a href="#" class="custom-dmn-open btn btn-primary w-100">'+c("Open in Browser")+"</a>\n                                </div>\n                            </div>"};d.prototype.connectCustomDomain=function(a){var e=this;this.onLoad();if("object"===typeof a){a=a.closest(".mbrsite-domain-control");var d=a.find("input#custom-domain").val();this.sidebarHTML||
(this.sidebarHTML=a)}else"string"===typeof a&&(d=a);if(!/^(([a-zA-Z]{1})|([a-zA-Z]{1}[a-zA-Z]{1})|([a-zA-Z]{1}[0-9]{1})|([0-9]{1}[a-zA-Z]{1})|([a-zA-Z0-9][-_\.a-zA-Z0-9]{1,61}[a-zA-Z0-9]))\.([a-zA-Z]{2,13}|[a-zA-Z0-9-]{2,30}\.[a-zA-Z]{2,3})$/gi.test(d))throw this.onLoaded(),b.alertDlg(c("Invalid domain name")),Error("Invalid domain name");return new Promise(function(a,m){b.isAvailableFeature("ConnectDomain").then(function(g){g?(g=e.data&&e.data.domains?Promise.resolve():e.syncDomainData(),g.then(function(b){e.api.post({path:"/sites/"+
e.siteId+"/domains",data:JSON.stringify({name:d})}).then(function(b){var c=b.requiredDnsRecords;if(!c||!Array.isArray(c)||!c.length)throw Error("Invalid server requiredDnsRecords");e.requiredDnsRecords=c;e.data.domains[1]=b;e.isConnected=!0;e.subdomain=l(d);bootbox.hideAll();t(d);e.onLoaded();a(b)}).catch(function(a){e.onLoaded();m(a)})}).catch(function(a){e.onLoaded();m(a)})):(b.openUrl("https://my.mobirise.com/buy.php?p=126&st="+b.domainManager.siteId+"&u="+b.getUserInfo().id),e.onLoaded(),m(Error(c("This feature is not available"))))})})};
d.prototype.getRequiredDns=function(){var a=this;return this.api.get({path:"/sites/"+this.siteId+"/domains"}).then(function(b){b.forEach(function(b){(b=b.requiredDnsRecords)&&Array.isArray(b)&&b.length&&(a.requiredDnsRecords=b)})}).catch(function(b){a.onLoaded();reject(b)})};d.prototype.detachCustomDomain=function(){var a=this;this.onLoad();return new Promise(function(d,e){a.api.delete("/sites/"+a.siteId+"/domains/"+a.getCustomDomainInfo().id).then(function(e){a.data.domains=[a.data.domains[0]];a.isConnected=
!1;a.isReady=!1;a.onLoaded();b.alertDlg(c("Domain successfully detached"));d(e)}).catch(function(b){a.onLoaded();e(b)})})};d.prototype.getDNSRecords=function(){return this.getCustomDomainInfo()?h("/sites/"+this.siteId+"/domains/"+this.getCustomDomainInfo().id+"/records",{method:"GET"}):Promise.reject(Error("Custom domain not exist"))};d.prototype.deleteDNSRecord=function(a){return this.getCustomDomainInfo()?h("/sites/"+this.siteId+"/domains/"+this.getCustomDomainInfo().id+"/records/"+a,{method:"DELETE"}):
Promise.reject(Error("Custom domain not exist"))};d.prototype.setDNSRecords=function(a){return this.getCustomDomainInfo()?h({path:"/sites/"+this.siteId+"/domains/"+this.getCustomDomainInfo().id+"/records",data:JSON.stringify(a)},{method:"POST"}):Promise.reject(Error("Custom domain not exist"))};d.prototype.buildNsConstructor=function(c){function d(b,c){b||(b=q[0]);a(c).find('select.ns-type-select option[value="'+b+'"]').prop("selected",!0);a(c).find(".ns-form__body-wrapper .ns-form__body").each(function(c,
d){a(d).attr("name")===b?a(d).show():a(d).hide()})}var e=this;if(!Array.isArray(this.records))throw Error("Invalid NS records");var g="";q.forEach(function(a){switch(a){case "a":g+=dnsTemplates.get("a");break;case "aaaa":g+=dnsTemplates.get("aaaa");break;case "cname":g+=dnsTemplates.get("cname");break;case "ns":g+=dnsTemplates.get("ns");break;case "mx":g+=dnsTemplates.get("mx");break;case "txt":g+=dnsTemplates.get("txt");break;case "caa":g+=dnsTemplates.get("caa");break;case "srv":g+=dnsTemplates.get("srv")}});
var m=a('\n                    <div class="ns-module">\n                        <div class="row ns-module__wrapper">\n                            <div class="ns-module__addbutton">\n                                <button type="button" class="btn btn-primary">Add record</button>\n                            </div>\n                            <div class="ns-module__form">\n                                <div class="ns-module__form-body">\n                                    <form name="txt" class="ns-form">\n                                        <div class="ns-form__select">\n                                            <label class="">Type</label>\n                                            <div class="ns-input">\n                                                '+
function(a){a||(a=q[0]);var b='<select name="type" class="ns-type-select">';q.forEach(function(c){b+='\n                        <option value="'+c+'" '+(c===a?"selected":"")+">\n                            "+c.toUpperCase()+"\n                        </option>\n                    "});return b+"</select>"}()+'\n                                            </div>\n                                        </div>\n                                        <div class="ns-form__body-wrapper">\n                                            '+
g+'\n                                        </div>\n                                    </form>\n                                </div>\n                                <div class="ns-module__footer">\n                                    <button type="button" class="btn btn-default ns-module__cancel">Cancel</button>\n                                    <button type="button" class="btn btn-info ns-module__save">Save</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>');
c.empty();c.append(m);c.find(".ns-module__addbutton form").on("click",function(a){});c.find(".ns-module__addbutton > button").on("click",function(a){c.find(".ns-module__form").toggleClass("open");d(null,c)});c.find("button.ns-module__cancel").on("click",function(a){c.find(".ns-module__form").toggleClass("open",!1)});c.find("button.ns-module__save").on("click",function(d){var m=a(c).siblings(".preloader");m.show();d=c.find(".ns-form__body-wrapper");var g=c.find("select.ns-type-select").val();if(g){d.find(".ns-form__body").each(function(b,
c){a(c).attr("name")!==g&&a(c).remove()});var f={};d=c.find("form.ns-form").serializeArray();a(d).each(function(a,b){f[b.name]=b.value});f.name||(f.name=e.getCustomDomainInfo().name);f.type=f.type.toUpperCase();e.setDNSRecords(f).then(function(b){return e.getDNSRecords().then(function(b){e.records=b;e.buildNsTable(a(c).siblings("#nsrecord .nsrecord__table"));e.buildNsConstructor(c);m.hide()})}).catch(function(a){e.buildNsConstructor(c);m.hide();console.log(a);b.alertDlg(a.message)})}});c.find("select.ns-type-select").on("click",
function(b){d(a(b.target).val(),c)})};d.prototype.buildNsTable=function(d){var e=this,g=this.records.reduce(function(a,b){if("A"===b.type&&!b.writable)return a;b='\n                    <tr data-id="'+b.id+'">\n                        <td name="type">'+b.type+'</td>\n                        <td name="name">'+b.name+'</td>\n                        <td name="content">\n                        '+(b.priority?'<span class="priority" title="priority"> '+b.priority+" </span>":"")+"\n                        "+
(b.exchange?'<span class="mserver"> '+b.exchange+" </span>":"")+"\n                        "+(b.data||b.address||b.value?'<span name="content">'+(b.data||b.address||b.value)+" </span>":"")+"\n                        "+(void 0!==b.flags?'<span class="flags" title="flags"> '+b.flags+" </span>":"")+"\n                        "+(b.tag?'<span class="tag" title="tag"> '+b.tag+" </span>":"")+"\n                        "+(b.service?'<span class="service" title="service"> '+b.service+" </span>":"")+"\n                        "+
(b.proto?'<span class="proto" title="protocol"> '+b.proto+" </span>":"")+"\n                        "+(b.weight?'<span class="weight" title="weight"> '+b.weight+" </span>":"")+"\n                        "+(b.port?'<span class="port" title="port"> '+b.port+" </span>":"")+"\n                        "+(b.target?'<span class="target" title="target"> '+b.target+" </span>":"")+"\n\n                        "+(q.includes(b.type.toLowerCase())&&b.writable?'<td class="rm">\n                                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M14.3 3.625L12.375 1.7 8 6.075 3.625 1.7 1.7 3.625 6.075 8 1.7 12.375 3.625 14.3 8 9.925l4.375 4.375 1.925-1.925L9.925 8 14.3 3.625z"></path></svg>\n                               </td>':
"<td></td>")+"\n                    </tr>";return a+b},"");d.empty();d.append('<table id="Table" class="Table">\n                        <thead>\n                            <tr>\n                                <th>Type</th>\n                                <th>Name</th>\n                                <th>Content</th>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            '+g+
"\n                        </tbody>\n                    </table> ");d.find("td.rm").on("click",function(d){var g=a(d.target).closest("tr"),f=g.attr("data-id"),h=g.find('td[name="type"]').text(),k=g.find('td[name="name"]').text();g.find('td[name="ttl"]').text();var l=g.find('td[name="content"]').text();bootbox.confirm({title:c("Are you sure you want to delete this record?"),message:g.clone(),className:"remove-ns",buttons:{confirm:{label:c("Delete"),className:"btn-warning"},cancel:{label:c("Cancel"),
className:"btn-default"}},callback:function(a){a&&k&&h&&l&&e.deleteDNSRecord(f).then(function(a){g.remove()}).catch(function(a){b.alertDlg(c("Internal server error."))})}})})};d.prototype.buildNsWindow=function(){var d=this;return b.showDialog({title:""+c("DNS management"),className:"domain-manager__ns-editor",body:'<div class="row">\n                            <div class="col-md-12">\n                                <div class="form-group clearfix">\n                                    <div class="row">\n                                        <div class="col-md-12" id="nsrecord" class="nsrecord">\n                                            '+
b.preloaderHTML+'\n                                            <div class="nsrecord__add-new"></div>\n                                            <div class="nsrecord__table"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>',create:function(b){var c=a(b).find(".preloader");d.getDNSRecords().then(function(e){d.records=e;c.hide();d.buildNsConstructor(a(b).find("#nsrecord .nsrecord__add-new"));
d.buildNsTable(a(b).find("#nsrecord .nsrecord__table"))}).catch(function(a){console.error(a)})},cancel:function(a){}})};d.prototype.onClick=function(){this.html=this.buildNsWindow()};return d}();b.regExtension({name:"domains",global:{getSubdomain:function(a){return"string"!=typeof a?null:(a=v.exec(a))&&a[1]},withSubdomain:function(a){return a+".mobirisesite.com"}},events:{load:function(){var d=this;b.addFilter("sidebarProjectSettings",function(a){a.push({title:"Common",name:"common",html:'<div class="form-group mbrsite-domain-control mbrsite-wrapper col-md-12"></div>'});
return a});d.$body.on("click","a.custom-dmn-open",function(a){b.openUrl("https://"+b.domainManager.getCustomDomainInfo().name)});d.$body.on("click","a.disconnnect-domain",function(a){b.confirmDlg(c("Do you want to disconnect the domain $domain$?").replace("$domain$",b.domainManager.getCustomDomainInfo().name),function(a){a&&b.domainManager.detachCustomDomain().then(function(a){b.domainManager.syncDomainData()}).catch(function(a){console.log(a)})})});d.$body.on("click","a.custom-dmn-recheck",function(a){b.domainManager.syncDomainData()});
d.$body.on("click","#domainHelp",function(b){try{t(a(b.target).closest(".mbrsite-wrapper").find("input#custom-domain").val())}catch(w){console.error(w)}});d.$body.on("click",".custom-dmn__pending",function(b){t(a(b.target).data("domain"))});d.$body.on("click","#custom-dmn-settings",function(){b.domainManager.buildNsWindow()});d.$body.on("click",".domain-settings-modal .domain-copy",function(b){a(b.target).siblings("input.domain-readonly").select();document.execCommand("copy");a(b.target).addClass("copied").text(c("Copied"));
setTimeout(function(){a(b.target).text("Copy").removeClass("copied");window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},500)});d.$body.on("click","#connect-custom-btn",function(c){var e=a(c.target).closest(".mbrsite-domain-control").find("input#custom-domain").val();b.domainManager||(b.domainManager=new n);b.domainManager.getDomainInfo()?b.domainManager.connectCustomDomain(a(c.target)).catch(function(a){b.alertDlg(a.message)}):a.when(d.getPublishUrl(a(c.target).closest(".mbrsite-wrapper"),
"mbrsite")).then(function(a){d.publish(!1,a,!1,function(){b.domainManager||(b.domainManager=new n);b.domainManager.syncDomainData().then(function(){b.domainManager.getDomainInfo()&&b.domainManager.connectCustomDomain(e).catch(function(a){b.alertDlg(a.message)})})})})});d.$body.on("click","#publish-default-btn",function(b){b=a(b.target).closest(".mbrsite-domain-control");a.when(d.getPublishUrl(b,"mbrsite")).then(function(a){d.publish(!1,a)})});b.on("mbrsiteDeleted",function(){b.domainManager&&delete b.domainManager;
b.domainManager=new n;var c=a(".app-layer-common").find(".mbrsite-domain-control").html(b.domainManager.getSidebarTemplate());b.domainManager.sidebarHTML=c});b.on("endUploader",function(){b.domainManager||(b.domainManager=new n);b.projectSettings.mbrsite&&b.domainManager.syncDomainData()})},loaded:function(){b.domainManager||(b.domainManager=new n);b.domainManager.syncDomainData()},loadedProject:function(){b.domainManager&&delete b.domainManager;b.projectSettings.mbrsite&&(b.domainManager=new n,b.domainManager.syncDomainData())},
shownSidebarProjectSettings:function(){if(!b.accountMode.isOffline()){var c=a(".app-layer-common").find(".mbrsite-domain-control");b.domainManager||(b.domainManager=new n);c.html(b.domainManager.getSidebarTemplate());b.domainManager.sidebarHTML=c;b.domainManager.syncDomainData()}}}})},["jQuery","mbrApp","TR()","Bridge","mbrServer"]);
