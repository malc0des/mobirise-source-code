var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};
$jscomp.polyfill=function(a,b,d,f){if(b){d=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var e=a[f];e in d||(d[e]={});d=d[e]}a=a[a.length-1];f=d[a];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function d(a){return a instanceof e?a:new e(function(c,g){c(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})}this.batch_.push(a)};var f=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){f(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var g=a[c];a[c]=null;try{g()}catch(k){this.asyncThrow_(k)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(g){c.reject(g)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(b){g||(g=!0,a.call(c,b))}}var c=this,g=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(g){this.reject_(g);return}"function"==typeof c?
this.settleSameAsThenable_(c,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)h.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var h=new b;e.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};e.prototype.settleSameAsThenable_=function(a,c){var g=this.createResolveAndReject_();try{a.call(c,g.resolve,g.reject)}catch(k){g.reject(k)}};e.prototype.then=function(a,c){function g(a,c){return"function"==typeof a?function(c){try{b(a(c))}catch(m){d(m)}}:c}var b,d,f=new e(function(a,c){b=a;d=c});this.callWhenSettled_(g(a,b),g(c,d));return f};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,c){function b(){switch(d.state_){case 1:a(d.result_);break;case 2:c(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?h.asyncExecute(b):this.onSettledCallbacks_.push(b)};e.resolve=d;e.reject=function(a){return new e(function(c,b){b(a)})};e.race=function(a){return new e(function(c,b){for(var g=$jscomp.makeIterator(a),e=g.next();!e.done;e=g.next())d(e.value).callWhenSettled_(c,
b)})};e.all=function(a){var c=$jscomp.makeIterator(a),b=c.next();return b.done?d([]):new e(function(a,g){function e(c){return function(b){k[c]=b;f--;0==f&&a(k)}}var k=[],f=0;do k.push(void 0),f++,d(b.value).callWhenSettled_(e(k.length-1),g),b=c.next();while(!b.done)})};return e},"es6","es3");$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var f=a.length,e=0;e<f;e++){var h=a[e];if(b.call(d,h,e,a))return{i:e,v:h}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var f="";a;)if(a&1&&(f+=b),a>>>=1)b+=b;return f}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,d,f){d=null!=d?d:function(a){return a};var b=[],h="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof h){a=h.call(a);for(var l=0;!(h=a.next()).done;)b.push(d.call(f,h.value,l++))}else for(h=a.length,l=0;l<h;l++)b.push(d.call(f,a[l],l));return b}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(d){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(d||"")+"_"+b++,d)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,f={next:function(){if(d<a.length){var e=d++;return{value:b(e,a[e]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return[a,d]})}},"es6","es3");
defineM("app-plugin-projects-history",function(a,b,d){var f=[],e=!1,h=[],l;b.regExtension({name:"project-history",global:{getProjectHistoryRecords:function(a,b){Bridge.dirList(a+"/history",function(a){b&&b(a)},{names:["*.mobirise","*.mobirise_history"],recursive:!1,filter:1})},removeProjectHistory:function(a,g){a=a.map(function(a){return new Promise(function(c,d){return Bridge.removeLocal(b.projectPath+"/history/"+a,function(a){g&&c(a);c(!1)})})});Promise.all(a).then(g)},addProjectToHistory:function(a,
b,d,e){d||(d="project-"+Bridge.dateFormat(new Date,"yyMMddhhmmss")+".mobirise_history",this._lastSavedName==d&&(d="project-"+Bridge.dateFormat(new Date((new Date).getTime()+1E3),"yyMMddhhmmss")+".mobirise_history"),this._lastSavedName=d);var c=a+"/history/"+d;a+="/project.mobirise";b?("object"==typeof b&&(b=JSON.stringify(b)),"string"==typeof b?Bridge.saveLocalFile(c,b,function(a){e&&e(a&&c)}):e&&e("")):Bridge.copyLocal(a,c,e)},_lastSavedName:"",loadProjectFromHistory:function(a,g){var c=g?"project-"+
Bridge.dateFormat(g,"yyMMddhhmmss")+".mobirise_history":"project-"+Bridge.dateFormat(new Date,"yyMMddhhmmss")+".mobirise_history";b.addProjectToHistory(b.projectPath,null,c,function(){Bridge.copyLocal(b.projectPath+"/history/"+a,b.projectPath+"/project.mobirise",function(c){c?(e=b.projectPath,b.loadProject(b.projectPath,0,{noSave:!0,onError:function(a){b.showError(d("Error while load from selected history: ")+error);e=!1},onSuccess:function(){e=!1}})):(console.error("Unable to revert to history ",
a),b.showError(d("Unable to revert to history $history date$").replace("$history date$",g)))})})},manageHistoryDir:function(a){var c=this;l.hide();b.confirmDlg(d("Do you really want to remove the site version from $selected date$?").replace("$selected date$","<b>"+h.slice(0,8).join(", ")+(8<h.length?"...":"")+"</b>"),function(b){b?c.removeProjectHistory(a,function(){c.$body.find(".app-project-history").click()}):l.show()})},optionColumnize:function(a,b){a=Array.prototype.slice.call(a,0);var c=a.reduce(function(a,
b){return a.text.length>b.text.length?a:b}),d={separator:"|",paddingLength:5,paddingString:"&nbsp;"},e;for(e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);var g=c.text.split(d.separator),f=parseInt(d.paddingLength,10),h,m;a.forEach(function(a){h=a.text.split(d.separator).map(function(a,b,c){return b<c.length-1?(m=g[b].length-a.length,a+d.paddingString.repeat(f+m)):a});a.innerHTML=h.join("")})},multipleSelectHistory:function(b){var c=b.querySelector("select");c.setAttribute("multiple","multiple");c.style.height=
"auto";Array.from(c.options).forEach(function(a){a.selected&&h.push(a.text.split(" ").reverse().join(" "))});a(b).find("select").attr("size","10").on("change",function(a){h.splice(0,h.length);Array.from(c.options).forEach(function(a){a.selected&&h.push(a.text.split(" ").reverse().join(" "))});a=b.querySelector("a.manage-history");var d=b.querySelector('[data-bb-handler="confirm"]');1<h.length?d.disabled=!0:d.disabled=!1;a.innerHTML=1<h.length?"("+h.length+") REMOVE":"REMOVE"})},showHistoryBootbox:function(c,
e){var g=this;g.getProjectHistoryRecords(c,function(c){f=c;var k=[],n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/;Promise.all(f.map(function(a){var c=a.match(n);if(c&&7==c.length){var d=new Date("20"+c[1],c[2]-1,c[3],c[4],c[5],c[6]),e=Bridge.dateFormat(d,"hh:mm:ss yyyy-MM-dd");return(new Promise(function(c){return Bridge.getInfoLocal(b.projectPath+"/history/"+a,function(a){return c(a.size)})})).then(function(b){return k.push({text:e,value:a,group:d.toLocaleDateString(),size:Math.ceil(b)})})}})).then(function(){k.reverse();
0<k.length?(l=bootbox.prompt({title:d("Select saved version of project"),className:"history-dialog",inputType:"select",inputOptions:k,buttons:{confirm:{label:d("Revert back"),className:"btn-primary"},cancel:{label:d("Cancel"),className:"btn-default"}},callback:function(a){if(a){var c=new Date;e?g.loadProjectFromHistory(a,c):b.confirmDlg(d("Do you really want to revert back to the site version from $selected date$? The current site will not be lost, it will be saved under $current date$.").replace("$selected date$",
"<b>"+h+"</b>").replace("$current date$","<b>"+Bridge.dateFormat(c,"yyyy-MM-dd hh:mm:ss")+"</b>"),function(b){b&&g.loadProjectFromHistory(a,c)})}}}),l.on("shown.bs.modal",function(b){g.multipleSelectHistory(b.target);var c=b.target.querySelectorAll("option");c=$jscomp.makeIterator(c.entries());for(var e=c.next();!e.done;e=c.next()){e=$jscomp.makeIterator(e.value);var f=e.next().value;e.next().value.textContent+=" | "+String(Math.ceil(k[f].size/1E3))+"KB"}a(b.target).find(".modal-footer").prepend('<a href="#" class="manage-history btn btn-danger  pull-left" data-tooltipster="bottom" title="'+
d("Remove Selected Version")+'">'+d("Remove")+"</button>");a(b.target).find(".modal-footer").find(".btn-primary").attr("data-tooltipster","bottom").attr("title",d("Revert Back To Selected Version"));g.initTooltips()})):b.alertDlg(d("Project history is empty"))})})}},events:{shownProjectSettings:function(c){a(c.target).find(".app-export-project").after('<a class = "app-project-history btn btn-primary" data-tooltipster="bottom" title="'+d("Show Project History")+'">'+d("History")+"</a>");b.initTooltips()},
projectError:function(a,b){a&&e!=a&&this.addProjectToHistory(a)},loadProject:function(a,b){b&&e!=b&&this.addProjectToHistory(b)},load:function(){var c=this;b.addFilter("sidebarProjectSettings",function(b){var c='<div class="col"><a class = "app-project-history btn btn-primary w-100" data-tooltipster="bottom" title="'+d("Show Project History")+'">'+d("History")+"</a></div>";a(b).each(function(b,d){b=a("<div>"+d.html+"</div>");b.find(".app-export-project").parents(".form-group").length&&(b.find(".app-export-project").parents(".form-row").append(a(c)),
d.html=b.html())});return b});c.$body.on("click",".app-project-history",function(){c.showHistoryBootbox(b.projectPath)});c.$body.on("click",".manage-history",function(b){b=a(b.target).closest(".modal-content").find(".bootbox-form select").val();c.manageHistoryDir(b)})}}})},["jQuery","mbrApp","TR()"]);
