window.mbrScript=function(){function e(a,b,f){this.name="mbrScriptError";this.message=a;Error.captureStackTrace?Error.captureStackTrace(this,e):this.stack=Error().stack;this.line=b;this.token=f}function d(a){d.parser.yy.parseError||(d.parser.yy.parseError=function(b,a){throw new e("Parse error: Unexpected '"+(a.text||a.token)+"'",a.line,a.text||a.token);});a=d.parser.parse(a);return"RepeatStatement"==a.type?new k(a.key,a.value,new g(a.expression)):new g(a)}function k(a,b,f){this.key=a;this.type="repeat";
this.value=b;this.expression=f}var m=/[^ a-zA-Z0-9]/g,n=function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)},h=function(a){return"string"==typeof a?"'"+a.replace(m,n)+"'":"number"==typeof a?a.toString():!0===a?"true":!1===a?"false":null===a?"null":"undefined"};e.prototype=Object.create(Error.prototype);e.prototype.constructor=e;d.filters={};d.filter=function(a,b){d.filters[a]=b();return this};var l=function(){function a(b){this.scopes=b}a.prototype.plus=function(b,a){return"undefined"==
typeof b?a:"undefined"==typeof a?b:b+a};a.prototype.filter=function(b){var a=Array.prototype.slice.call(arguments,1);if(d.filters[b])return d.filters[b].apply(null,a);throw Error('Filter "'+b+'" not defined.');};a.prototype.call=function(b){var a=Array.prototype.slice.call(arguments,1);if("function"==typeof b)return b.apply(this.scopes[0],a)};a.prototype.get=function(b){for(var a=Array.prototype.slice.call(arguments,1);;){var c=a.shift();if(void 0===c)break;if(void 0===b||null===b)break;b=b[c]}return b};
a.prototype.getProp=function(b){for(var a=0;a<this.scopes.length;a++)if(void 0!==this.scopes[a][b])return this.scopes[a][b]};return a}(),g=function(){function a(b){this._dependencies=[];this.type="expression";this.code=this._getCode(b)}a.prototype.createFunction=function(b){var a=new l(Array.prototype.slice.call(arguments));return(new Function("","var result = ("+this.code+'); if (result === undefined || result === null) return ""; return result;')).bind(a)};a.prototype.getDependencies=function(){return this._dependencies.slice()};
a.prototype._getCode=function(a,d){var c="";d=d||[];switch(a.type){case "ArrayExpression":c+="[";a.elements.map(function(a,b){c+=b?", ":"";a&&(c+=this._getCode(a))},this);c+="]";break;case "ObjectExpression":c+="{";a.properties.map(function(a,b){var d="Identifier"==a.key.type?a.key.name:this._getCode(a.key);c+=(b?", ":"")+d+":"+this._getCode(a.value)},this);c+="}";break;case "UnaryExpression":c+=a.operator+this._getCode(a.argument);break;case "BinaryExpression":case "LogicalExpression":c="+"==a.operator?
c+("this.plus("+this._getCode(a.left)+", "+this._getCode(a.right)+")"):c+("("+this._getCode(a.left)+" "+a.operator+" "+this._getCode(a.right)+")");break;case "ConditionalExpression":c+="(";c+=this._getCode(a.test)+" ? ";c+=this._getCode(a.consequent)+" : ";c+=this._getCode(a.alternate);c+=")";break;case "FilterExpression":c+="this.filter("+h(a.name);[a.expression].concat(a.arguments).map(function(a){c+=", "+this._getCode(a)},this);c+=")";break;case "CallExpression":c+="this.call("+this._getCode(a.callee);
a.arguments.map(function(a){c+=", "+this._getCode(a)},this);c+=")";break;case "MemberExpression":var b=a.object;if("Identifier"==b.type||"Literal"==b.type){c+="this.get("+this._getCode(b,[]);for(var e=[a],f=d.length-1;0<=f;f--)e.push(d[f]);var g=b.name;e.map(function(a){c+=", "+h(a.property.name);g+="."+a.property.name},this);"Identifier"==b.type&&this._dependencies.push(g);c+=")"}else c+=this._getCode(b,d.concat(a));break;case "Identifier":c+="this.getProp("+h(a.name)+")";2>arguments.length&&this._dependencies.push(a.name);
break;case "Literal":c+=h(a.value)}return c};return a}();d.Error=e;d.Context=l;d.Expression=g;d.RepeatStatement=k;return d}();
