var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(b,c,a){if(null==b)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return b+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,a){b!=Array.prototype&&b!=Object.prototype&&(b[c]=a.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,c,a,g){if(c){a=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var e=b[g];e in a||(a[e]={});a=a[e]}b=b[b.length-1];g=a[b];c=c(g);c!=g&&null!=c&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,a){var c=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=c.length,l=b.length;a=Math.max(0,Math.min(a|0,c.length));for(var n=0;n<l&&a<e;)if(c[a++]!=b[n++])return!1;return n>=l}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(b){return b?b:function(b,a){var c=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===a&&(a=c.length);a=Math.max(0,Math.min(a|0,c.length));for(var e=b.length;0<e&&0<a;)if(c[--a]!=b[--e])return!1;return 0>=e}},"es6","es3");$jscomp.findInternal=function(b,c,a){b instanceof String&&(b=String(b));for(var g=b.length,e=0;e<g;e++){var l=b[e];if(c.call(a,l,e,b))return{i:e,v:l}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");
defineM("app-publish-ftp",function(b,c,a){function g(d){try{return window.btoa(unescape(encodeURIComponent(d)))}catch(f){return""}}function e(d){try{return decodeURIComponent(escape(window.atob(d)))}catch(f){return""}}function l(d){return/^([^:]*):(?:\/\/(?:(?:([^\/:]*)(?::([^\/]*))?@)?([^\/@:]+)(?::(\d+))?))?(\/[^?]*)?(?:\?([^?]*))?$/.exec(d)}function n(d){return d?d[1]+"://"+(d[2]?d[2]+(d[3]?":"+d[3]:"")+"@":"")+d[4]+(d[5]?":"+d[5]:""):""}function r(d){return(d=l(d))&&d[4]?d[1]+"://"+(d[2]?d[2]+
"@":"")+d[4]+(d[5]?":"+d[5]:""):""}function w(d){function b(d,b){Bridge.getSettings("FtpList/"+d+"/FtpLocation",function(a){(a=l(a))?(a[2]=e(a[2]||""),Bridge.decode(a[2],function(f){a[2]=f;a[3]=e(a[3]||"");Bridge.decode(a[3],function(f){a[3]=f;Bridge.getSettings("FtpList/"+d+"/FtpFolder",function(d){b&&b({url:n(a),folder:d})})})})):b&&b("")})}Bridge.getSettings("FtpList/size",function(a){a=parseInt(a)||0;for(var f=[],p=0;p<a;p++)f.push(p+1);Bridge.waitForEach(f,b,d)})}function y(d,a,b){var f="",c=
!1;if(a.length){if(b)var p=b.substr(0,b.lastIndexOf("@")),e=b.substr(b.lastIndexOf("@")+1);for(var g in a)f+='<option value="'+a[g].url+'">'+r(a[g].url)+"</option>",b&&a[g].url.startsWith(p)&&a[g].url.endsWith(e)&&(c=!0,b=a[g].url);c||(b=a[0].url)}else f+='<option value="ftp://:@:21"></option>',b="ftp://:@:21";d.html(f);d.trigger("change");d.val(b);d.trigger("change");return b}function z(a,b,c){var d=l(b.url);d?Bridge.encode(d[2],function(f){d[2]=g(f);Bridge.encode(d[3],function(f){d[3]=g(f);Bridge.setSettings("FtpList/"+
a+"/FtpLocation",n(d),function(){Bridge.setSettings("FtpList/"+a+"/FtpFolder",b.folder,function(){Bridge.getSettings("FtpList/size",function(b){b=parseInt(b)||0;a>b?Bridge.setSettings("FtpList/size",b+1,function(){c&&c()}):c&&c()})})})})}):Bridge.setSettings("FtpList/"+a+"/FtpLocation","",function(){Bridge.setSettings("FtpList/"+a+"/FtpFolder","",c)})}function B(a,b){w(function(d){for(var f=[],c=0;c<d.length;c++)d[c].url&&(a&&0===a.indexOf(d[c].url)?f.splice(0,0,d[c]):0>f.indexOf(d[c].url)&&f.push(d[c]));
E(f,function(){b&&b(f)})})}function E(a,b){var d=1,c=[];c.push.apply(c,a);Bridge.waitForEach(c,function(a,b){z(d++,a,b)},function(){Bridge.setSettings("FtpList/size",a.length,b)})}function F(d){w(function(f){function p(a){for(var b=!1,d=0,c=a.length;d<c;d++)a[d].val().trim().length?(a[d].css("border-color",""),a[d].prev("label").css("color","")):(b=!0,a[d].css("border-color","red"),a[d].prev("label").css("color","red"));return!b}function e(a){"sftp"===q.val()?k.val("22"):k.val("21");k.trigger("input")}
var m=c.showDialog({title:a("FTP Site Manager"),className:"ftp",body:G,buttons:{ftpTest:{label:a("Test connection"),className:"btn-default",callback:function(){k.val()||e();p([t,k,u,v])&&(x.fadeIn(100),Bridge.testFtpLocation(n(["",q.val().trim(),u.val().trim(),v.val().trim(),t.val().trim(),k.val()]),function(d){x.fadeOut(300,function(){b(this).hide()});d?c.alertDlg(a("Successful connection")):c.alertDlg(a("Unable connect to FTP"))}));return!1}},ftpClose:{label:a("Save"),className:"btn-primary",callback:function(){k.val()||
e();if(p([t,k,u,v])){var a=n(["",q.val().trim(),u.val().trim(),v.val().trim(),t.val().trim(),k.val()]);z(C,{url:a,folder:""},function(){c.projectSettings.ftpLocation=a;w(function(a){y(d,a,c.projectSettings.ftpLocation)})});return!0}return!1}}},hide:function(){w(function(a){y(d,a,c.projectSettings.ftpLocation)})}}),h=m.find("[name=ftpList]"),g=m.find("[name=ftpNew]");m.find("[name=ftpTest]");var D=m.find("[name=ftpDelete]"),q=m.find("[name=ftpProtocol]"),k=m.find("[name=ftpPort]"),t=m.find("[name=ftpHost]"),
u=m.find("[name=ftpUser]"),v=m.find("[name=ftpPass]"),C=0,A=!1,x=b(c.preloaderHTML);m.on("change input","[name=ftpProtocol],[name=ftpHost],[name=ftpPort],[name=ftpUser],[name=ftpPass]",function(){if(!A){var a=n(["",q.val(),u.val(),v.val(),t.val(),k.val()]),d=h.next(".dropdownjs").find("input"),c=b(this);d.val(r(a));c.css("border-color","");c.prev("label").css("color","")}});q.on("change",function(){k.val()||e()});g.click(function(a){a.preventDefault();Bridge.getSettings("FtpList/size",function(a){a=
parseInt(a)||0;var b=h.find("option");b.length>a?b.last().val("ftp://:@:21").html(r("ftp://:@:21")):h.append("<option value='ftp://:@:21'>"+r("ftp://:@:21")+"</option>");h.trigger("change");h.val("ftp://:@:21");h.trigger("change");e()});return!1});D.click(function(b){b.preventDefault();c.confirmDlg({message:a("Remove this site?")+"<br/>"+r(h.val()),callback:function(a){if(a){a=h.find("option:selected").index();h.find("option:selected").remove();var b=h.find("option").not(":disabled").first();b.length?
h.val(b.val()):(h.append("<option value='ftp://:@:21'>"+r("ftp://:@:21")+"</option>"),h.val("ftp://:@:21"));h.trigger("change");z(a+1,{},function(){B(0)})}}});return!1});h.on("change",function(){var a=b(this);C=a.find("option:selected").index()+1;A=!0;if(a=a.val())a=l(a),t.val(a[4]),k.val(a[5]),q.val(a[1]),q.trigger("change"),u.val(a[2]),v.val(a[3]);A=!1});y(h,f,d.val());k.val()||e();m.find(".modal-content").before(x);x.css({opacity:.8});x.hide()})}var H='\t\t<div class="publishMethod">\t\t  <div class="radio radio-primary publishRadio">\t\t\t<label>\t\t\t  <input type="radio" name="publishType" value="ftp"><span class="circle"></span><span class="check"></span>'+
a("FTP")+'\t\t\t</label>\t\t  </div>\t\t  <div class="publishBody">\t\t\t<div class="publishBody__wrapper">\t\t\t  <div class="publishBody__item">\t\t\t\t<select class="form-control ftp-list" name="ftpList"></select>\t\t\t  </div>\t\t\t  <div class="publishBody__item">\t\t\t\t  <span class="input-wrapper input-group-btn">\t\t\t\t\t<input type="text" class="form-control" placeholder="['+a("root folder")+']" name="publishFtpFolder">\t\t\t\t  </span>\t\t\t  </div>\t\t\t  <div class="publishBody__item">\t\t\t\t  <div class="input-group-btn">\t\t\t\t\t<button class="btn btn-primary run-ftp-dialog" type="button">'+
a("Edit")+"...</button>\t\t\t\t  </div>\t\t\t  </div>\t\t\t</div>\t\t  </div>\t\t</div>",G='\t\t<div style="margin-bottom: 30px" class="row">\t\t  <div class="col-lg-12">\t\t\t<div style="width: 60%;float: left;margin-right: 15px;" class="form-group">\t\t\t\t<select class="form-control" name="ftpList"></select>\t\t    </div>\t\t\t<div class="form-group">               <button style="margin-top: 0; margin-bottom: 0;" type="button" class="btn btn-primary" name="ftpNew">'+a("Add New")+'</button>               <button style="margin-top: 0; margin-bottom: 0;" type="button" class="btn btn-danger btn-default" name="ftpDelete">'+
a("Remove")+'</button>\t\t    </div>\t\t  </div>\t\t</div>\t\t<div class="row">\t\t  <div class="col-lg-3">\t\t\t<div class="form-group">\t\t\t  <label>'+a("Protocol")+'</label>\t\t\t  <div class="input-group">\t\t\t    <select class="form-control" name="ftpProtocol">\t\t\t\t  <option value="ftp">FTP</option>\t\t\t\t<option value="ftps">FTPS</option>\t\t\t\t  <option value="sftp">SFTP</option>\t\t\t    </select>\t\t\t  </div>\t\t\t</div>\t\t  </div>\t\t  <div class="col-lg-7">\t\t\t<label>'+a("Host")+
" ("+a("e.g.")+' ftp.domain.com)</label>\t\t\t<input type="text" class="form-control" name="ftpHost">\t\t  </div>\t\t  <div class="col-lg-2">\t\t\t<label>'+a("Port")+'</label>\t\t\t<input type="text" class="form-control" name="ftpPort">\t\t  </div>\t\t</div>\t\t<div class="row">\t\t  <div class="col-lg-6">\t\t\t<label>'+a("Username")+'</label>\t\t\t<input type="text" class="form-control" name="ftpUser">\t\t  </div>\t\t  <div class="col-lg-6">\t\t\t<label>'+a("Password")+'</label>\t\t\t<input type="password" class="form-control" name="ftpPass">\t\t  </div>\t\t</div>\t\t<div class="row">\t\t  <div class="col-lg-6">\t\t\t\x3c!-- <button class="btn btn-primary pull-right btn-ftp-test" type="button">'+
a("Test FTP Server")+"</button>  --\x3e\t\t  </div>\t\t</div>";c.regExtension({name:"publish-ftp",global:{readFtpList:w,parseFTP:l,joinFTP:n},events:{createPublishModal:function(a){function d(a,b){Bridge.getSettings("FtpList/"+a+"/FtpFolder",function(a){b(a)})}-1!==b.inArray("ftp",Bridge.FileManager())&&a.find(".publishMethod").last().after(H);this.readFtpList(function(f){var e=a.find("[name=ftpList]"),g=a.find("[name=publishFtpFolder]"),h=a.find(".run-ftp-dialog");e.on("change",function(){var a=
b(this).find("option:selected").index();d(a+1,function(a){g.val(a)})});y(e,f,c.projectSettings.ftpLocation);h.click(function(){F(e)})})},load:function(){c.addFilter("getPublishUrl",function(d,c,e,g){if("ftp"==c){c=e.find("[name=ftpList]").val();d=e.find("[name=ftpList] option[value='"+c+"']").index()+1;var f=e.find("[name=publishFtpFolder]").val();c||(c=e.find("[name=ftpList] option")[0].value);c=l(c);if(c.some(function(a,b){return 6>b&&void 0===a}))return e.find(".ftp-list").addClass("error-input"),
b.Deferred().reject(Error(a("Empty ftp."))).promise();Bridge.setSettings("FtpList/"+d+"/FtpFolder",f);d=c[1].trim()+"://"+c[2].trim()+":"+c[3].trim()+"@"+c[4].trim()+":"+c[5]+"/"+f.trim();g.ftpLocation=c[1].trim()+"://"+c[2].trim()+"@"+c[4].trim()+":"+c[5];g.publishFtpPath=f.trim()}return d});c.addFilter("uploadFilesStart",function(b,c){var d=this;b.then(function(b,e){/^(sftp|ftp|ftps):\/\//.test(e)&&!c.error&&(c.error=function(b){b=b.replace("read ETIMEDOUT",a("Connection timed out")).replace("read ECONNRESET",
a("Connection reset by peer")).replace("connect ECONNREFUSED",a("Connection refused")).replace("Getaddrinfo ENOTFOUND",a("Couldn't resolve the hostname to an IP address")).replace("connect ENETUNREACH",a("Network is unreachable"));d.$body.find(".plugin-progress-modal-error").modal("hide");d.progressBar("error",b||a("Unknown error while publish"))})});return b});c.addFilter("publishProjectSettings",function(a,b){b&&(delete a.ftpLocation,delete a.publishFtpPath);return a});c.addFilter("publishIndex",
function(a,b){return/^[s]?ftp[s]?:/.test(b)?"":a})},published:function(b){/^[s]?ftp[s]?:/.test(b)&&c.alertDlg(a("The site published successfully to $ftp location$").replace("$ftp location$",c.projectSettings.ftpLocation))},runPublish:function(a){/^[s]?ftp[s]?:/.test(a)&&B(a)}}})},["jQuery","mbrApp","TR()"]);
