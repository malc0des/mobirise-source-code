defineM("app-core",function(b,e,d){d=b(".app-template > iframe")[0];e.regExtension({name:"app-core",global:{$iframe:b(d),iframe:d,iwindow:d.contentWindow||d,Core:void 0,appElements:{window:{width:0,height:0},iframe:{width:0,height:0},componentsLayer:{width:0,height:0,left:0,top:0}},$template:void 0,preloaderHTML:'<div class="preloader preloader-spinner"><div class="mobirise-spinner"><i></i><i></i><i></i><i></i><i></i></div></div>',path2core:function(a){return/^(\w*:)?\/\//.test(a)?a:"../../"+Bridge.path2app(a)},
core2path:function(a){return/^(\w*:)?\/\//.test(a)?a:Bridge.path2app("web/app/builder/"+a)},appElementsUpdate:function(){this.appElements={window:{width:this.$window.width(),height:this.$window.height()},iframe:{width:this.$iframe.width(),height:this.$iframe.height()},componentsLayer:{width:this.$componentsLayer.width(),height:this.$componentsLayer.height()}}},coreInit:function(){var a=this;a.appElementsUpdate();a.$window.on("resize",function(b){a.appElementsUpdate();a.fire("resizeInterface",b)});
b(a.iwindow).on("resize",function(b){a.appElementsUpdate();a.fire("resizeTemplate",b)});b(a.$body).on("click",function(f){b(f.target).is(".modal")||b(f.target).parents(".modal").length||a.fire("clickBody",f)});b(a.iwindow).on("click",function(b){a.fire("clickTemplate",b)})},startApplication:function(a){function b(){e.loadThemeAddon(!1,function(a){a||console.error("Critical: default theme is wrong!");d()})}function d(a,b){c.getUserInfo()?c.loadAllAddons(function(){h(a,b)}):h(a,b)}function h(b,d){c.fireOnce("beforeCoreLoad");
c.Core.fireOnce("load");c.fireOnce("coreLoad");c.coreInit();b?(c.fire("loadRecentProject"),c.loadProject(d,b,{noSave:!0,onError:function(){c.createProject("My Site",0,0,k)},onDone:function(){c.fire("loadedRecentProject",d);a()}})):c.createProject("My Site",0,0,k)}function k(){a()}var c=this;(function(){e.getRecentProject(function(a,c){if(a&&a.pages){var g=e.calcProjectTheme(a);e.requestTheme(g&&g.name,g&&g.title).then(function(f){if(f)return d(a,c);e.loadThemeAddon(g.name,function(e){if(e)return d(a,
c);b()})},function(a){console.error(a,"default will be loaded");b()})}else b()})})()}},events:{bridgeInit:function(){var a=this;b(".preloader .version").html(Bridge.version);b(a.iframe).one("load",function(){a.$template=b(a.iframe.contentDocument||a.iframe.contentWindow.document);a.Core=a.iwindow.mbrAppCore;a.iwindow.mbrAppCore.APP=a;a.iwindow.mbrAppCore.Bridge=Bridge;a.fireOnce("beforeAppLoad");a.on("addonsReady",function(){a.on("accountInited",function(){a.fireOnce("load");a.startApplication(function(){a.fireOnce("loaded")})})})});
b(a.iframe).attr("src",b(a.iframe).attr("data-src")+"?nocache="+ +new Date)},loaded:function(){b(".preloader").delay(100).fadeOut(1E3,function(){b(this).remove()})}}})},["jQuery","mbrApp","TR()"]);
