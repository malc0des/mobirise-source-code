defineM("app-payment-checking",function(e,g,r,q){function n(a,b){b=(b.version||1).toString();return a.premium&&!a.paid||a.expired&&0<Bridge.versionCmp(b,a.version)?!0:!1}var l=function(){function a(b){this.settingsKey=b}a.prototype.get=function(){var b=e.Deferred();Bridge.getSettings(this.settingsKey,function(a){try{if(a){var c=JSON.parse(a);b.resolve(c);return}}catch(h){}b.resolve([])});return b.promise()};a.prototype.add=function(b){var a=this;return this.get().then(function(c){0>c.indexOf(b)&&
(c.push(b),a.save(c));return!0})};a.prototype.remove=function(b){var a=this;return this.get().then(function(c){var d=c.indexOf(b);0<=d&&(c.splice(d,1),a.save(c));return!0})};a.prototype.contains=function(a){return this.get().then(function(b){var c=e.Deferred();0<=b.indexOf(a)?c.resolve():c.reject();return c.promise()})};a.prototype.save=function(a){Bridge.setSettings(this.settingsKey,JSON.stringify(a))};return a}(),p=function(){var a,b,d=new l("pmCheckList"),c=e.Deferred().resolve(!0);g.on(["accountInited",
"signin"],function(){if(!Bridge.isDev){var b=g.getUserInfo();b&&b.email&&(a=b.email,d.contains(a).then(function(){c=e.Deferred();c.then(function(){return d.remove(a)})}))}});return{schedule:function(){a&&!b&&(d.add(a),b=!0)},current:function(){return c}}}();g.on("serverAddonsLoaded",function(a,b){if(!Bridge.isDev)for(var d in a)if(d in b&&n(a[d],b[d])){p.schedule();break}});g.addFilter("promisesBeforeAddonsLoaded",function(a,b){var d=p.current();if("pending"!=d.state())return a;var c=e.Deferred(),
h=e.proxy(c.resolve,c),l=setTimeout(h,7E3);a.push(c.promise());q.addons().then(function(a){clearTimeout(l);if("pending"==c.state()){var e={};a=a&&a.data||[];for(var k=[],f=0;f<b.length;f++)e[b[f].name]=b[f];for(f=0;f<a.length;f++){var m=a[f].name;m in e&&n(a[f],e[m])&&k.push(m)}k.length?(b.splice(0,b.length,b.filter(function(a){return 0>k.indexOf(a.name)})),g.disableAddon(k.join(","),function(){k.forEach(function(a){Bridge.removeLocal(g.getAddonsDir()+"/"+a)});h()})):h();d.resolve()}},h);return a})},
["jQuery","mbrApp","TR()","mbrServer"]);
