var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,d){b instanceof String&&(b=String(b));for(var e=b.length,f=0;f<e;f++){var k=b[f];if(a.call(d,k,f,b))return{i:f,v:k}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,d){b!=Array.prototype&&b!=Object.prototype&&(b[a]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,d,e){if(a){d=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var f=b[e];f in d||(d[f]={});d=d[f]}b=b[b.length-1];e=d[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");
defineM("app-plugin-history",function(b,a,d){function e(a,b){for(var c in a){if("function"==typeof a[c])break;if(a.hasOwnProperty(c)!==b.hasOwnProperty(c))return!1;switch(typeof a[c]){case "object":if(!e(a[c],b[c]))return!1;break;case "function":if("undefined"==typeof b[c]||"compare"!=c&&a[c].toString()!=b[c].toString())return!1;break;default:if(a[c]!=b[c])return!1}}for(var d in b)if("undefined"==typeof a[d])return!1;return!0}function f(b){if(a.$undoButton&&a.$redoButton){a.$undoButton.removeClass("disabled-do no-events");
a.$redoButton.removeClass("disabled-do no-events");b=b||a.Core.currentPage;var g=a.Core.history,c=g.pages?g.pages[b]:{},h=a.$body.find(".app-undo").find("a");if(g&&c&&c.items&&0!==c.items.length){var f=d("Undo"),e=d("Redo");c.curItem+1<c.items.length&&(f=f+" "+g.pages[b].items[c.curItem].action);0<c.curItem&&(e=e+" "+g.pages[b].items[c.curItem-1].action);a.$undoButton.hasClass("tooltipstered")&&(a.$undoButton.tooltipster("content",f),a.$redoButton.tooltipster("content",e));0>=c.curItem?a.$redoButton.addClass("disabled-do no-events"):
"true"===a.appSettings.showRedo&&a.$redoButton.show(600);c.curItem+1>=c.items.length?a.$undoButton.addClass("disabled-do no-events"):h.removeClass("hidden-do")}else a.$undoButton.addClass("disabled-do no-events"),a.$redoButton.addClass("disabled-do no-events")}}function k(b,d,c){c=c||a.Core.currentPage;b=b[c];a.Core.history||(a.Core.history={},a.Core.history.pages={});var h=a.Core.history;h.pages||(h.pages={});h.pages[c]||(h.pages[c]={},h.pages[c].curItem=0,h.pages[c].items=[]);c=h.pages[c];if(0===
c.items.length||0<c.items.length&&!e(b,c.items[0].state))0<c.curItem&&(c.items.splice(0,c.curItem),c.curItem=0),c.items.unshift({state:b,action:d.text,event:d.event});f()}function l(a,d){d.Core.resultJSON[d.Core.currentPage]=b.extend(!0,{},a.state);d.calulateComponentParams();d.Core.render();f()}var m=[{event:"saveMediaImageDialog",text:d("Image")},{event:"saveMediaVideoDialog",text:d("Video")},{event:"addedComponent",text:d("Add Block")},{event:"removedComponent",text:d("Remove Block")},{event:"changedComponentPosition",
text:d("Block Position")},{event:"changedComponentParams",text:d("Block Params")},{event:"convertedComponentToCustomHTML",text:d("Block to HTML")},{event:"renderedCodeEditorChanges",text:d("Code Editor")},{event:"rivetsBlur",text:d("Text Type")},{event:"saveMediaIconFontDialog",text:d("Icon")},{event:"setComponentHTML",text:d("Change Component")}];a.regExtension({name:"history",global:{$undoButton:null,$redoButton:null},events:{switchedPage:function(){a.Core.history&&a.Core.history.pages&&a.Core.history.pages[a.Core.currentPage]?
f():k(b.extend(!0,{},a.Core.resultJSON),"load page")},load:function(){a.Core.history={curItem:0,items:[]};var e=b("<li>"),g=b("<li>");a.$undoButton=e;a.$redoButton=g;e.addClass("app-undo").attr({"data-tooltipster":"bottom",title:d("Undo")}).html('<a href="javascript:void(0)" class="hidden-do"><i class="mbr-icon-undo"></i></a>');g.addClass("app-redo").attr({"data-tooltipster":"bottom",title:d("Redo")}).html('<a href="javascript:void(0)"><i class="mbr-icon-redo"></i></a>');a.$previewBtn.parent().prepend(g);
a.$previewBtn.parent().prepend(e);a.$redoButton.hide();m.forEach(function(c){a.Core.on(c.event,function(d){k(b.extend(!0,{},a.Core.resultJSON),c)})});a.Core.on("changedPageSettings",function(c){"order"!==c&&k(b.extend(!0,{},a.Core.resultJSON),{event:"changedPageSettings",text:d("Page Settings")})});a.Core.on("projectLoaded",function(){var c=a.Core.history;c.curItem=0;c.items=[];c.pages={};f()});a.$body.find(".navbar-right").on("click",".app-undo",function(c){c=a.Core.history;var b=c.pages[a.Core.currentPage];
!c.pages||b.items.length<=b.curItem+1||(b.curItem+=1,l(b.items[b.curItem],a))});a.$body.find(".navbar-right").on("click",".app-redo",function(b){b=a.Core.history;var c=b.pages[a.Core.currentPage];b.pages&&0!==c.curItem&&(--c.curItem,l(c.items[c.curItem],a))})}}})},["jQuery","mbrApp","TR()"]);
