var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(c){var a=0;return function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.makeIterator=function(c){var a="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};
$jscomp.findInternal=function(c,a,d){c instanceof String&&(c=String(c));for(var k=c.length,e=0;e<k;e++){var q=c[e];if(a.call(d,q,e,c))return{i:e,v:q}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,d){c!=Array.prototype&&c!=Object.prototype&&(c[a]=d.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,a,d,k){if(a){d=$jscomp.global;c=c.split(".");for(k=0;k<c.length-1;k++){var e=c[k];e in d||(d[e]={});d=d[e]}c=c[c.length-1];k=d[c];a=a(k);a!=k&&null!=a&&$jscomp.defineProperty(d,c,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function a(){this.batch_=null}function d(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;a.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var k=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){k(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(n){this.asyncThrow_(n)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(l){this.reject_(l);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)q.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var q=new a;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(n){c.reject(n)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(r){f(r)}}:b}var d,f,m=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return m};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?q.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=d;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,c){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())d(f.value).callWhenSettled_(b,
c)})};e.all=function(a){var b=$jscomp.makeIterator(a),c=b.next();return c.done?d([]):new e(function(a,e){function f(b){return function(c){l[b]=c;h--;0==h&&a(l)}}var l=[],h=0;do l.push(void 0),h++,d(c.value).callWhenSettled_(f(l.length-1),e),c=b.next();while(!c.done)})};return e},"es6","es3");
defineM("app-plugin-media-editor",function(c,a,d){function k(a){if("string"!==typeof a)throw Error("Expected a string");a=a.replace(/\\/g,"/");"/"!==a[0]&&(a="/"+a);return encodeURI("file://"+a)}function e(a,c,d){a=a||{};c=c||{};for(var b in c)if(d||void 0==a[b])a[b]=c[b];return a}function q(b,c,d,f,m){function k(b,c){c?(m&&m(),a.showError(c.message)):m&&m(f?b||[]:b?b[0]:"")}function h(a,b,c,d){Bridge.isExistsLocal(a,function(g){if(g){g=Bridge.splitPath(a);var p=g.name;d&&(p=p.substr(0,p.lastIndexOf(b+
d)));d=(d||0)+1;p=p+b+d;h(g.dir+"/"+p+(g.noExt?"":"."+g.ext),b,c,d)}else c(a)})}function l(a){"/"!=c.substr(-1)&&(c+="/");Bridge.waitForEach(a,function(a,b){var e=c+Bridge.cleanURI(a.split("/").pop());h(e,"_",function(c){Bridge[d?"moveLocal":"copyLocal"](a,c,function(d){d||console.error("Error image re-save file "+a+" to "+c);b(c)})})},k)}if(Bridge.transformImage){var n={width:-1,height:-1,keepAspectRatio:!0,shrinkLarge:!1,stretchSmall:!1,quality:100,format:"",multi:!1};b&&b.length&&(1!=b.length||
b[0])?d?(d=e(n,d,!0),Bridge.waitForEach(b,function(a,b){var c=e({},d,!0);c.format=c.format||(/jpg|jpeg/i.test(Bridge.splitPath(a).ext)?"jpg":"png");"png"==c.format&&(c.quality=1);/(gif|svg|ico|tif|webp)$/i.test(a)?b(a):Bridge.transformImage(a,c,b)},c?l:k)):(c=Bridge.tempLocation+"/open"+Bridge.dateFormat(new Date,"yyyyMMdd_hhmmss"),l(b)):k()}else k()}var u;a.regExtension({name:"plugin-media-editor",global:{core2abs:function(b){return/^\w*:/.test(b)?b:b?a.iwindow.location.href.substring(0,a.iwindow.location.href.lastIndexOf("/"))+
"/"+b:""},showMediaImageDialog:function(b,e,n,f,m,w,h){var l=b.image.linkInNewWindow||!1,r=[],x={counter:0,all:0,get stageUp(){this.counter++;1<this.all&&(a.progressBar("show",a.projectSettings.imageResize?d("Adding and optimizing images"):d("Adding images to the project"),a.projectSettings.imageResize?d("To disable the image optimization, use Sites->Site Settings->Optimization"):"  ",!0),a.progressBar(this.counter+" / "+this.all,"","",!0),a.progressBar({progress:100/this.all*this.counter},"","",
!0),this.counter==this.all&&(a.progressBar("show",d("Creating gallery"),"  ",!0),a.progressBar({progress:30},"","",!0)))},set allLength(a){this.all=a}};a.fire("showMediaImageDialog");a.showDialog({title:d("Media Image"),className:"note-air-layout media-image"+(m?" multi":""),body:a.applyFilter("showMediaImageDialog",['<div class="row">\n<div class="col-md-12">\n<form class="media-image-form">\n<div class="form-group clearfix">\n<div class="row">\n<div class="col-md-12" id="media-tabs">\n<ul class="nav nav-tabs">\n<li>',
'<a href="#browseComputer" data-toggle="tab">'+d("Browse Computer")+"</a>","</li>\n<li>",'<a href="#onlineLibrary" data-toggle="tab">'+d("Free Online Library")+"</a>","</li>",'<li><a href="#siteLibrary" data-toggle="tab">'+d("Site Library")+"</a></li>",'</ul>\n<div class="tab-content">\n<div class="tab-pane" id="browseComputer">\n<div class="browse-computer-section">',"<p>"+d("Drop images here")+"</p>","<p>"+d("or")+"</p>",'<button class="btn btn-lg btn-primary" id="media-image-src-btn">'+d("Browse Computer")+
"</button>",'</div>\n</div>\n<div class="tab-pane" id="onlineLibrary">\n</div>\n<div class="tab-pane" id="siteLibrary">\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class="form-group clearfix">\n<div class="row">','<div class="col-md-3'+(m?" hidden":"")+'">','<label class=" control-label image-label">'+d("Selected Image")+"</label>",'<div class="selected-image">','<img src="'+this.core2abs(b.image.src||"")+'" id="media-image" class="w-100">','<div class="btn-group"><span class="btn btn-material-light-blue btn-crop"><i class="mbr-icon-pencil"></i></span></div>\n</div>',
'<input id="media-image-src" name="src" type="hidden" value="'+(b.image.src||"")+'">',"</div>",n||m?"":'<div class="col-md-9">'+(f?"":'<div class="row"><div class="col-md-6"><label class="control-label link-label" for="media-image-link">'+d("Link Image to")+"</label>"+(a.isAMP()&&h?'<div class="togglebutton control-label"><label><input type="checkbox" class="link-chk"><span style="margin-left:5px;" class="toggle"></span>'+d("Full Screen Image")+"</label></div>":"")+'<input id="media-image-link" style="margin-top:10px" class="form-control" name="link" type="text" readonly value="'+
(b.image.link||"")+'"></div><div class="col-md-3"><button class="btn btn-primary media-image-link-btn w-100" style="'+(a.isAMP()&&h?"margin-top:75px;":"margin-top:50px")+'">'+d("Edit Link")+"</button></div></div>")+'<div class="row img-attributes"><div class="col-md-6"><label class="control-label" for="media-image-alt">'+d("Alt")+'</label><input id="media-image-alt" class="form-control" name="alt" type="text" value="'+(b.image.alt||"")+'"></div></div></div>',"</div>\n</div>\n</form>\n</div>\n</div>"].join("\n"),
b),cancel:function(b){b.off(".media-click");a.fire("cancelMediaImageDialog",this)},oncancel:function(){a.fire("closeMediaImageDialog",this)},success:function(d){function f(){if(!k||!m){var g=c(p).find("form.media-image-form").serializeArray();if(g&&g.length){for(var f=0;f<g.length;f++){var h=a.core2abs(" ").replace(" ","");"src"===g[f].name&&0===g[f].value.indexOf("web/")&&(g[f].value="../../"+Bridge.path2app(g[f].value));"src"===g[f].name&&0===g[f].value.indexOf(h)&&(g[f].value=g[f].value.replace(h,
""));"src"===g[f].name&&0===g[f].value.indexOf(Bridge.base)&&(g[f].value=g[f].value.replace(Bridge.base,"../../"));b.image[g[f].name]=g[f].value}b.image.linkInNewWindow=l}for(var t in b)b[t].active=void 0;b.image.active=!0;b=a.applyFilter("saveMediaImageDialog",b)}d.off(".media-click");a.fire("saveMediaImageDialog",p,b,w);e(v.length?v:b)}function h(a){c("#media-image-src",d).val(a);f()}function g(b){var d=c.Deferred();a.addImageToAssets(r[b]).then(function(a){v[b]=a;d.resolve()});return d.promise()}
var p=this,v=[],k=d.find("#browseComputer").hasClass("active");if(k&&m){for(var t=[],n=0;n<r.length;n++)t.push(g(n));c.when.apply(c,t).then(function(){f()})}else t=c("#media-image",d).attr("src"),a.addImageToAssets(t).then(h)},show:function(e){a.isAMP()&&(b.image.lightbox&&(c(".link-chk").prop("checked",!0),c("#media-image-link, .media-image-link-btn").hide(),delete b.image.link,delete b.image.linkInNewWindow),c(".link-chk").change(function(a){c(a.target).prop("checked")?(b.image.lightbox=!0,delete b.image.link,
delete b.image.linkInNewWindow,c("#media-image-link, .media-image-link-btn").hide()):(delete b.image.lightbox,b.image.link="#",c("#media-image-link, .media-image-link-btn").show())}));var f=e.find(".browse-computer-section")[0];f.ondragover=function(){return!1};f.ondragleave=function(){return!1};f.ondragend=function(){return!1};f.ondrop=function(d){d.preventDefault();var g=[],f=new RegExp(".("+Bridge.supportedImgExts.join("|")+")$","i"),h=0;d=$jscomp.makeIterator(d.dataTransfer.files);for(var l=d.next();!l.done&&
(l=l.value,!f.test(l.path)||(g[h++]=k(l.path),m));l=d.next());f=c.extend(!0,{quality:80},b.image);a.showPreloader();q(g,"",a.projectSettings.imageResize?f:"",m,function(b){b&&0!==b.length&&(m?(r=b,a.hidePreloader(),e.find('.modal-footer [data-bb-handler="success"]').click()):(c("#media-image",e).attr("src",b),a.hidePreloader()));a.hidePreloader()});return!1};var h=e.find("#media-image-link");e.on("click.media-click",".browse-computer-section",function(g){g.preventDefault();g=c.extend(!0,{quality:80},
b.image);a.showPreloader();Bridge.openImage(d("Select Image"),"","",a.projectSettings.imageResize?g:"",function(b){b&&0!==b.length?m?(r=b,a.hidePreloader(),e.find('.modal-footer [data-bb-handler="success"]').click()):(c("#media-image",e).attr("src",b),a.hidePreloader()):a.hidePreloader()},m,x,function(b){b&&(a.showError(d("Your image is too large to be resized in the app. Please resize it before adding. You can disable the Resize Images option in Site Settings -> Optimization.")),a.hidePreloader())})});
e.on("click.media-click",".btn-crop, #media-image",function(b){b.preventDefault();b=a.showDialog({title:d("Edit Image"),className:"crop-image-dialog",body:'<div class="row form-group"><div class="col-md-12"><div><img src="'+e.find("#media-image").attr("src")+'" id="crop-image"></div></div></div><div class="row"><div class="col-sm-12 crop-options"><div class="crop-image-transform"><button class="btn btn-material-light-blue crop-zoom-in mbr-icon-search-plus" title="'+d("Zoom In")+'"></button><button class="btn btn-material-light-blue crop-zoom-out mbr-icon-search-minus" title="'+
d("Zoom Out")+'"></button><button class="btn btn-material-light-blue crop-scale-x mbr-icon-exchange" title="'+d("Flip Horizontal")+'"></button><button class="btn btn-material-light-blue crop-scale-y mbr-icon-arrows-vertical" title="'+d("Flip Vertical")+'"></button><button class="btn btn-material-light-blue rotate-counter-clockwise mbr-icon-alternate-undo" title="'+d("Counter Clockwise")+'"></button><button class="btn btn-material-light-blue rotate-clockwise mbr-icon-alternate-redo" title="'+d("Clockwise")+
'"></button></div><div class="crop-aspect-ratio"><button class="btn btn-material-light-blue crop-ratio-16-9" title="'+d("Aspect Ratio")+': 16:9">16:9</button><button class="btn btn-material-light-blue crop-ratio-4-3" title="'+d("Aspect Ratio")+': 4:3">4:3</button><button class="btn btn-material-light-blue crop-ratio-1-1" title="'+d("Aspect Ratio")+': 1:1">1:1</button><button class="btn btn-material-light-blue crop-ratio-2-3" title="'+d("Aspect Ratio")+': 2:3">2:3</button><button class="btn btn-material-light-blue crop-ratio-free active" title="'+
d("Aspect Ratio: Free")+'">'+d("Free")+"</button></div></div></div>",show:function(a){a.find(".crop-options .btn").tooltipster({delay:0,speed:100,position:"bottom"})},cancel:function(){},success:function(){var a=Bridge.splitPath(f.attr("src")).ext;"jpg"===a&&(a="jpeg");a=f.cropper("getCroppedCanvas").toDataURL("image/"+a);var b=a.match(/data:image\/([a-zA-Z]*);base64,/)[1];b=Bridge.splitPath(e.find("#media-image").attr("src")).name+"."+b;var c=Bridge.tempLocation+"/open"+Bridge.dateFormat(new Date,
"yyyyMMdd_hhmmss")+"/"+b;a=a.replace(/data:image\/([a-zA-Z]*);base64,/,"");Bridge.saveLocalBase64(c,a,function(a){a&&e.find("#media-image").attr("src",c)})}});var f=b.find("#crop-image");b.on("shown.bs.modal",function(){f.cropper({viewMode:2,guides:!1})});c(".rotate-counter-clockwise").click(function(a){f.cropper("rotate",-45)});c(".rotate-clockwise").click(function(a){f.cropper("rotate",45)});b.on("click.media-click",".crop-zoom-in",function(a){f.cropper("zoom",.1)});b.on("click.media-click",".crop-zoom-out",
function(a){f.cropper("zoom",-.1)});b.on("click.media-click",".crop-scale-x",function(a){a=f.cropper("getData");f.cropper("scale",-a.scaleX,a.scaleY)});b.on("click.media-click",".crop-scale-y",function(a){a=f.cropper("getData");f.cropper("scale",a.scaleX,-a.scaleY)});b.on("click.media-click",".crop-ratio-16-9",function(a){f.cropper("setAspectRatio",16/9);c(this).addClass("active").siblings().removeClass("active")});b.on("click.media-click",".crop-ratio-4-3",function(a){f.cropper("setAspectRatio",
4/3);c(this).addClass("active").siblings().removeClass("active")});b.on("click.media-click",".crop-ratio-1-1",function(a){f.cropper("setAspectRatio",1);c(this).addClass("active").siblings().removeClass("active")});b.on("click.media-click",".crop-ratio-2-3",function(a){f.cropper("setAspectRatio",2/3);c(this).addClass("active").siblings().removeClass("active")});b.on("click.media-click",".crop-ratio-free",function(a){f.cropper("setAspectRatio",NaN);c(this).addClass("active").siblings().removeClass("active")})});
e.on("click.media-click","#media-image-link, .media-image-link-btn",function(c){c.preventDefault();c.stopPropagation();c={url:h.val(),isNewWindow:b.image.linkInNewWindow};a.showMbrLinkDialog(c,function(a){h.val(a.url);l=a.isNewWindow;b.image.linkInNewWindow=a.isNewWindow})});a.fire("showedMediaImageDialog",e,b,m);(new Promise(function(a,b){u?a():Bridge.getSettings("lastMediaImageTab",function(b){u=b?b:"#onlineLibrary";a()})})).then(function(){e.find('.nav-tabs a[href="'+u+'"]').tab("show");a.fire("showedPopup",
e);a.initTooltips()})}})},showMediaVideoDialog:function(b,e){a.fire("showMediaVideoDialog");var k=a.showDialog({title:d("Media Video"),className:"note-air-layout media-video-dialog",body:a.applyFilter("showMediaVideoDialog",['<div class="row"><div class="col-md-12">\n<form class="media-video-form">\n<div class="form-group row clearfix">','<label class="col-md-3 control-label" for="media-video-src">'+d("Video URL")+"</label>",'<div class="col-md-9">','<input id="media-video-src" class="form-control" name="src" type="text" value="'+
(b.video.src||"")+'">','<small class="help-block">'+d("YouTube, Vimeo, or custom e.g. https://site.com/video.mp4")+"</small>",'</div>\n</div>\n<div class="form-group row clearfix">','<label class="col-md-3 control-label">'+d("Aspect Ratio")+"</label>",'<div class="col-md-9">\n<select id="media-video-aspectratio" class="form-control" name="aspectratio">\n<option>16:9</option>',"<option "+("4:3"==b.video.aspectratio?"selected":"")+">4:3</option>",'</select>\n</div>\n</div>\n<div class="form-group row clearfix">',
'<label class="col-md-3 control-label" for="media-video-autoplay">'+d("Autoplay")+"</label>",'<div class="togglebutton col-md-9">\n<label>','<input id="media-video-autoplay" type="checkbox" name="autoplay" '+(b.video.autoplay?"checked":"")+">",'<span class="toggle"></span>\n</label>\n</div>\n</div>\n<div class="form-group row clearfix">','<label class="col-md-3 control-label" for="media-video-loop">'+d("Loop")+"</label>",'<div class="togglebutton col-md-9">\n<label>','<input id="media-video-loop" type="checkbox" name="loop" '+
(b.video.loop?"checked":"")+">",'<span class="toggle"></span>\n</label>\n</div>\n</div>\n</form>\n</div></div>'].join("\n"),b),cancel:function(){a.fire("cancelMediaVideoDialog",this)},show:function(b){var c=/youtu.*be.*/,f=/vimeo/;b.find("#media-video-src").on("change",function(b){var e=b.target.value;b.target.value&&-1===e.search(c)&&-1===e.search(f)&&-1===e.search(/(?:((?:https|http):\/\/)|(?:\/)).+(?:.mp4)/)&&a.showError(d("Unsupported video format. MP4 only."))})},success:function(){var d=c(this).find("form.media-video-form").serializeArray();
if(d&&d.length){for(var k=!1,l=!1,h=0;h<d.length;h++)"autoplay"==d[h].name?k=d[h].value:"loop"==d[h].name?l=d[h].value:b.video[d[h].name]=d[h].value;b.video.autoplay=k;b.video.loop=l;!1===b.video.autoplay&&(b.video.src=b.video.src.replace(/[&?]autoplay=1/,""));!1===b.video.loop&&(b.video.src=b.video.src.replace(/[&?]loop=1/,""))}for(h in b)b[h].active=void 0;b.video.active=!0;b=a.applyFilter("saveMediaVideoDialog",b);a.fire("saveMediaVideoDialog",this);e(b)}});a.fire("showedMediaVideoDialog",k);a.fire("showedPopup",
k)}},events:{modalDialogHide:function(a){a.hasClass("media-image")&&(u=a.find(".nav-tabs .active a").attr("href"),Bridge.setSettings("lastMediaImageTab",u))}}})},["jQuery","mbrApp","TR()"]);
