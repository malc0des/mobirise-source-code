defineM(function(a,c,d){function f(b){var a=c.Core.getPages(),g=[];b.match(/\/$/i)&&(b=b.slice(0,-1));var d=b.match(/https?:\/\//i)[0];b=punycode.toASCII(b.slice(d.length));b=d+b;for(var f in a)g.push("\t<url>","\t\t<loc>"+b+"/"+f.toString()+"</loc>","\t</url>");g=g.join("\n");return['<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">',g,"</urlset>"].join("\n")}function h(b){Bridge.saveLocalFile(c.projectPath+"/sitemap.xml",b)}function l(b){a("#sitemapSwitcher").change(function(e){var d=
a(e.target).prop("checked");c.projectSettings.sitemapSwitcher=d;c.projectSettings.siteUrl="";c.projectSettings.sitemapSwitcherAuto="on";c.changeProjectSettings(b,{siteUrl:""});c.changeProjectSettings(b,{sitemapSwitcherAuto:"on"});a("#siteUrl").val("");a("#sitemapSwitcherAuto").prop("checked",!0);a(e.target).prop("checked")?(k(),a(".togglebutton").has("#sitemapSwitcher").prev("label").addClass("col-auto").removeClass("col"),a(".togglebutton").has("#sitemapSwitcherAuto").show(),a(".togglebutton").has("#sitemapSwitcherAuto").prev("label").show(),
a(".form-group").has("#siteUrl").show(),a(".form-group").has(".sitemapEdit").hide(),a("input[name='siteUrlModal']").on("input",function(){a(this).val().match(/^https?:\/\/.*/i)?a(".site-url-error").hide():a(".site-url-error").show()}),a(".site-url-modal").on("hidden.bs.modal",function(){a(".site-url-modal").remove();c.projectSettings.siteUrl||a("#sitemapSwitcher").trigger("click")})):(a(".togglebutton").has("#sitemapSwitcher").prev("label").addClass("col").removeClass("col-auto"),a(".form-group").has("#siteUrl").hide(),
a(".togglebutton").has("#sitemapSwitcherAuto").hide(),a(".togglebutton").has("#sitemapSwitcherAuto").prev("label").hide(),a(".form-group").has(".sitemapEdit").hide())});a("#siteUrl").click(function(){k()});a("#sitemapSwitcherAuto").change(function(e){e=a(e.target).prop("checked");h(f(c.projectSettings.siteUrl));e?(a("#siteUrl").parents(".form-group").show(),a(".sitemapEdit").parents(".form-group").hide()):(a("#siteUrl").parents(".form-group").hide(),a(".sitemapEdit").parents(".form-group").show());
c.projectSettings.sitemapSwitcherAuto=e?"on":"";c.changeProjectSettings(b,{sitemapSwitcherAuto:e?"on":""});return!0});a(".sitemapEdit").click(function(b){b.preventDefault();Bridge.loadLocalFile(c.projectPath+"/sitemap.xml",function(b){c.showDialog({title:d("Edit sitemap.xml"),className:"sitemap-modal",body:['<form class="page-settings-form">\n<div class="form-group row clearfix">\n<div class="col-md-12">\n<textarea class="form-control sitemapText" name="robotsText" rows="15">',b,"</textarea>\n</div>\n</div>\n</form>"].join("\n"),
buttons:[{label:"save",default:!0,callback:function(){h(a(".sitemapText").val())}}]})});a(".sitemap-modal").on("hidden.bs.modal",function(){a(".sitemap-modal").remove()})})}function m(b){a("#robotsSwitcher").change(function(b){b=a(b.target).prop("checked");(c.projectSettings.robotsSwitcher=b)&&a(".robotsEdit").click();c.projectSettings.robotsText="User-agent: *\r\nDisallow: /cgi-bin\r\n";a(".robotsText").val("User-agent: *\r\nDisallow: /cgi-bin\r\n");a(".robotsEdit").parents(".form-group").toggle()});
a(".robotsEdit").click(function(e){e.preventDefault();c.showDialog({title:d("Edit robots.txt"),className:"robots-modal",body:['<form class="page-settings-form">\n<div class="form-group row clearfix">\n<div class="col-md-12">\n<textarea class="form-control robotsText" name="robotsText" rows="10">',c.projectSettings.robotsText,"</textarea>\n</div>\n</div>\n</form>"].join("\n"),buttons:[{label:"save",default:!0,callback:function(){c.changeProjectSettings(b,{robotsText:a(".robotsText").val()});c.projectSettings.robotsText=
a(".robotsText").val()}}]})})}function k(){c.showDialog({title:d("Enter site URL"),className:"site-url-modal",body:['<form class="page-settings-form">\n<div class="form-group row clearfix">\n<div class="col-md-12">','<span class="site-url-error" style="color: red;display: none;">'+d('URL is not valid! (must be like "http://mysite.com")')+"</span>",'<input class="form-control" type="text" name="siteUrlModal" placeholder="http://mysite.com" value="'+c.projectSettings.siteUrl+'">',"</div>\n</div>\n</form>"].join("\n"),
buttons:[{label:"save",default:!0,callback:function(){var b=a("input[name='siteUrlModal']");if(b.val().match(/^https?:\/\/.*/i))c.projectSettings.siteUrl=b.val(),a("#siteUrl").parents(".form-group").show(),a("#siteUrl").val(b.val()),a(".sitemapEdit").parents(".form-group").hide();else return a(".site-url-error").show(),b.focus(),c.projectSettings.siteUrl="",!1}}]})}c.regExtension({name:"seo",events:{shownSidebarProjectSettings:function(b,a){m(a);l(a)},load:function(){var b=this;c.addFilter("sidebarProjectSettings",
function(a){var c={title:d("SEO & Analytics"),name:"seo-analytics",html:'<div class="form-group col-md-12"><div class="row"><label class="col control-label" for="robotsSwitcher">'+d("Use robots.txt")+'</label><div class="togglebutton col-auto"><label><input type="checkbox" id="robotsSwitcher" name="robotsSwitcher" '+(b.projectSettings.robotsSwitcher?"checked":"")+'><span class="toggle" style="margin:0;"></span></label></div></div></div><div class="form-group col-md-12"'+(b.projectSettings.robotsSwitcher?
">":' style="display: none;">')+'<button class="btn btn-primary pull-right robotsEdit" type="button">'+d("Edit Robots.txt")+'</button></div><div class="form-group col-md-12"><div class="row"><label class="'+(b.projectSettings.sitemapSwitcher?"col-auto":"col")+' control-label" for="sitemapSwitcher">'+d("Use sitemap.xml")+'</label><div class="col-auto togglebutton"><label><input type="checkbox" id="sitemapSwitcher" name="sitemapSwitcher" '+(b.projectSettings.sitemapSwitcher?"checked":"")+'><span class="toggle" style="margin:0;"></span></label></div><label class="col text-right control-label"'+
(b.projectSettings.siteUrl&&"undefined"!==b.projectSettings.siteUrl&&b.projectSettings.sitemapSwitcher?"":'style="display:none"')+' for="sitemapSwitcherAuto">'+d("Auto")+'</label><div class="col-auto togglebutton"'+(b.projectSettings.siteUrl&&"undefined"!==b.projectSettings.siteUrl&&b.projectSettings.sitemapSwitcher?"":'style="display:none"')+'><label><input type="checkbox" id="sitemapSwitcherAuto" name="sitemapSwitcherAuto" '+(b.projectSettings.sitemapSwitcherAuto?"checked":"")+'><span class="toggle" style="margin:0;"></span></label></div></div></div><div class="form-group col-md-12" '+
(b.projectSettings.siteUrl&&b.projectSettings.sitemapSwitcherAuto&&b.projectSettings.sitemapSwitcher?"":'style="display: none;"')+'><input class="form-control" type="text" id="siteUrl" name="siteUrl" placeholder="http://mysite.com" '+(b.projectSettings.siteUrl?'value="'+b.projectSettings.siteUrl+'"':"")+'readonly></div><div class="form-group col-md-12"'+(b.projectSettings.siteUrl&&!b.projectSettings.sitemapSwitcherAuto&&b.projectSettings.sitemapSwitcher?">":'style="display: none;">')+'<button class="btn btn-primary pull-right sitemapEdit" type="button">'+
d("Edit Sitemap Settings")+"</button></div>"};a.push(c);return a});b.addFilter("publishFiles",function(a){b.projectSettings.robotsSwitcher&&a.push({srcList:[{src:"robots.txt",filter:"template"}],dest:"robots.txt"});b.projectSettings.siteUrl&&"undefined"!==b.projectSettings.siteUrl&&(b.projectSettings.sitemapSwitcherAuto?a.push({srcList:[{src:"sitemap.xml",filter:"template"}],dest:"sitemap.xml"}):a.push({srcList:[{src:c.projectPath+"/sitemap.xml"}],dest:"sitemap.xml"}));return a});b.addFilter("publishTemplating",
function(a,c){return"robots.txt"==c?b.projectSettings.robotsText:"sitemap.xml"==c?f(b.projectSettings.siteUrl):a})}}})},["jQuery","mbrApp","TR()"]);
