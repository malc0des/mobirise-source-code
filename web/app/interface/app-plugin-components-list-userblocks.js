var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,e){a instanceof String&&(a=String(a));for(var k=a.length,d=0;d<k;d++){var r=a[d];if(b.call(e,r,d,a))return{i:d,v:r}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,e,k){if(b){e=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var d=a[k];d in e||(e[d]={});e=e[d]}a=a[a.length-1];k=e[a];b=b(k);b!=k&&null!=b&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(e){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(e||"")+"_"+b++,e)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,k={next:function(){if(e<a.length){var d=e++;return{value:b(d,a[d]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Object.is",function(a){return a?a:function(b,a){return b===a?0!==b||1/b===1/a:b!==b&&a!==a}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,a){var e=this;e instanceof String&&(e=String(e));var d=e.length;a=a||0;for(0>a&&(a=Math.max(a+d,0));a<d;a++){var r=e[a];if(r===b||Object.is(r,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,a){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,a||0)}},"es6","es3");
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function e(b){return b instanceof d?b:new d(function(a,c){a(b)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(b){if(null==this.batch_){this.batch_=[];var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})}this.batch_.push(b)};var k=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(b){k(b,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=
this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var c=b[a];b[a]=null;try{c()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};b.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var d=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{b(a.resolve,a.reject)}catch(c){a.reject(c)}};d.prototype.createResolveAndReject_=function(){function b(b){return function(f){c||(c=!0,b.call(a,f))}}var a=this,c=!1;
return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};d.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof d)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var a=null!=b;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};d.prototype.resolveToNonPromiseObj_=function(b){var a=void 0;try{a=b.then}catch(c){this.reject_(c);return}"function"==typeof a?
this.settleSameAsThenable_(a,b):this.fulfill_(b)};d.prototype.reject_=function(b){this.settle_(2,b)};d.prototype.fulfill_=function(b){this.settle_(1,b)};d.prototype.settle_=function(b,a){if(0!=this.state_)throw Error("Cannot settle("+b+", "+a+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=a;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=0;b<this.onSettledCallbacks_.length;++b)r.asyncExecute(this.onSettledCallbacks_[b]);
this.onSettledCallbacks_=null}};var r=new b;d.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};d.prototype.settleSameAsThenable_=function(b,a){var c=this.createResolveAndReject_();try{b.call(a,c.resolve,c.reject)}catch(f){c.reject(f)}};d.prototype.then=function(b,a){function c(b,a){return"function"==typeof b?function(a){try{f(b(a))}catch(q){m(q)}}:a}var f,m,e=new d(function(b,a){f=b;m=a});this.callWhenSettled_(c(b,f),c(a,m));return e};
d.prototype.catch=function(b){return this.then(void 0,b)};d.prototype.callWhenSettled_=function(b,a){function c(){switch(f.state_){case 1:b(f.result_);break;case 2:a(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?r.asyncExecute(c):this.onSettledCallbacks_.push(c)};d.resolve=e;d.reject=function(b){return new d(function(a,c){c(b)})};d.race=function(b){return new d(function(a,c){for(var f=$jscomp.makeIterator(b),m=f.next();!m.done;m=f.next())e(m.value).callWhenSettled_(a,
c)})};d.all=function(b){var a=$jscomp.makeIterator(b),c=a.next();return c.done?e([]):new d(function(b,m){function f(a){return function(c){g[a]=c;d--;0==d&&b(g)}}var g=[],d=0;do g.push(void 0),d++,e(c.value).callWhenSettled_(f(g.length-1),m),c=a.next();while(!c.done)})};return d},"es6","es3");
defineM("app-plugin-components-list-userblocks",function(a,b,e){function k(){b.$template.on("click",".app-component .component-save",function(c){c.stopPropagation();var f=a(this).closest(".app-component").attr("data-app-component-id");f=b.Core.getComponent(f,void 0,!0);var m={};m.data=f;m.themeName=f._sourceTheme||b.theme.name;m.parent=f._name;v=!0;b.addUserBlock(m,function(){var a=b.$componentsLayer.find(".app-layer-cont");b.$componentsToggleBtn.click();b.$componentsLayer.find(".add-component-filter").find('[data-filter="User"]').click();
b.updateUserBlocks(!0,function(){a.scrollTop(a[0].scrollHeight)})},a(c.target))})}function d(){b.$componentsLayer.on("click",".app-layer-cont-user-block .btn-delete",function(c){var f=a(c.target).closest(".app-layer-cont-user-block")[0].hasAttribute("data-num")?a(c.target).closest(".app-layer-cont-user-block").attr("data-num"):a(c.target).closest(".app-layer-cont-user-block").find("a").attr("data-num");b.confirmDlg({message:e("Remove Block?"),className:"user-block-remove-dlg",callback:function(a){a&&
b.removeUserBlock(f,function(){b.updateUserBlocks()})}});c.stopPropagation()})}function r(){var c;b.$componentsLayer.on("click",".app-layer-cont-user-block .user-block-name-wrap:not(.editing) .user-block-name, .app-layer-cont-user-block .user-block-name-wrap:not(.editing) .user-block-btn-edit",function(b){var f=a(b.target).closest(".user-block-name-wrap").find(".user-block-name");c=f.html();a(b.target).closest(".user-block-name-wrap").addClass("editing");f.attr("contenteditable","");b=document.createRange();
var d=window.getSelection();b.selectNodeContents(f[0]);d.removeAllRanges();d.addRange(b)});b.$componentsLayer.on("paste",".app-layer-cont-user-block .editing [contenteditable]",function(b){b.preventDefault();b=((b.originalEvent||b).clipboardData||window.clipboardData).getData("text/plain");a(this).html(b)});b.$componentsLayer.on("blur keydown",".app-layer-cont-user-block .editing [contenteditable]",function(f){var d=a(this);if("focusout"===f.type){f=d.closest(".app-layer-cont-user-block")[0].hasAttribute("data-num")?
d.closest(".app-layer-cont-user-block").attr("data-num"):d.closest(".app-layer-cont-user-block").find("a").attr("data-num");var e="Extension"===b.getTypeOfComponent(b.userBlocks[f].parent)?b.getAccountPath()+"/"+n+"/extensions/":b.getAccountPath()+"/"+n+"/"+("secondary"==b.theme.type?b.userBlocks[f].themeName:b.theme.name)+"/";b.userBlocks[f].customName=d.html();Bridge.saveLocalFile(e+b.userBlocks[f].blockName+"/userblock.js",JSON.stringify(b.userBlocks[f],null,"\t"),function(){d.closest(".user-block-name-wrap").removeClass("editing");
d.removeAttr("contenteditable")})}else 13===f.which?(f.preventDefault(),d.trigger("blur")):27===f.which&&(d.html(c),d.closest(".user-block-name-wrap").removeClass("editing"),d.removeAttr("contenteditable"))})}var v=!1,n="userblocks";b.regExtension({name:"components-userblock",global:{userBlocks:[],getTypeOfComponent:function(a){a=b.components[a];return a?(a=a._tags)?-1!=a.indexOf("Extension")?"Extension":"Theme":"Theme":null},getRegPlugin:function(b){var a=this.registeredPlugins,c;for(c in a)if(a[c].name===
b)return a[c];return!1},registerUserblockPlugins:function(b,a){a=this.applyFilter("registerPlugin",a);this.fire("registerPlugin",a);this.registeredPlugins.push(a);this.fire("registeredPlugin",a);this.fire("pluginsLoaded")},getUserBlocks:function(c,d){if(b.getAccountPath()){var f=b.getAccountPath()+"/"+n+"/"+b.theme.name+"/list.json",e=b.getAccountPath()+"/"+n+"/extensions/list.json",g=[],h=[],l=a.Deferred(),q=a.Deferred(),p=a.Deferred(),w=a.Deferred();b.getSecondaryThemesList(function(a){for(var c=
0;c<a.length;c++)g.push(b.getAccountPath()+"/"+n+"/"+a[c]+"/list.json");h=a;w.resolve()});var k=[],u={},C;a.when(w).done(function(){a.each(g,function(b,c){C=function(b,c){var d=new a.Deferred;Bridge.getLocalJSON(g[b],function(a){u[h[b]]=a;return d.resolve()});return d.promise()}(b,c);k.push(C)});a.when.apply(a,k).done(function(){p.resolve(u)})});a.when(l,q,p).done(function(g,f,q){var e=[];a.when(function(){function c(b,c,g,f){var q=a.Deferred();Bridge.getLocalJSON(b+c+"/userblock.js",function(b){setTimeout(function(){q.resolve()},
1);b&&b.blockName&&e.push(b)},function(b){q.resolve();d()});h.push(q.promise())}var l=a.Deferred(),h=[];if("secondary"==b.theme.type)for(var p in q)a(u[p]).each(function(a,g){c(b.getAccountPath()+"/"+n+"/"+p+"/",g)});else g&&0<g.length&&g.map(c.bind(this,b.getAccountPath()+"/"+n+"/"+b.theme.name+"/"));f&&0<f.length&&f.map(c.bind(this,b.getAccountPath()+"/"+n+"/extensions/"));a.when.apply(a,h).then(function(){l.resolve()}).fail(function(){l.resolve()});return l.promise()}()).done(function(){c(b.applyFilter("filterUserBlocks",
e))})});Bridge.getLocalJSON(f,function(b){l.resolve(b)});Bridge.getLocalJSON(e,function(b){q.resolve(b)})}else d()},addUserBlock:function(c,d,e){function f(b,a){var c=b.match(/(.+_)(\d+)\.(\w+)$/i);return c?c[1]+a+"."+c[3]:(c=b.match(/(.+)\.(\w+)$/i))?c[1]+"_"+a+"."+c[2]:b+a}var g=1;if(0<b.userBlocks.length){do{var h=c.parent+"_"+g++;var l=b.userBlocks.filter(function(b){return b.blockName==h})}while(0<l.length);c.blockName=h}else c.blockName=c.parent+"_"+g;(function(c){var g=b.getAccountPath()+"/"+
n+"/"+c.themeName+"/"+c.blockName+"/";if("Extension"===b.getTypeOfComponent(c.parent))var l=b.getAccountPath()+"/"+n+"/extensions/",h=l+"list.json";else l=b.getAccountPath()+"/"+n+"/"+c.themeName+"/",h=l+"list.json";Bridge.dirList(g,function(q){var p=[];b.userBlocks.map(function(a){b.getTypeOfComponent(a.parent)===b.getTypeOfComponent(c.parent)&&a.themeName===b.theme.name&&p.push(a.blockName)});p.push(c.blockName);Bridge.saveLocalFile(h,JSON.stringify(p));var m=a.Deferred(),k=a.Deferred(),w=a.Deferred(),
n=[],u=[],x,B,t=c.data,r,v=function(){r=JSON.stringify(c,function(a,c){if(0!=a.indexOf("uname__")&&(null==c||"object"!=typeof c||b.Core.isSerializableObject(c)))return c},"\t");var g=e.offset().top-e.closest("html").scrollTop()+a(".navbar-devices").outerHeight();b.$componentsParams.addClass("hidden-interface");b.Core.$body.find(".app-component-menu").addClass("hidden-interface");b.Core.$body.find(".tooltipster-base").addClass("hidden-interface");b.Core.$body.find(".note-air-layout").addClass("hidden-interface");
b.$body.find(".app-layer").addClass("hidden-interface");b.$body.find(".app-sidebar").addClass("hidden-interface");b.$body.find(".app-components-toggle").addClass("hidden-interface");b.$body.find(".app-theme-settings-toggle").addClass("hidden-interface");b.$body.find(".cts").hide();var f=e.closest(".app-component").find("> .app-component-content > *:eq(0)"),h=f.outerHeight(),q=f.outerWidth(),p=parseInt(b.Core.$body.css("padding-left"));0===h&&(h=90);var m=Math.round(250/q*h);f=new Date;var k=Bridge.tempLocation+
"/screen"+f.getFullYear()+f.getMonth()+f.getDay()+"_"+f.getHours()+f.getMinutes()+f.getSeconds()+".jpg";setTimeout(function(){Bridge.getScreen(function(a){b.$componentsParams.removeClass("hidden-interface");b.Core.$body.find(".app-component-menu").removeClass("hidden-interface");b.Core.$body.find(".note-air-layout").removeClass("hidden-interface");b.$body.find(".app-layer").removeClass("hidden-interface");b.$body.find(".app-sidebar").removeClass("hidden-interface");b.$body.find(".app-components-toggle").removeClass("hidden-interface");
b.$body.find(".app-theme-settings-toggle").removeClass("hidden-interface");Bridge.copyLocal(a,l+"/"+c.blockName+"/thumb.png",function(){Bridge.saveLocalFile(l+c.blockName+"/userblock.js",r,function(){var a=JSON.parse(r);b.userBlocks.push(a);b.fire("addedUserBlock",a);d()})})},k,[250,m],[p,g,q,h])},100)};if(t._customHTML){var y=1,z=a("<div>").html(t._customHTML),A=[],D={};z.find("img").each(function(c){var d=a(this),l=a(this).attr("src").split("/").pop(),e;x=function(){var c=new a.Deferred,h=a.Deferred();
if(0==a(d).attr("src").indexOf("file:/"))e=a(d).attr("src"),h.resolve();else if(0===a(d).attr("src").slice(6).indexOf("app/themes"))e="web/"+a(d).attr("src").slice(6),h.resolve();else if(0===a(d).attr("src").indexOf("http"))h.resolve();else{var p=b.getAddonDir(t.alias||b.theme.name);p=t.alias?p+"/":p+"/components/";Bridge.isExistsLocal(p+a(d).attr("src").slice(3),function(b){e=b?p+a(d).attr("src").slice(3):p+t._name+"/"+a(d).attr("src");h.resolve()})}a.when(h).then(function(){-1!==q.indexOf(l)&&(l=
f(l,y),y++);0===a(d).attr("src").indexOf("http")?c.resolve():Bridge.copyLocal(e,g+l,function(b){A.push(g+l);a(d).attr("src",b);c.resolve()})});return c.promise()}();n.push(x)});a.when.apply(a,n).done(function(){m.resolve()});z.find('input[type="image"]').each(function(c){var d=a(this),l=a(this).attr("value").split("/").pop(),e;x=function(){var c=new a.Deferred,h=a.Deferred(),p=t.alias?t.alias.split("/components")[0]:b.theme.name,m=t.alias?t.alias:p+"/components";0==a(d).attr("value").indexOf("file:/")?
(e=a(d).attr("value"),h.resolve()):0===a(d).attr("value").indexOf("http")?(e=a(d).attr("value"),c.resolve()):p in b.getBuildinAddons()?Bridge.isExistsLocal("web/app/themes/"+m+"/"+a(d).attr("value"),function(b){e=b?"web/app/themes/"+m+"/"+a(d).attr("value"):"web/app/themes/"+m+"/"+a(d).attr("value").slice(3);h.resolve()}):Bridge.isExistsLocal(b.path2core(b.getAddonDir(m))+"/"+a(d).attr("value"),function(c){e=c?b.path2core(b.getAddonDir(m))+"/"+a(d).attr("value"):b.path2core(b.getAddonDir(m))+"/"+
a(d).attr("value").slice(3);h.resolve()});a.when(h).then(function(){-1!==q.indexOf(l)&&(l=f(l,y),y++);Bridge.copyLocal(e,g+l,function(){A.push(g+l);a(d).attr("value",g+l);c.resolve()})});return c.promise()}();u.push(x)});a.when.apply(a,u).done(function(){k.resolve()});w.resolve()}else v();a.when(m,k,w).done(function(){B=z.html();t._customHTML=B;z.remove();c.mediaPaths=JSON.stringify(A);c.isUserblock="true";c.isAMP=b.theme.params.theme.isAMP;0!==Object.keys(D).length&&(c.plugins=D);v()})},{names:["*"],
filter:1,recursive:!1})})(c)},removeUserBlock:function(a,d){if("Extension"===b.getTypeOfComponent(b.userBlocks[a].parent))var c=b.getAccountPath()+"/"+n+"/extensions/",f=c+"list.json";else c=b.getAccountPath()+"/"+n+"/"+("secondary"==b.theme.type?b.userBlocks[a].themeName:b.theme.name)+"/",f=c+"list.json";var g=b.userBlocks.splice(a,1);(function(){var a=[];b.userBlocks.map(function(c){b.getTypeOfComponent(c.parent)===b.getTypeOfComponent(g[0].parent)&&g[0].themeName===c.themeName&&a.push(c.blockName)});
Bridge.saveLocalFile(f,JSON.stringify(a));Bridge.removeLocal(c+g[0].blockName)})();d()},updateUserBlocks:function(c,d){function f(c,d){var g=a.Deferred(),f="Extension"===b.getTypeOfComponent(d.parent)?b.getAccountPath()+"/"+n+"/extensions/":b.getAccountPath()+"/"+n+"/"+d.themeName+"/";Bridge.isExistsLocal(f+d.blockName+"/thumb.png",function(b){b?g.resolve(f+d.blockName+"/thumb.png"):g.resolve((c?e.getAddonDir(c):e.theme.path+"/components")+"/"+d.data._name+"/thumb.png")});return g}var e=b,g=e.$componentsLayer.find(".app-layer-cont");
g.find(".app-layer-cont-user").html("");if(e.userBlocks&&Array.isArray(e.userBlocks)&&0<e.userBlocks.length){var h="",l=[];e.userBlocks.map(function(c,d){var g=c.data.alias,p,m=a.Deferred();l.push(m);f(g,c).then(function(a){p=a;if("secondary"==b.theme.type||e.components[c.data._name])a={},a.num=d,c.data._once&&(a["component-once"]=c.data._once),a.filter="User",h+=b.generateComponentPaletteItemHtml(c.data._name,p,"app-layer-cont-user-block",a,'<div class="user-block-name-wrap"><span class="user-block-name">'+
(c.customName||c.date||c.blockName)+'</span><div class="btn-group"><span class="btn btn-info user-block-btn-edit"><i class="mbr-icon-pencil"></i></span><span class="btn btn-info user-block-btn-ok"><i class="mbr-icon-check"></i></span></div></div><div class="btn-group"><span class="btn btn-material-red btn-delete"><i class="mbr-icon-trash"></i></span></div>');m.resolve()})});a.when.apply(a,l).then(function(){b.insertComponentPaletteHTML(h,"User Blocks","app-layer-cont-user row","user-block-group-label");
if(c){var a=g.find(".app-layer-cont-user-block").last();a.addClass("just-added");setTimeout(function(){a.removeClass("just-added")},2E3)}b.cleanOnceComponents();b.fire("updatedUserBlocks");d&&d()})}}},events:{load:function(){b.on(["addonsLoaded","signedin"],function(){b.getUserBlocks(function(a){b.userBlocks=a;b.updateUserBlocks();b.fire("initedComponentsPalette")},function(a){b.userBlocks=[]})})},updatedUserBlocks:function(){var a=b.$componentsLayer.find(".app-layer-cont");if(!a.find(".user-block-search").length){var d=
'<input class="user-block-search form-control" type="text" placeholder="'+e("Search")+'" value="">';a.find(".app-layer-cont-user").before(d)}b.$componentsLayer.find(".app-layer-cont .user-block-search").val("")},coreLoad:function(){b.$body.find(".navbar-devices").on("click","a",function(c){a(this).find("i").hasClass("mbr-icon-desktop")?b.Core.$body.find(".component-save").css("display","inline-block"):b.Core.$body.find(".component-save").css("display","none")});var c=this,f={},m=function(c){if(Object.keys(f).includes(c))return a.Deferred().resolve(f[c]);
var d=a.Deferred();Bridge.getLocalJSON(b.getAddonDir(c)+"/plugins/plugin.json",function(a){f[c]=a;d.resolve(f[c])});return d};c.getUserBlocks(function(a){c.userBlocks=a},function(a){c.userBlocks=[]});k();d();r();c.Core.addFilter("prepareComponent",function(c,d){if(b.accountMode.isOffline())return c;d=a("<div>").html(c);c='<span class="mbr-btn component-save mbr-icon-download" data-tooltipster="bottom" title="'+e("Save To User Blocks")+'"></span>';d.find(".app-component-edit span").first().after(c);
c=d.html();d.remove();return c});Bridge.getLocalJSON(b.getAccountPath()+"/userplugins/plugins.json",function(a){b.registeredUserPlugins=a});c.Core.addFilter("addComponent",function(d,f,e){var g=a.Deferred();if(e&&void 0!=e.attr("data-num")){var h=c.userBlocks[e.attr("data-num")];e=h.data;if(!f&&e){e._styles&&(d._styles=e._styles);e._customHTML&&(d._customHTML=e._customHTML);e._customCSS&&(d._customCSS=e._customCSS);e._customTemplate&&(d._customTemplate=e._customTemplate);e._JSplaceholders&&(d._JSplaceholders=
e._JSplaceholders);e._PHPplaceholders&&(d._PHPplaceholders=e._PHPplaceholders);for(var l in d)0!=l.indexOf("_")&&(d[l]=e[l]);d._params||(d._params={});a.extend(d._params,e._params);f=d._name.replace(/^pro\./i,"");f=f.replace(/\./g,"_")+"-";d._anchor=f+c.Core.getUniqCompName();if(b.isSecondaryComponent(d)&&h&&h.mediaPaths){var m=JSON.parse(h.mediaPaths),k=a.when(),n=e._customHTML;a.each(m,function(c,d){k=k.then(function(){var d=a.Deferred();Bridge.saveFileUnique(m[c],b.projectPath+"/assets/images",
function(a){d.resolve(a)});return d.promise()}).then(function(a){n=n.replace(m[c],a)})});k.then(function(){d._customHTML=n;d._isUserblock=!0;d._sourceTheme=h.themeName;g.resolve(d)})}else return d}return g.promise()}return d});c.Core.on("loadedComponent",function(a,c,d,e){if(a._isUserblock&&a._plugins||a._sourceTheme&&a._sourceTheme!==b.theme.name&&a._plugins){var f=a._plugins.split(/,\s?/g),g=a._sourceTheme;if(f.length){c=b.theme.params.theme;if(c.base&&"bootstrap"===c.base.name&&4<c.base.version){var l=
["BootstrapCarouselSwipe","mbr-testimonials-slider","mbr-gradient-svg","mbr-flip-card","TouchSwipe"];f.forEach(function(a,b){l.forEach(function(c){a.toLowerCase()===c.toLowerCase()&&f.splice(b,1)})})}for(c=0;c<f.length;c++){var h=f[c].toLowerCase();d=!1;for(var k=0;k<b.registeredPlugins.length;k++)b.registeredPlugins[k]&&b.registeredPlugins[k].name.toLowerCase()===h&&(d=!0);if(!d&&g){var n=b.getAddonDir(g);m(g).done(function(c){c?c.forEach(function(a){if(f.some(function(b){return b.src?b.src.toLowerCase()===
a.name.toLowerCase():b.toLowerCase()===a.name.toLowerCase()})&&a.files.length){var c=[];a.root=n+"/plugins";a.files.forEach(function(d){var e=new Promise(function(c,e){b.registerUserblockPlugins(h,a);b.addCoreResource(n+"/plugins/"+(d.src?d.src:d)).then(function(){c()})});c.push(e)});Promise.all(c).then(function(){b.Core.$document.trigger("add.cards")})}}):e||b.Core.$body.find("[data-app-component-id="+a._id+"]").append('<span class="userblock-alert error">\n                    Missing '+(g+' extension. May work not correctly.\n                    <span class="userblock-alert__close" onclick="$(this).closest(\'.userblock-alert\').remove()"></span>\n                </span>'))})}}}}});
var n=null;b.$body.on("keyup","#add-component .add-component-blocks .user-block-search",function(){clearTimeout(n);var c=a(this);n=setTimeout(function(){var d=c.val().toLowerCase();b.$componentsLayer.find(".app-layer-cont .app-layer-cont-user").children().each(function(b,c){b=a(c);0<=b.find(".user-block-name").html().toLowerCase().indexOf(d)?b.show():b.hide()})},100)})},initedComponentsPalette:function(){v||b.updateUserBlocks();b.accountMode.isOffline()||1>b.$componentsLayer.find('.add-component-filter [data-filter="User"]').length&&
b.addComponentsFilterTab("User",e("User Blocks"),e("Show Blocks Saved By User"))}}})},["jQuery","mbrApp","TR()"]);
