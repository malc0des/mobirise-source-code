var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,f){a instanceof String&&(a=String(a));for(var e=a.length,b=0;b<e;b++){var g=a[b];if(d.call(f,g,b,a))return{i:b,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,f){a!=Array.prototype&&a!=Object.prototype&&(a[d]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,f,e){if(d){f=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var b=a[e];b in f||(f[b]={});f=f[b]}a=a[a.length-1];e=f[a];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,f){return $jscomp.findInternal(this,a,f).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return d?d.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function d(){this.batch_=null}function f(c){return c instanceof b?c:new b(function(a,b){a(c)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;d.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})}this.batch_.push(a)};var e=$jscomp.global.setTimeout;d.prototype.asyncExecuteFunction=function(a){e(a,0)};d.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var m=0;m<a.length;++m){var b=a[m];a[m]=null;try{b()}catch(p){this.asyncThrow_(p)}}}this.batch_=null};d.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var b=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(h){c.reject(h)}};b.prototype.createResolveAndReject_=function(){function a(a){return function(c){h||(h=!0,a.call(b,c))}}var b=this,h=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};b.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};b.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(h){this.reject_(h);return}"function"==typeof c?
this.settleSameAsThenable_(c,a):this.fulfill_(a)};b.prototype.reject_=function(a){this.settle_(2,a)};b.prototype.fulfill_=function(a){this.settle_(1,a)};b.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var g=new d;b.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};b.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(p){c.reject(p)}};b.prototype.then=function(a,g){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(q){f(q)}}:b}var d,f,e=new b(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(g,f));return e};
b.prototype.catch=function(a){return this.then(void 0,a)};b.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(c)};b.resolve=f;b.reject=function(a){return new b(function(b,c){c(a)})};b.race=function(a){return new b(function(b,c){for(var d=$jscomp.makeIterator(a),g=d.next();!g.done;g=d.next())f(g.value).callWhenSettled_(b,
c)})};b.all=function(a){var d=$jscomp.makeIterator(a),c=d.next();return c.done?f([]):new b(function(a,b){function g(b){return function(c){e[b]=c;h--;0==h&&a(e)}}var e=[],h=0;do e.push(void 0),h++,f(c.value).callWhenSettled_(g(e.length-1),b),c=d.next();while(!c.done)})};return b},"es6","es3");
defineM("app-plugin-image-editor-unsplash",function(a,d,f){var e,b=!1;d.regExtension({name:"plugin-image-editor-unsplash",global:{getFullImg:function(a,b,d,f){f=f||function(){};Bridge.download2(a,function(c){if(c){var g=Bridge.splitPath(a).ext||"jpg",e=c.replace(/\/(?:.(?!\/))+$/,"/mbr_0."+g);Bridge.moveLocal(c,e,function(){if(d)Bridge.transformImage(e,d,function(a){a?(f(a),Bridge.removeLocal(e)):f("")});else if(!b){b=Bridge.tempLocation+"/open"+Bridge.dateFormat(new Date,"yyyyMMdd_hhmmss");var a=
b+"/"+e.split("/").pop();Bridge.copyLocal(e,a,function(a){f(a);Bridge.removeLocal(e)})}})}else f("")},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36"})}},events:{showedMediaImageDialog:function(g,c,m){function h(b,c){g.find("#unspl-section").addClass("no-events");z.count=0;r=!0;a.when(p(b,c,z)).done(function(){t&&(t=!1,l.append(q),l.find(".error-alert p").text(f("Online image library is not available")));n.hide();r=!1;g.find("#unspl-section").removeClass("no-events");
d.fire("foundOnlineLibraryImages")}).fail(function(){n.hide();r=!1;g.find("#unspl-section").removeClass("no-events");l.append(q);l.find(".error-alert p").html(f("No images found!")+"<br>"+f("Please try another keyword"))})}function p(b,c,d){n.fadeIn(100);"object"==typeof d.state&&d.state.reject();var f=a.Deferred(),k=[];d.state=f;c="https://pixabay.com/api/?key=9360634-b51f8c2c619a0e6c5ad3427b6&page="+(c||1)+"&per_page=200&q="+encodeURIComponent(e);a.getJSON(c).done(function(b){0<parseInt(b.totalHits)?
(g.find(".pb-text").show(),a.each(b.hits,function(a,b){k.push(w(b,d))}),a.when.apply(a,k).then(function(){f.resolve()},function(){f.reject()})):f.reject()}).fail(function(c){g.find(".pb-text").hide();for(c=0;c<b;c++)k.push(w());a.when.apply(a,k).then(function(){f.resolve()})});return f.promise()}function w(b,c){var d=setTimeout(function(){t=!0;k.resolve()},2E4),f=a.now(),k=a.Deferred();if(b){var h=b.webformatURL.replace("_640","_180");Bridge.download3(h,{callback:function(e){if(e&&"Incorrect status code"!=
e){var m=Bridge.splitPath(h).ext||"jpg",v=e.replace(/\/(?:.(?!\/))+$/,"/thumb-mbr-"+b.id+"."+m);Bridge.moveLocal(e,v,function(){if(2E4>=a.now()-f){var e=x.clone();l.append(e);e.attr({"data-tooltipster":"bottom","data-tooltip-class":"preview-image","data-tooltip-src":v});e.find("img").attr({src:v,"data-url":b.fullHDURL});e.find("img").on("load",function(){c.count+=1;20==c.count&&(g.find("#unspl-section").removeClass("no-events"),n.hide(),g.on("click.media-click",".search-btn, .keywords > a",function(a){a.preventDefault();
k.reject()}))});e.find("img").on("error",function(){e.remove()});clearTimeout(d)}k.resolve()})}else t=!0,k.resolve()},headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36"}})}else Bridge.download2("https://source.unsplash.com/160x90/?"+e+"&sig="+10*Math.random(),function(b){b?Bridge.loadLocalFile(b,function(c){if(-1===c.indexOf("photo-1446704477871-62a4972035cd"))if(c=/href="([^"]*)"/g.exec(c)){var e=c[1].replace(/amp;/g,
"");Bridge.download2(e,function(c){if(c){var g=/images\.unsplash\.com\/(.*)\?/g.exec(e);if(g){g=g[1].replace(/\.|\/|_/g,"-").toLowerCase();var h=b.replace(/\/(?:.(?!\/))+$/,"/thumb-mbr-"+g+".jpg");Bridge.moveLocal(c,h,function(){if(2E4>=a.now()-f){var b=x.clone();l.append(b);b.find("img").attr({src:h,"data-url":e});clearTimeout(d)}k.resolve()})}else k.resolve()}else k.resolve()},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36"})}else k.resolve();
else console.log("Unsplash image not found"),clearTimeout(d),k.resolve()}):k.resolve()},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36"});return k.promise()}function y(a){a.preventDefault();l.scrollTop()+D===l[0].scrollHeight&&h(10,++E)}var B=this,C=['<div id="unspl-section" class="unspl-section">','<input class="form-control search-input pull-left" value="" type="text" placeholder="'+f("Search by keyword")+'"/>','<button class="btn btn-primary search-btn">'+
f("Search")+"</button>",'<p class="pb-text">Images from <a class="pb-link" href="https://pixabay.com/">Pixabay</a></p>','<div class="keywords">'+f("e.g.")+",&nbsp;",'<a href="javascript:void(0)">computer</a>\n<a href="javascript:void(0)">work</a>\n<a href="javascript:void(0)">business</a>\n<a href="javascript:void(0)">man</a>\n<a href="javascript:void(0)">woman</a>\n<a href="javascript:void(0)">city</a>\n<a href="javascript:void(0)">nature</a>\n<a href="javascript:void(0)">animals</a>\n<a href="javascript:void(0)">pattern</a>\n<a href="javascript:void(0)">abstract</a>\n<a href="javascript:void(0)">art</a>\n<a href="javascript:void(0)">food</a>\n</div>\n<div class="images-list"></div>\n</div>'].join("\n"),
x=a('<div class="image-wrapper"><img></div>'),q=a('<div class="error-alert"><p></p></div>');g.find(".media-image-form #media-tabs .tab-content .tab-pane#onlineLibrary").append(C);g.find(".pb-link").click(function(){d.openUrl("https://pixabay.com/")});var n=a(d.preloaderHTML),u=g.find(".search-input"),F=g.find(".search-btn"),l=g.find("#unspl-section .images-list"),r=!1,t=!1;l.before(n);var z={count:0,state:a.Deferred()};g.on("click.media-click",".search-btn, .keywords > a",function(c){c.preventDefault();
!1===r&&("A"===c.target.nodeName&&u.val(c.target.text),""!==a.trim(u.val())&&(b=!0,e=a.trim(u.val()),l.off("scroll"),q.remove(),l.empty(),h(20),setTimeout(function(){l.on("scroll",y)},1E3)))});u.keypress(function(a){13===(a.keyCode?a.keyCode:a.which)&&(a.preventDefault(),F.trigger("click.media-click"))});g.on("click.media-click","#unspl-section .image-wrapper",function(b){b.preventDefault();g.find(".modal-content").addClass("no-events");n.fadeIn(100);b=a(this).find("img").attr("data-url").replace(/\?.*/g,
"?w=1920&h=1080&q=80&fit=clip&fm=jpg");var e={width:c.image.width||"-1",quality:c.image.quality||80};B.getFullImg(b,"",d.projectSettings.imageResize?e:"",function(b){b&&(a("#media-image",g).attr("src",b),m&&g.find('.modal-footer [data-bb-handler="success"]').click(),g.find(".modal-content").removeClass("no-events"),n.hide())})});var D=l.innerHeight(),E=1;l.on("scroll",y);var A=!0;g.on("shown.bs.tab",'a[data-toggle="tab"][href="#onlineLibrary"]',function(a){A&&(A=!1,(new Promise(function(a,c){b?a():
Bridge.getSettings("lastImageLibrarySearch",function(c){c?(e=c,b=!0):(c="computer work business phone mobile pc".split(" "),e=c[Math.floor(Math.random()*c.length)]);a()})})).then(function(){h(20)}))})},modalDialogHide:function(a){a.hasClass("media-image")&&b&&Bridge.setSettings("lastImageLibrarySearch",e)}}})},["jQuery","mbrApp","TR()"]);
